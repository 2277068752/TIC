!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TEduBoard=e():t.TEduBoard=e()}(window,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,r){var o;o=function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="D:\\code\\cos-wx-sdk-v5\\demo\\lib",r(r.s=5)}([function(t,e,r){"use strict";var o=r(8),i=r(6),n=r(10),a=r(7),s=r(1);function c(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}var l=function(){},u=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&null!==t[r]&&(e[r]=t[r]);return e};function d(t){return g(t,function(t){return"object"==typeof t?d(t):t})}function h(t,e){return p(e,function(r,o){t[o]=e[o]}),t}function f(t){return t instanceof Array}function p(t,e){for(var r in t)t.hasOwnProperty(r)&&e(t[r],r)}function g(t,e){var r=f(t)?[]:{};for(var o in t)t.hasOwnProperty(o)&&(r[o]=e(t[o],o));return r}var m=function(t,e){if(e=h({},e),"getAuth"!==t&&"getV4Auth"!==t&&"getObjectUrl"!==t){var r=e.Headers||{};e&&"object"==typeof e&&(!function(){for(var t in e)e.hasOwnProperty(t)&&t.indexOf("x-cos-")>-1&&(r[t]=e[t])}(),y.each({"x-cos-mfa":"MFA","Content-MD5":"ContentMD5","Content-Length":"ContentLength","Content-Type":"ContentType",Expect:"Expect",Expires:"Expires","Cache-Control":"CacheControl","Content-Disposition":"ContentDisposition","Content-Encoding":"ContentEncoding",Range:"Range","If-Modified-Since":"IfModifiedSince","If-Unmodified-Since":"IfUnmodifiedSince","If-Match":"IfMatch","If-None-Match":"IfNoneMatch","x-cos-copy-source":"CopySource","x-cos-copy-source-Range":"CopySourceRange","x-cos-metadata-directive":"MetadataDirective","x-cos-copy-source-If-Modified-Since":"CopySourceIfModifiedSince","x-cos-copy-source-If-Unmodified-Since":"CopySourceIfUnmodifiedSince","x-cos-copy-source-If-Match":"CopySourceIfMatch","x-cos-copy-source-If-None-Match":"CopySourceIfNoneMatch","x-cos-acl":"ACL","x-cos-grant-read":"GrantRead","x-cos-grant-write":"GrantWrite","x-cos-grant-full-control":"GrantFullControl","x-cos-grant-read-acp":"GrantReadAcp","x-cos-grant-write-acp":"GrantWriteAcp","x-cos-storage-class":"StorageClass","x-cos-server-side-encryption-customer-algorithm":"SSECustomerAlgorithm","x-cos-server-side-encryption-customer-key":"SSECustomerKey","x-cos-server-side-encryption-customer-key-MD5":"SSECustomerKeyMD5","x-cos-server-side-encryption":"ServerSideEncryption","x-cos-server-side-encryption-cos-kms-key-id":"SSEKMSKeyId","x-cos-server-side-encryption-context":"SSEContext"},function(t,o){void 0!==e[t]&&(r[o]=e[t])}),e.Headers=u(r))}return e},_=function(t){return Date.now()+(t||0)},y={noop:l,formatParams:m,apiWrapper:function(t,e){return function(r,o){"function"==typeof r&&(o=r,r={}),r=m(t,r);var i=function(t){return t&&t.headers&&(t.headers["x-cos-version-id"]&&(t.VersionId=t.headers["x-cos-version-id"]),t.headers["x-cos-delete-marker"]&&(t.DeleteMarker=t.headers["x-cos-delete-marker"])),t},n=function(t,e){o&&o(i(t),i(e))};if("getService"!==t&&"abortUploadTask"!==t){var a;if(a=function(t,e){var r=e.Bucket,o=e.Region,i=e.Key;if(t.indexOf("Bucket")>-1||"deleteMultipleObject"===t||"multipartList"===t||"listObjectVersions"===t){if(!r)return"Bucket";if(!o)return"Region"}else if(t.indexOf("Object")>-1||t.indexOf("multipart")>-1||"sliceUploadFile"===t||"abortUploadTask"===t){if(!r)return"Bucket";if(!o)return"Region";if(!i)return"Key"}return!1}(t,r))return void n({error:"missing param "+a});if(r.Region){if(r.Region.indexOf("cos.")>-1)return void n({error:'param Region should not be start with "cos."'});if(!/^([a-z\d-]+)$/.test(r.Region))return void n({error:"Region format error."});!this.options.CompatibilityMode&&-1===r.Region.indexOf("-")&&"yfb"!==r.Region&&r.Region}if(r.Bucket){if(!/^([a-z\d-]+)-(\d+)$/.test(r.Bucket))if(r.AppId)r.Bucket=r.Bucket+"-"+r.AppId;else{if(!this.options.AppId)return void n({error:'Bucket should format as "test-1250000000".'});r.Bucket=r.Bucket+"-"+this.options.AppId}r.AppId&&delete r.AppId}}var s=e.call(this,r,n);if("getAuth"===t||"getObjectUrl"===t)return s}},xml2json:n,json2xml:a,md5:o,clearKey:u,getFileMd5:function(t,e){!function(t,e){var r,o=new FileReader;FileReader.prototype.readAsBinaryString?(r=FileReader.prototype.readAsBinaryString,o.onload=function(){e(this.result)}):FileReader.prototype.readAsArrayBuffer&&(r=function(t){var r="",o=new FileReader;o.onload=function(t){for(var i=new Uint8Array(o.result),n=i.byteLength,a=0;a<n;a++)r+=String.fromCharCode(i[a]);e(r)},o.readAsArrayBuffer(t)}),r.call(o,t)}(t,function(t){var r=o(t,!0);e(null,r)})},binaryBase64:function(t){var e,r,o,i="";for(e=0,r=t.length/2;e<r;e++)o=parseInt(t[2*e]+t[2*e+1],16),i+=String.fromCharCode(o);return s.btoa(i)},extend:h,isArray:f,isInArray:function(t,e){for(var r=!1,o=0;o<t.length;o++)if(e===t[o]){r=!0;break}return r},makeArray:function(t){return f(t)?t:[t]},each:p,map:g,filter:function(t,e){var r=f(t),o=r?[]:{};for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)&&(r?o.push(t[i]):o[i]=t[i]);return o},clone:d,uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},camSafeUrlEncode:c,throttleOnProgress:function(t,e){if(!e||"function"!=typeof e)return l;var r,o,i=this,n=0,a=0,s=Date.now();function c(){clearTimeout(o),o=0,r=Date.now();var i,c=Math.max(0,Math.round((a-n)/((r-s)/1e3)*100)/100);i=0===a&&0===t?1:Math.round(a/t*100)/100||0,s=r,n=a;try{e({loaded:a,total:t,speed:c,percent:i})}catch(t){}}return function(e,r){if(e&&(a=e.loaded,t=e.total),Date.now()-s>i.options.ProgressInterval||r)c();else{if(o)return;o=setTimeout(c,i.options.ProgressInterval)}}},getFileSize:function(t,e,r){var o;"string"==typeof e.Body&&(e.Body=new Blob([e.Body],{type:"text/plain"})),e.Body&&(e.Body instanceof Blob||"[object File]"===e.Body.toString()||"[object Blob]"===e.Body.toString())?(o=e.Body.size,e.ContentLength=o,r(null,o)):r({error:"params body format error, Only allow File|Blob|String."})},getSkewTime:_,getAuth:function(t){var e=(t=t||{}).SecretId,r=t.SecretKey,o=t.KeyTime,n=(t.method||t.Method||"get").toLowerCase(),a=d(t.Query||t.params||{}),s=d(t.Headers||t.headers||{}),l=t.Pathname||"/"+(t.Key||"");if(e&&r){var u=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e.sort(function(t,e){return(t=t.toLowerCase())===(e=e.toLowerCase())?0:t>e?1:-1})},h=function(t){var e,r,o,i=[],n=u(t);for(e=0;e<n.length;e++)o=void 0===t[r=n[e]]||null===t[r]?"":""+t[r],r=c(r=r.toLowerCase()),o=c(o)||"",i.push(r+"="+o);return i.join("&")},f=Math.round(_(t.SystemClockOffset)/1e3)-1,p=f,g=t.Expires||t.expires;p+=void 0===g?900:1*g||0;var m=e,y=o||f+";"+p,T=o||f+";"+p,b=u(s).join(";").toLowerCase(),v=u(a).join(";").toLowerCase(),E=i.HmacSHA1(T,r).toString(),S=[n,l,h(a),h(s),""].join("\n"),D=["sha1",y,i.SHA1(S).toString(),""].join("\n");return["q-sign-algorithm=sha1","q-ak="+m,"q-sign-time="+y,"q-key-time="+T,"q-header-list="+b,"q-url-param-list="+v,"q-signature="+i.HmacSHA1(D,E).toString()].join("&")}},isBrowser:!0,fileSlice:function(t,e,r){return t.slice?t.slice(e,r):t.mozSlice?t.mozSlice(e,r):t.webkitSlice?t.webkitSlice(e,r):void 0},getFileUUID:function(t,e){return t.name&&t.size&&t.lastModifiedDate&&e?y.md5([t.name,t.size,t.lastModifiedDate,e].join("::")):null},getBodyMd5:function(t,e,r){r=r||l,t&&"string"==typeof e?r(y.md5(e,!0)):r()}};t.exports=y},function(t,e){var r,o,i,n,a,s,c,l,u,d,h,f,p,g,m,_,y,T,b,v=(o=(r=r||{}).Base64,n=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a=String.fromCharCode,s=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?a(192|e>>>6)+a(128|63&e):a(224|e>>>12&15)+a(128|e>>>6&63)+a(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return a(240|e>>>18&7)+a(128|e>>>12&63)+a(128|e>>>6&63)+a(128|63&e)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(t){return t.replace(c,s)},u=function(t){var e=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[i.charAt(r>>>18),i.charAt(r>>>12&63),e>=2?"=":i.charAt(r>>>6&63),e>=1?"=":i.charAt(63&r)].join("")},d=r.btoa?function(t){return r.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,u)},h=function(t){return d(l(t))},f=function(t,e){return e?h(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):h(String(t))},p=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),g=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return a(55296+(e>>>10))+a(56320+(1023&e));case 3:return a((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return a((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},m=function(t){return t.replace(p,g)},_=function(t){var e=t.length,r=e%4,o=(e>0?n[t.charAt(0)]<<18:0)|(e>1?n[t.charAt(1)]<<12:0)|(e>2?n[t.charAt(2)]<<6:0)|(e>3?n[t.charAt(3)]:0),i=[a(o>>>16),a(o>>>8&255),a(255&o)];return i.length-=[0,0,2,1][r],i.join("")},y=r.atob?function(t){return r.atob(t)}:function(t){return t.replace(/[\s\S]{1,4}/g,_)},T=function(t){return m(y(t))},{VERSION:"2.1.9",atob:y,btoa:d,fromBase64:b=function(t){return T(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},toBase64:f,utob:l,encode:f,encodeURI:function(t){return f(t,!0)},btou:m,decode:b,noConflict:function(){var t=r.Base64;return r.Base64=o,t}});t.exports=v},function(t,e){function r(t,e){for(var r in t)e[r]=t[r]}function o(t,e){var o=t.prototype;if(Object.create){var i=Object.create(e.prototype);o.__proto__=i}if(!(o instanceof e)){function n(){}n.prototype=e.prototype,r(o,n=new n),t.prototype=o=n}o.constructor!=t&&(o.constructor=t)}var i="http://www.w3.org/1999/xhtml",n={},a=n.ELEMENT_NODE=1,s=n.ATTRIBUTE_NODE=2,c=n.TEXT_NODE=3,l=n.CDATA_SECTION_NODE=4,u=n.ENTITY_REFERENCE_NODE=5,d=n.ENTITY_NODE=6,h=n.PROCESSING_INSTRUCTION_NODE=7,f=n.COMMENT_NODE=8,p=n.DOCUMENT_NODE=9,g=n.DOCUMENT_TYPE_NODE=10,m=n.DOCUMENT_FRAGMENT_NODE=11,_=n.NOTATION_NODE=12,y={},T={},b=(y.INDEX_SIZE_ERR=(T[1]="Index size error",1),y.DOMSTRING_SIZE_ERR=(T[2]="DOMString size error",2),y.HIERARCHY_REQUEST_ERR=(T[3]="Hierarchy request error",3)),v=(y.WRONG_DOCUMENT_ERR=(T[4]="Wrong document",4),y.INVALID_CHARACTER_ERR=(T[5]="Invalid character",5),y.NO_DATA_ALLOWED_ERR=(T[6]="No data allowed",6),y.NO_MODIFICATION_ALLOWED_ERR=(T[7]="No modification allowed",7),y.NOT_FOUND_ERR=(T[8]="Not found",8)),E=(y.NOT_SUPPORTED_ERR=(T[9]="Not supported",9),y.INUSE_ATTRIBUTE_ERR=(T[10]="Attribute in use",10));function S(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,T[t]),this.message=T[t],Error.captureStackTrace&&Error.captureStackTrace(this,S);return r.code=t,e&&(this.message=this.message+": "+e),r}function D(){}function A(t,e){this._node=t,this._refresh=e,C(this)}function C(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var o=t._refresh(t._node);rt(t,"length",o.length),r(o,t),t._inc=e}}function O(){}function R(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function I(t,e,r,o){if(o?e[R(e,o)]=r:e[e.length++]=r,t){r.ownerElement=t;var i=t.ownerDocument;i&&(o&&k(i,t,o),function(t,e,r){i&&i._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(e._nsMap[r.prefix?r.localName:""]=r.value)}(0,t,r))}}function x(t,e,r){var o=R(e,r);if(!(o>=0))throw S(v,new Error(t.tagName+"@"+r));for(var i=e.length-1;o<i;)e[o]=e[++o];if(e.length=i,t){var n=t.ownerDocument;n&&(k(n,t,r),r.ownerElement=null)}}function B(t){if(this._features={},t)for(var e in t)this._features=t[e]}function P(){}function w(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function N(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(N(t,e))return!0}while(t=t.nextSibling)}function L(){}function k(t,e,r,o){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete e._nsMap[r.prefix?r.localName:""]}function M(t,e,r){if(t&&t._inc){t._inc++;var o=e.childNodes;if(r)o[o.length++]=r;else{for(var i=e.firstChild,n=0;i;)o[n++]=i,i=i.nextSibling;o.length=n}}}function q(t,e){var r=e.previousSibling,o=e.nextSibling;return r?r.nextSibling=o:t.firstChild=o,o?o.previousSibling=r:t.lastChild=r,M(t.ownerDocument,t),e}function F(t,e,r){var o=e.parentNode;if(o&&o.removeChild(e),e.nodeType===m){var i=e.firstChild;if(null==i)return e;var n=e.lastChild}else i=n=e;var a=r?r.previousSibling:t.lastChild;i.previousSibling=a,n.nextSibling=r,a?a.nextSibling=i:t.firstChild=i,null==r?t.lastChild=n:r.previousSibling=n;do{i.parentNode=t}while(i!==n&&(i=i.nextSibling));return M(t.ownerDocument||t,t),e.nodeType==m&&(e.firstChild=e.lastChild=null),e}function U(){this._nsMap={}}function G(){}function H(){}function j(){}function V(){}function Y(){}function K(){}function W(){}function z(){}function X(){}function J(){}function $(){}function Z(){}function Q(t,e){var r=[],o=9==this.nodeType?this.documentElement:this,i=o.prefix,n=o.namespaceURI;if(n&&null==i&&null==(i=o.lookupPrefix(n)))var a=[{namespace:n,prefix:null}];return et(this,r,t,e,a),r.join("")}function tt(t,e,r){var o=t.prefix||"",i=t.namespaceURI;if(!o&&!i)return!1;if("xml"===o&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var n=r.length;n--;){var a=r[n];if(a.prefix==o)return a.namespace!=i}return!0}function et(t,e,r,o,n){if(o){if(!(t=o(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case a:n||(n=[]),n.length;var d=t.attributes,_=d.length,y=t.firstChild,T=t.tagName;r=i===t.namespaceURI||r,e.push("<",T);for(var b=0;b<_;b++)"xmlns"==(v=d.item(b)).prefix?n.push({prefix:v.localName,namespace:v.value}):"xmlns"==v.nodeName&&n.push({prefix:"",namespace:v.value});for(b=0;b<_;b++){var v;if(tt(v=d.item(b),0,n)){var E=v.prefix||"",S=v.namespaceURI,D=E?" xmlns:"+E:" xmlns";e.push(D,'="',S,'"'),n.push({prefix:E,namespace:S})}et(v,e,r,o,n)}if(tt(t,0,n)&&(E=t.prefix||"",S=t.namespaceURI,D=E?" xmlns:"+E:" xmlns",e.push(D,'="',S,'"'),n.push({prefix:E,namespace:S})),y||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(T)){if(e.push(">"),r&&/^script$/i.test(T))for(;y;)y.data?e.push(y.data):et(y,e,r,o,n),y=y.nextSibling;else for(;y;)et(y,e,r,o,n),y=y.nextSibling;e.push("</",T,">")}else e.push("/>");return;case p:case m:for(y=t.firstChild;y;)et(y,e,r,o,n),y=y.nextSibling;return;case s:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,w),'"');case c:return e.push(t.data.replace(/[<&]/g,w));case l:return e.push("<![CDATA[",t.data,"]]>");case f:return e.push("\x3c!--",t.data,"--\x3e");case g:var A=t.publicId,C=t.systemId;if(e.push("<!DOCTYPE ",t.name),A)e.push(' PUBLIC "',A),C&&"."!=C&&e.push('" "',C),e.push('">');else if(C&&"."!=C)e.push(' SYSTEM "',C,'">');else{var O=t.internalSubset;O&&e.push(" [",O,"]"),e.push(">")}return;case h:return e.push("<?",t.target," ",t.data,"?>");case u:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function rt(t,e,r){t[e]=r}y.INVALID_STATE_ERR=(T[11]="Invalid state",11),y.SYNTAX_ERR=(T[12]="Syntax error",12),y.INVALID_MODIFICATION_ERR=(T[13]="Invalid modification",13),y.NAMESPACE_ERR=(T[14]="Invalid namespace",14),y.INVALID_ACCESS_ERR=(T[15]="Invalid access",15),S.prototype=Error.prototype,r(y,S),D.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var r=[],o=0;o<this.length;o++)et(this[o],r,t,e);return r.join("")}},A.prototype.item=function(t){return C(this),this[t]},o(A,D),O.prototype={length:0,item:D.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new S(E);var r=this.getNamedItem(t.nodeName);return I(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e,r=t.ownerElement;if(r&&r!=this._ownerElement)throw new S(E);return e=this.getNamedItemNS(t.namespaceURI,t.localName),I(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return x(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return x(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var o=this[r];if(o.localName==e&&o.namespaceURI==t)return o}return null}},B.prototype={hasFeature:function(t,e){var r=this._features[t.toLowerCase()];return!(!r||e&&!(e in r))},createDocument:function(t,e,r){var o=new L;if(o.implementation=this,o.childNodes=new D,o.doctype=r,r&&o.appendChild(r),e){var i=o.createElementNS(t,e);o.appendChild(i)}return o},createDocumentType:function(t,e,r){var o=new K;return o.name=t,o.nodeName=t,o.publicId=e,o.systemId=r,o}},P.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return F(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return q(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,r,o){var i=new r.constructor;for(var n in r){var c=r[n];"object"!=typeof c&&c!=i[n]&&(i[n]=c)}switch(r.childNodes&&(i.childNodes=new D),i.ownerDocument=e,i.nodeType){case a:var l=r.attributes,u=i.attributes=new O,d=l.length;u._ownerElement=i;for(var h=0;h<d;h++)i.setAttributeNode(t(e,l.item(h),!0));break;case s:o=!0}if(o)for(var f=r.firstChild;f;)i.appendChild(t(e,f,o)),f=f.nextSibling;return i}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==c&&t.nodeType==c?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r)for(var o in r)if(r[o]==t)return o;e=e.nodeType==s?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&t in r)return r[t];e=e.nodeType==s?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},r(n,P),r(n,P.prototype),L.prototype={nodeName:"#document",nodeType:p,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==m){for(var r=t.firstChild;r;){var o=r.nextSibling;this.insertBefore(r,e),r=o}return t}return null==this.documentElement&&t.nodeType==a&&(this.documentElement=t),F(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),q(this,t)},importNode:function(t,e){return function t(e,r,o){var i;switch(r.nodeType){case a:(i=r.cloneNode(!1)).ownerDocument=e;case m:break;case s:o=!0}if(i||(i=r.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,o)for(var n=r.firstChild;n;)i.appendChild(t(e,n,o)),n=n.nextSibling;return i}(this,t,e)},getElementById:function(t){var e=null;return N(this.documentElement,function(r){if(r.nodeType==a&&r.getAttribute("id")==t)return e=r,!0}),e},createElement:function(t){var e=new U;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new D,(e.attributes=new O)._ownerElement=e,e},createDocumentFragment:function(){var t=new J;return t.ownerDocument=this,t.childNodes=new D,t},createTextNode:function(t){var e=new j;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new V;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new Y;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new $;return r.ownerDocument=this,r.tagName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new G;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new X;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new U,o=e.split(":"),i=r.attributes=new O;return r.childNodes=new D,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,i._ownerElement=r,r},createAttributeNS:function(t,e){var r=new G,o=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,r}},o(L,P),U.prototype={nodeType:a,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===m?this.insertBefore(t,null):function(t,e){var r=e.parentNode;if(r){var o=t.lastChild;r.removeChild(e),o=t.lastChild}return o=t.lastChild,e.parentNode=t,e.previousSibling=o,e.nextSibling=null,o?o.nextSibling=e:t.firstChild=e,t.lastChild=e,M(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var o=this.ownerDocument.createAttributeNS(t,e);o.value=o.nodeValue=""+r,this.setAttributeNode(o)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new A(this,function(e){var r=[];return N(e,function(o){o===e||o.nodeType!=a||"*"!==t&&o.tagName!=t||r.push(o)}),r})},getElementsByTagNameNS:function(t,e){return new A(this,function(r){var o=[];return N(r,function(i){i===r||i.nodeType!==a||"*"!==t&&i.namespaceURI!==t||"*"!==e&&i.localName!=e||o.push(i)}),o})}},L.prototype.getElementsByTagName=U.prototype.getElementsByTagName,L.prototype.getElementsByTagNameNS=U.prototype.getElementsByTagNameNS,o(U,P),G.prototype.nodeType=s,o(G,P),H.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(T[b])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){r=this.data.substring(0,t)+r+this.data.substring(t+e),this.nodeValue=this.data=r,this.length=r.length}},o(H,P),j.prototype={nodeName:"#text",nodeType:c,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var o=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling),o}},o(j,H),V.prototype={nodeName:"#comment",nodeType:f},o(V,H),Y.prototype={nodeName:"#cdata-section",nodeType:l},o(Y,H),K.prototype.nodeType=g,o(K,P),W.prototype.nodeType=_,o(W,P),z.prototype.nodeType=d,o(z,P),X.prototype.nodeType=u,o(X,P),J.prototype.nodeName="#document-fragment",J.prototype.nodeType=m,o(J,P),$.prototype.nodeType=h,o($,P),Z.prototype.serializeToString=function(t,e,r){return Q.call(t,e,r)},P.prototype.toString=Q;try{Object.defineProperty&&(Object.defineProperty(A.prototype,"length",{get:function(){return C(this),this.$$length}}),Object.defineProperty(P.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case a:case m:var r=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case a:case m:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),rt=function(t,e,r){t["$$"+e]=r})}catch(t){}e.DOMImplementation=B,e.XMLSerializer=Z},function(t,e){var r=function(t){var e={},r=function(t){return!e[t]&&(e[t]=[]),e[t]};t.on=function(t,e){r(t).push(e)},t.off=function(t,e){for(var o=r(t),i=o.length-1;i>=0;i--)e===o[i]&&o.splice(i,1)},t.emit=function(t,e){for(var o=r(t).map(function(t){return t}),i=0;i<o.length;i++)o[i](e)}};t.exports.init=r,t.exports.EventProxy=function(){r(this)}},function(t,e,r){"use strict";var o=r(0),i=r(3),n=r(16),a=r(15),s=r(13),c={SecretId:"",SecretKey:"",XCosSecurityToken:"",ChunkRetryTimes:2,FileParallelLimit:3,ChunkParallelLimit:3,ChunkRetryTimes:3,ChunkSize:1048576,SliceSize:1048576,CopyChunkParallelLimit:20,CopyChunkSize:10485760,CopySliceSize:10485760,MaxPartNumber:1e4,ProgressInterval:1e3,UploadQueueSize:1e4,Domain:"",ServiceDomain:"",Protocol:"",CompatibilityMode:!1,ForcePathStyle:!1,CorrectClockSkew:!0,SystemClockOffset:0},l=function(t){this.options=o.extend(o.clone(c),t||{}),this.options.FileParallelLimit=Math.max(1,this.options.FileParallelLimit),this.options.ChunkParallelLimit=Math.max(1,this.options.ChunkParallelLimit),this.options.ChunkRetryTimes=Math.max(0,this.options.ChunkRetryTimes),this.options.ChunkSize=Math.max(1048576,this.options.ChunkSize),this.options.CopyChunkParallelLimit=Math.max(1,this.options.CopyChunkParallelLimit),this.options.CopyChunkSize=Math.max(1048576,this.options.CopyChunkSize),this.options.CopySliceSize=Math.max(0,this.options.CopySliceSize),this.options.MaxPartNumber=Math.max(1024,Math.min(1e4,this.options.MaxPartNumber)),this.options.Timeout=Math.max(0,this.options.Timeout),this.options.AppId,i.init(this),n.init(this)};a.init(l,n),s.init(l,n),l.getAuthorization=o.getAuth,l.version="0.7.10",t.exports=l},function(t,e,r){var o=r(4);t.exports=o},function(t,e){var r,o,i,n,a,s,c,l=l||function(t,e){var r={},o=r.lib={},i=function(){},n=o.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,r=t.words,o=this.sigBytes;if(t=t.sigBytes,this.clamp(),o%4)for(var i=0;i<t;i++)e[o+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else if(65535<r.length)for(i=0;i<t;i+=4)e[o+i>>>2]=r[i>>>2];else e.push.apply(e,r);return this.sigBytes+=t,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=n.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r=[],o=0;o<e;o+=4)r.push(4294967296*t.random()|0);return new a.init(r,e)}}),s=r.enc={},c=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o+=2)r[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new a.init(r,e/2)}},l=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++)r.push(String.fromCharCode(e[o>>>2]>>>24-o%4*8&255));return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o++)r[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new a.init(r,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},d=o.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,o=r.words,i=r.sigBytes,n=this.blockSize,s=i/(4*n);if(e=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*n,i=t.min(4*e,i),e){for(var c=0;c<e;c+=n)this._doProcessBlock(o,c);c=o.splice(0,e),r.sigBytes-=i}return new a.init(c,i)},clone:function(){var t=n.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});o.Hasher=d.extend({cfg:n.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new h.HMAC.init(t,r).finalize(e)}}});var h=r.algo={};return r}(Math);o=(a=(r=l).lib).WordArray,i=a.Hasher,n=[],a=r.algo.SHA1=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,o=r[0],i=r[1],a=r[2],s=r[3],c=r[4],l=0;80>l;l++){if(16>l)n[l]=0|t[e+l];else{var u=n[l-3]^n[l-8]^n[l-14]^n[l-16];n[l]=u<<1|u>>>31}u=(o<<5|o>>>27)+c+n[l],u=20>l?u+(1518500249+(i&a|~i&s)):40>l?u+(1859775393+(i^a^s)):60>l?u+((i&a|i&s|a&s)-1894007588):u+((i^a^s)-899497514),c=s,s=a,a=i<<30|i>>>2,i=o,o=u}r[0]=r[0]+o|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[14+(o+64>>>9<<4)]=Math.floor(r/4294967296),e[15+(o+64>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}}),r.SHA1=i._createHelper(a),r.HmacSHA1=i._createHmacHelper(a),function(){var t=l,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,r){t=this._hasher=new t.init,"string"==typeof r&&(r=e.parse(r));var o=t.blockSize,i=4*o;r.sigBytes>i&&(r=t.finalize(r)),r.clamp();for(var n=this._oKey=r.clone(),a=this._iKey=r.clone(),s=n.words,c=a.words,l=0;l<o;l++)s[l]^=1549556828,c[l]^=909522486;n.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),c=(s=l).lib.WordArray,s.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,o=this._map;t.clamp();for(var i=[],n=0;n<r;n+=3)for(var a=(e[n>>>2]>>>24-n%4*8&255)<<16|(e[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|e[n+2>>>2]>>>24-(n+2)%4*8&255,s=0;s<4&&n+.75*s<r;s++)i.push(o.charAt(a>>>6*(3-s)&63));var c=o.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(t){var e=t.length,r=this._map,o=r.charAt(64);if(o){var i=t.indexOf(o);-1!=i&&(e=i)}for(var n=[],a=0,s=0;s<e;s++)if(s%4){var l=r.indexOf(t.charAt(s-1))<<s%4*2,u=r.indexOf(t.charAt(s))>>>6-s%4*2;n[a>>>2]|=(l|u)<<24-a%4*8,a++}return c.create(n,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},t.exports=l},function(t,e){var r=new RegExp("^([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�])|^((x|X)(m|M)(l|L))|([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�-.0-9·̀-ͯ‿⁀])","g"),o=/[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm,i=function(t){var e=[];if(t instanceof Object)for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e},n=function(t,e){var n=function(t,o,i,n,a){var s=void 0!==e.indent?e.indent:"\t",c=e.prettyPrint?"\n"+new Array(n).join(s):"";e.removeIllegalNameCharacters&&(t=t.replace(r,"_"));var l=[c,"<",t,i||""];return o&&o.length>0?(l.push(">"),l.push(o),a&&l.push(c),l.push("</"),l.push(t),l.push(">")):l.push("/>"),l.join("")};return function t(r,a,s){var c=typeof r;switch((Array.isArray?Array.isArray(r):r instanceof Array)?c="array":r instanceof Date&&(c="date"),c){case"array":var l=[];return r.map(function(e){l.push(t(e,1,s+1))}),e.prettyPrint&&l.push("\n"),l.join("");case"date":return r.toJSON?r.toJSON():r+"";case"object":var u=[];for(var d in r)if(r[d]instanceof Array)for(var h in r[d])u.push(n(d,t(r[d][h],0,s+1),null,s+1,i(r[d][h]).length));else u.push(n(d,t(r[d],0,s+1),null,s+1));return e.prettyPrint&&u.length>0&&u.push("\n"),u.join("");case"function":return r();default:return e.escape?(""+r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(o,""):""+r}}(t,0,0)},a=function(t){var e=['<?xml version="1.0" encoding="UTF-8"'];return t&&e.push(' standalone="yes"'),e.push("?>"),e.join("")};t.exports=function(t,e){if(e||(e={xmlHeader:{standalone:!0},prettyPrint:!0,indent:"  "}),"string"==typeof t)try{t=JSON.parse(t.toString())}catch(t){return!1}var r="",o="";return e&&("object"==typeof e?(e.xmlHeader&&(r=a(!!e.xmlHeader.standalone)),void 0!==e.docType&&(o="<!DOCTYPE "+e.docType+">")):r=a()),[r,(e=e||{}).prettyPrint&&o?"\n":"",o,n(t,e)].join("").replace(/\n{2,}/g,"\n").replace(/\s+$/g,"")}},function(t,e){t.exports=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,o,i,n,a;return i=2147483648&t,n=2147483648&e,a=(1073741823&t)+(1073741823&e),(r=1073741824&t)&(o=1073741824&e)?2147483648^a^i^n:r|o?1073741824&a?3221225472^a^i^n:1073741824^a^i^n:a^i^n}function o(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o&i|~o&n,a),c)),s),o)}function i(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o&n|i&~n,a),c)),s),o)}function n(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o^i^n,a),c)),s),o)}function a(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(i^(o|~n),a),c)),s),o)}function s(t){var e,r="",o="";for(e=0;e<=3;e++)r+=(o="0"+(t>>>8*e&255).toString(16)).substr(o.length-2,2);return r}var c,l,u,d,h,f,p,g,m,_=Array();for(_=function(t){for(var e,r=t.length,o=r+8,i=16*((o-o%64)/64+1),n=Array(i-1),a=0,s=0;s<r;)a=s%4*8,n[e=(s-s%4)/4]=n[e]|t.charCodeAt(s)<<a,s++;return a=s%4*8,n[e=(s-s%4)/4]=n[e]|128<<a,n[i-2]=r<<3,n[i-1]=r>>>29,n}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}(t)),f=1732584193,p=4023233417,g=2562383102,m=271733878,c=0;c<_.length;c+=16)l=f,u=p,d=g,h=m,p=a(p=a(p=a(p=a(p=n(p=n(p=n(p=n(p=i(p=i(p=i(p=i(p=o(p=o(p=o(p=o(p,g=o(g,m=o(m,f=o(f,p,g,m,_[c+0],7,3614090360),p,g,_[c+1],12,3905402710),f,p,_[c+2],17,606105819),m,f,_[c+3],22,3250441966),g=o(g,m=o(m,f=o(f,p,g,m,_[c+4],7,4118548399),p,g,_[c+5],12,1200080426),f,p,_[c+6],17,2821735955),m,f,_[c+7],22,4249261313),g=o(g,m=o(m,f=o(f,p,g,m,_[c+8],7,1770035416),p,g,_[c+9],12,2336552879),f,p,_[c+10],17,4294925233),m,f,_[c+11],22,2304563134),g=o(g,m=o(m,f=o(f,p,g,m,_[c+12],7,1804603682),p,g,_[c+13],12,4254626195),f,p,_[c+14],17,2792965006),m,f,_[c+15],22,1236535329),g=i(g,m=i(m,f=i(f,p,g,m,_[c+1],5,4129170786),p,g,_[c+6],9,3225465664),f,p,_[c+11],14,643717713),m,f,_[c+0],20,3921069994),g=i(g,m=i(m,f=i(f,p,g,m,_[c+5],5,3593408605),p,g,_[c+10],9,38016083),f,p,_[c+15],14,3634488961),m,f,_[c+4],20,3889429448),g=i(g,m=i(m,f=i(f,p,g,m,_[c+9],5,568446438),p,g,_[c+14],9,3275163606),f,p,_[c+3],14,4107603335),m,f,_[c+8],20,1163531501),g=i(g,m=i(m,f=i(f,p,g,m,_[c+13],5,2850285829),p,g,_[c+2],9,4243563512),f,p,_[c+7],14,1735328473),m,f,_[c+12],20,2368359562),g=n(g,m=n(m,f=n(f,p,g,m,_[c+5],4,4294588738),p,g,_[c+8],11,2272392833),f,p,_[c+11],16,1839030562),m,f,_[c+14],23,4259657740),g=n(g,m=n(m,f=n(f,p,g,m,_[c+1],4,2763975236),p,g,_[c+4],11,1272893353),f,p,_[c+7],16,4139469664),m,f,_[c+10],23,3200236656),g=n(g,m=n(m,f=n(f,p,g,m,_[c+13],4,681279174),p,g,_[c+0],11,3936430074),f,p,_[c+3],16,3572445317),m,f,_[c+6],23,76029189),g=n(g,m=n(m,f=n(f,p,g,m,_[c+9],4,3654602809),p,g,_[c+12],11,3873151461),f,p,_[c+15],16,530742520),m,f,_[c+2],23,3299628645),g=a(g,m=a(m,f=a(f,p,g,m,_[c+0],6,4096336452),p,g,_[c+7],10,1126891415),f,p,_[c+14],15,2878612391),m,f,_[c+5],21,4237533241),g=a(g,m=a(m,f=a(f,p,g,m,_[c+12],6,1700485571),p,g,_[c+3],10,2399980690),f,p,_[c+10],15,4293915773),m,f,_[c+1],21,2240044497),g=a(g,m=a(m,f=a(f,p,g,m,_[c+8],6,1873313359),p,g,_[c+15],10,4264355552),f,p,_[c+6],15,2734768916),m,f,_[c+13],21,1309151649),g=a(g,m=a(m,f=a(f,p,g,m,_[c+4],6,4149444226),p,g,_[c+11],10,3174756917),f,p,_[c+2],15,718787259),m,f,_[c+9],21,3951481745),f=r(f,l),p=r(p,u),g=r(g,d),m=r(m,h);return(s(f)+s(p)+s(g)+s(m)).toLowerCase()}},function(t,e){t.exports=function(t,e){var r,o=t.filePath,i=t.headers||{},n=t.url,a=t.method,s=t.onProgress,c=function(t,r){e(t,{statusCode:r.statusCode,headers:r.header},r.data)};if(o){var l,u=n.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/);t.pathStyle?(l=decodeURIComponent(u[3]||""),n=u[1]+u[2]):(l=decodeURIComponent(u[2]+u[3]||""),n=u[1]);var d={key:l,success_action_status:200,Signature:i.Authorization},h=["Cache-Control","Content-Type","Content-Disposition","Content-Encoding","Expires","x-cos-storage-class","x-cos-security-token"];for(var f in t.headers)t.headers.hasOwnProperty(f)&&(f.indexOf("x-cos-meta-")>-1||h.indexOf(f)>-1)&&(d[f]=t.headers[f]);i["x-cos-acl"]&&(d.acl=i["x-cos-acl"]),!d["Content-Type"]&&(d["Content-Type"]="");var p={};(r=wx.uploadFile({url:n,method:a,name:"file",filePath:o,formData:d,success:function(t){!t.header&&(t.header=p),c(null,t)},fail:function(t){c(t.errMsg,t)}})).onHeadersReceived&&r.onHeadersReceived(function(t){p=t.header}),r.onProgressUpdate(function(t){s({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend,progress:t.progress/100})})}else{var g=t.qs&&function(t){var e,r,o,i=[],n=Object.keys(t);for(e=0;e<n.length;e++)o=t[r=n[e]]||"",i.push(r+"="+encodeURIComponent(o));return i.join("&")}(t.qs)||"";g&&(n+=(n.indexOf("?")>-1?"&":"?")+g),i["Content-Length"]&&delete i["Content-Length"],wx.request({url:n,method:a,header:i,dataType:"text",data:t.body,success:function(t){c(null,t)},fail:function(t){c(t.errMsg,t)}})}return r}},function(t,e,r){var o=r(11).DOMParser,i=function(t){"use strict";void 0===(t=t||{}).escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!1),t.xmlElementsFilter=t.xmlElementsFilter||[],t.jsonPropertiesFilter=t.jsonPropertiesFilter||[],void 0===t.keepCData&&(t.keepCData=!1);var e={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function r(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function i(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t}function n(t,e,r,o){for(var i=0;i<t.length;i++){var n=t[i];if("string"==typeof n){if(n==o)break}else if(n instanceof RegExp){if(n.test(o))break}else if("function"==typeof n&&n(e,r,o))break}return i!=t.length}function a(e,r,o){switch(t.arrayAccessForm){case"property":e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]}!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0&&n(t.arrayAccessFormPaths,e,r,o)&&(e[r]=[e[r]])}function s(t){var e=t.split(/[-T:+Z]/g),r=new Date(e[0],e[1]-1,e[2]),o=e[5].split(".");if(r.setHours(e[3],e[4],o[0]),o.length>1&&r.setMilliseconds(o[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(t)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function c(r,o,i,a){return!(o==e.ELEMENT_NODE&&t.xmlElementsFilter.length>0)||n(t.xmlElementsFilter,r,i,a)}function l(o,i){if(o.nodeType==e.DOCUMENT_NODE){for(var u=new Object,d=o.childNodes,h=0;h<d.length;h++)(f=d.item(h)).nodeType==e.ELEMENT_NODE&&(u[p=r(f)]=l(f,p));return u}if(o.nodeType==e.ELEMENT_NODE){for((u=new Object).__cnt=0,d=o.childNodes,h=0;h<d.length;h++){var f,p=r(f=d.item(h));if(f.nodeType!=e.COMMENT_NODE){var g=i+"."+p;c(u,f.nodeType,p,g)&&(u.__cnt++,null==u[p]?(u[p]=l(f,g),a(u,p,g)):(null!=u[p]&&(u[p]instanceof Array||(u[p]=[u[p]],a(u,p,g))),u[p][u[p].length]=l(f,g)))}}for(var m=0;m<o.attributes.length;m++){var _=o.attributes.item(m);u.__cnt++,u[t.attributePrefix+_.name]=_.value}var y=o.prefix;return null!=y&&""!=y&&(u.__cnt++,u.__prefix=y),null!=u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),t.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"==t.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(e,r,o){if(t.datetimeAccessFormPaths.length>0){var i=o.split(".#")[0];return n(t.datetimeAccessFormPaths,e,r,i)?s(e):e}return e}(u.__text,p,i+"."+p)),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"==t.arrayAccessForm&&delete u["#cdata-section_asArray"]),0==u.__cnt&&"text"==t.emptyNodeForm?u="":1==u.__cnt&&null!=u.__text?u=u.__text:1!=u.__cnt||null==u.__cdata||t.keepCData?u.__cnt>1&&null!=u.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==u.__text||""==u.__text.trim())&&delete u.__text:u=u.__cdata,delete u.__cnt,!t.enableToStringFunc||null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}if(o.nodeType==e.TEXT_NODE||o.nodeType==e.CDATA_SECTION_NODE)return o.nodeValue}function u(e,r,o,n){var a="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+r;if(null!=o)for(var s=0;s<o.length;s++){var c=o[s],l=e[c];t.escapeMode&&(l=i(l)),a+=" "+c.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?a+='"'+l+'"':a+="'"+l+"'"}return a+(n?"/>":">")}function d(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function h(e,r){return"property"==t.arrayAccessForm&&(i="_asArray",-1!==(o=r.toString()).indexOf(i,o.length-i.length))||0==r.toString().indexOf(t.attributePrefix)||0==r.toString().indexOf("__")||e[r]instanceof Function;var o,i}function f(t){var e=0;if(t instanceof Object)for(var r in t)h(t,r)||e++;return e}function p(e,r,o){return 0==t.jsonPropertiesFilter.length||""==o||n(t.jsonPropertiesFilter,e,r,o)}function g(e){var r=[];if(e instanceof Object)for(var o in e)-1==o.toString().indexOf("__")&&0==o.toString().indexOf(t.attributePrefix)&&r.push(o);return r}function m(e){var r="";return e instanceof Object?r+=function(e){var r="";return null!=e.__cdata&&(r+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(t.escapeMode?r+=i(e.__text):r+=e.__text),r}(e):null!=e&&(t.escapeMode?r+=i(e):r+=e),r}function _(t,e){return""===t?e:t+"."+e}function y(t,e,r,o){var i="";if(0==t.length)i+=u(t,e,r,!0);else for(var n=0;n<t.length;n++)i+=u(t[n],e,g(t[n]),!1),i+=T(t[n],_(o,e)),i+=d(t[n],e);return i}function T(t,e){var r="";if(f(t)>0)for(var o in t)if(!h(t,o)&&(""==e||p(t,o,_(e,o)))){var i=t[o],n=g(i);null==i||null==i?r+=u(i,o,n,!0):i instanceof Object?i instanceof Array?r+=y(i,o,n,e):i instanceof Date?(r+=u(i,o,n,!1),r+=i.toISOString(),r+=d(i,o)):f(i)>0||null!=i.__text||null!=i.__cdata?(r+=u(i,o,n,!1),r+=T(i,_(e,o)),r+=d(i,o)):r+=u(i,o,n,!0):(r+=u(i,o,n,!1),r+=m(i),r+=d(i,o))}return r+m(t)}this.parseXmlString=function(t){var e;if(void 0===t)return null;if(o){var r=new o,i=null;try{i=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(t){i=null}try{e=r.parseFromString(t,"text/xml"),null!=i&&e.getElementsByTagNameNS(i,"parsererror").length>0&&(e=null)}catch(t){e=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t);return e},this.asArray=function(t){return void 0===t||null==t?[]:t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?s(t):t},this.xml2json=function(t){return l(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return T(t,"")},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return"1.2.0"}};t.exports=function(t){if(!t)return null;var e=(new o).parseFromString(t,"text/xml"),r=(new i).xml2json(e);return r.html&&r.getElementsByTagName("parsererror").length?null:r}},function(t,e,r){function o(t){this.options=t||{locator:{}}}function i(){this.cdata=!1}function n(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function a(t,e,r){return"string"==typeof t?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}function s(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}o.prototype.parseFromString=function(t,e){var r=this.options,o=new c,n=r.domBuilder||new i,a=r.errorHandler,s=r.locator,l=r.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&n.setDocumentLocator(s),o.errorHandler=function(t,e,r){if(!t){if(e instanceof i)return e;t=e}var o={},n=t instanceof Function;function a(e){var i=t[e];!i&&n&&(i=2==t.length?function(r){t(e,r)}:t),o[e]=i&&function(t){i("[xmldom "+e+"]\t"+t+function(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),o}(a,n,s),o.domBuilder=r.domBuilder||n,/\/x?html?$/.test(e)&&(u.nbsp=" ",u.copy="©",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",t?o.parse(t,l,u):o.errorHandler.error("invalid doc source"),n.doc},i.prototype={startDocument:function(){this.doc=(new l).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,o){var i=this.doc,a=i.createElementNS(t,r||e),c=o.length;s(this,a),this.currentElement=a,this.locator&&n(this.locator,a);for(var l=0;l<c;l++){t=o.getURI(l);var u=o.getValue(l),d=(r=o.getQName(l),i.createAttributeNS(t,r));this.locator&&n(o.getLocator(l),d),d.value=d.nodeValue=u,a.setAttributeNode(d)}},endElement:function(t,e,r){var o=this.currentElement;o.tagName,this.currentElement=o.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&n(this.locator,r),s(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=a.apply(this,arguments)){if(this.cdata)var o=this.doc.createCDATASection(t);else o=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(o):/^\s*$/.test(t)&&this.doc.appendChild(o),this.locator&&n(this.locator,o)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=a.apply(this,arguments);var o=this.doc.createComment(t);this.locator&&n(this.locator,o),s(this,o)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var o=this.doc.implementation;if(o&&o.createDocumentType){var i=o.createDocumentType(t,e,r);this.locator&&n(this.locator,i),s(this,i)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){i.prototype[t]=function(){return null}});var c=r(12).XMLReader,l=e.DOMImplementation=r(2).DOMImplementation;e.XMLSerializer=r(2).XMLSerializer,e.DOMParser=o},function(t,e){var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,o=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+r.source+o.source+"*(?::"+r.source+o.source+"*)?$"),n=0,a=1,s=2,c=3,l=4,u=5,d=6,h=7;function f(){}function p(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function g(t,e,r,o,i,f){for(var p,g=++e,m=n;;){var _=t.charAt(g);switch(_){case"=":if(m===a)p=t.slice(e,g),m=c;else{if(m!==s)throw new Error("attribute equal must after attrName");m=c}break;case"'":case'"':if(m===c||m===a){if(m===a&&(f.warning('attribute value must after "="'),p=t.slice(e,g)),e=g+1,!((g=t.indexOf(_,e))>0))throw new Error("attribute value no end '"+_+"' match");y=t.slice(e,g).replace(/&#?\w+;/g,i),r.add(p,y,e-1),m=u}else{if(m!=l)throw new Error('attribute value must after "="');y=t.slice(e,g).replace(/&#?\w+;/g,i),r.add(p,y,e),f.warning('attribute "'+p+'" missed start quot('+_+")!!"),e=g+1,m=u}break;case"/":switch(m){case n:r.setTagName(t.slice(e,g));case u:case d:case h:m=h,r.closed=!0;case l:case a:case s:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return f.error("unexpected end of input"),m==n&&r.setTagName(t.slice(e,g)),g;case">":switch(m){case n:r.setTagName(t.slice(e,g));case u:case d:case h:break;case l:case a:"/"===(y=t.slice(e,g)).slice(-1)&&(r.closed=!0,y=y.slice(0,-1));case s:m===s&&(y=p),m==l?(f.warning('attribute "'+y+'" missed quot(")!!'),r.add(p,y.replace(/&#?\w+;/g,i),e)):("http://www.w3.org/1999/xhtml"===o[""]&&y.match(/^(?:disabled|checked|selected)$/i)||f.warning('attribute "'+y+'" missed value!! "'+y+'" instead!!'),r.add(y,y,e));break;case c:throw new Error("attribute value missed!!")}return g;case"":_=" ";default:if(_<=" ")switch(m){case n:r.setTagName(t.slice(e,g)),m=d;break;case a:p=t.slice(e,g),m=s;break;case l:var y=t.slice(e,g).replace(/&#?\w+;/g,i);f.warning('attribute "'+y+'" missed quot(")!!'),r.add(p,y,e);case u:m=d}else switch(m){case s:r.tagName,"http://www.w3.org/1999/xhtml"===o[""]&&p.match(/^(?:disabled|checked|selected)$/i)||f.warning('attribute "'+p+'" missed value!! "'+p+'" instead2!!'),r.add(p,p,e),e=g,m=a;break;case u:f.warning('attribute space is required"'+p+'"!!');case d:m=a,e=g;break;case c:m=l,e=g;break;case h:throw new Error("elements closed character '/' and '>' must be connected to")}}g++}}function m(t,e,r){for(var o=t.tagName,i=null,n=t.length;n--;){var a=t[n],s=a.qName,c=a.value;if((h=s.indexOf(":"))>0)var l=a.prefix=s.slice(0,h),u=s.slice(h+1),d="xmlns"===l&&u;else u=s,l=null,d="xmlns"===s&&"";a.localName=u,!1!==d&&(null==i&&(i={},T(r,r={})),r[d]=i[d]=c,a.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,c))}for(n=t.length;n--;)(l=(a=t[n]).prefix)&&("xml"===l&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(a.uri=r[l||""]));var h;(h=o.indexOf(":"))>0?(l=t.prefix=o.slice(0,h),u=t.localName=o.slice(h+1)):(l=null,u=t.localName=o);var f=t.uri=r[l||""];if(e.startElement(f,u,o,t),!t.closed)return t.currentNSMap=r,t.localNSMap=i,!0;if(e.endElement(f,u,o),i)for(l in i)e.endPrefixMapping(l)}function _(t,e,r,o,i){if(/^(?:script|textarea)$/i.test(r)){var n=t.indexOf("</"+r+">",e),a=t.substring(e+1,n);if(/[&<]/.test(a))return/^script$/i.test(r)?(i.characters(a,0,a.length),n):(a=a.replace(/&#?\w+;/g,o),i.characters(a,0,a.length),n)}return e+1}function y(t,e,r,o){var i=o[r];return null==i&&((i=t.lastIndexOf("</"+r+">"))<e&&(i=t.lastIndexOf("</"+r)),o[r]=i),i<e}function T(t,e){for(var r in t)e[r]=t[r]}function b(t,e,r,o){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(i=t.indexOf("--\x3e",e+4))>e?(r.comment(t,e+4,i-e-4),i+3):(o.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var i=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,i-e-9),r.endCDATA(),i+3}var n=function(t,e){var r,o=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(t);r=i.exec(t);)if(o.push(r),r[1])return o}(t,e),a=n.length;if(a>1&&/!doctype/i.test(n[0][0])){var s=n[1][0],c=a>3&&/^public$/i.test(n[2][0])&&n[3][0],l=a>4&&n[4][0],u=n[a-1];return r.startDTD(s,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),u.index+u[0].length}}return-1}function v(t,e,r){var o=t.indexOf("?>",e);if(o){var i=t.substring(e,o).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,r.processingInstruction(i[1],i[2]),o+2):-1}return-1}function E(t){}function S(t,e){return t.__proto__=e,t}f.prototype={parse:function(t,e,r){var o=this.domBuilder;o.startDocument(),T(e,e={}),function(t,e,r,o,i){function n(t){var e=t.slice(1,-1);return e in r?r[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),r=56320+(1023&t);return String.fromCharCode(e,r)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(i.error("entity not found:"+t),t)}function a(e){if(e>T){var r=t.substring(T,e).replace(/&#?\w+;/g,n);d&&s(T),o.characters(r,0,e-T),T=e}}function s(e,r){for(;e>=l&&(r=u.exec(t));)c=r.index,l=c+r[0].length,d.lineNumber++;d.columnNumber=e-c+1}for(var c=0,l=0,u=/.*(?:\r\n?|\n)|.*$/g,d=o.locator,h=[{currentNSMap:e}],f={},T=0;;){try{var S=t.indexOf("<",T);if(S<0){if(!t.substr(T).match(/^\s*$/)){var D=o.doc,A=D.createTextNode(t.substr(T));D.appendChild(A),o.currentElement=A}return}switch(S>T&&a(S),t.charAt(S+1)){case"/":var C=t.indexOf(">",S+3),O=t.substring(S+2,C),R=h.pop();C<0?(O=t.substring(S+2).replace(/[\s<].*/,""),i.error("end tag name: "+O+" is not complete:"+R.tagName),C=S+1+O.length):O.match(/\s</)&&(O=O.replace(/[\s<].*/,""),i.error("end tag name: "+O+" maybe not complete"),C=S+1+O.length);var I=R.localNSMap,x=R.tagName==O;if(x||R.tagName&&R.tagName.toLowerCase()==O.toLowerCase()){if(o.endElement(R.uri,R.localName,O),I)for(var B in I)o.endPrefixMapping(B);x||i.fatalError("end tag name: "+O+" is not match the current start tagName:"+R.tagName)}else h.push(R);C++;break;case"?":d&&s(S),C=v(t,S,o);break;case"!":d&&s(S),C=b(t,S,o,i);break;default:d&&s(S);var P=new E,w=h[h.length-1].currentNSMap,N=(C=g(t,S,P,w,n,i),P.length);if(!P.closed&&y(t,C,P.tagName,f)&&(P.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),d&&N){for(var L=p(d,{}),k=0;k<N;k++){var M=P[k];s(M.offset),M.locator=p(d,{})}o.locator=L,m(P,o,w)&&h.push(P),o.locator=d}else m(P,o,w)&&h.push(P);"http://www.w3.org/1999/xhtml"!==P.uri||P.closed?C++:C=_(t,C,P.tagName,n,o)}}catch(t){i.error("element parse error: "+t),C=-1}C>T?T=C:a(Math.max(S,T)+1)}}(t,e,r,o,this.errorHandler),o.endDocument()}},E.prototype={setTagName:function(t){if(!i.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,r){if(!i.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},S({},S.prototype)instanceof S||(S=function(t,e){function r(){}for(e in r.prototype=e,r=new r,t)r[e]=t[e];return r}),e.XMLReader=f},function(t,e,r){var o=r(14),i=r(3).EventProxy,n=r(0);function a(t,e){var r=this,o=[],i={Bucket:t.Bucket,Region:t.Region,Prefix:t.Key},n=function(){r.multipartList(i,function(t,r){if(t)return e(t);o.push.apply(o,r.Upload||[]),"true"==r.IsTruncated?(i.KeyMarker=r.NextKeyMarker,i.UploadIdMarker=r.NextUploadIdMarker,n()):e(null,{UploadList:o})})};n()}var s={abortUploadTask:function(t,e){var r=t.Bucket,n=t.Region,s=t.Key,c=t.UploadId,l=t.Level||"task",u=t.AsyncLimit,d=this,h=new i;if(h.on("error",function(t){return e(t)}),h.on("get_abort_array",function(i){(function(t,e){var r=t.Bucket,i=t.Region,n=t.Key,a=t.AbortArray,s=t.AsyncLimit||1,c=this,l=0,u=new Array(a.length);o.eachLimit(a,s,function(e,o){var a=l;if(n&&n!==e.Key)return u[a]={error:{KeyNotMatch:!0}},void o(null);var s=e.UploadId||e.UploadID;c.multipartAbort({Bucket:r,Region:i,Key:e.Key,Headers:t.Headers,UploadId:s},function(t,n){var c={Bucket:r,Region:i,Key:e.Key,UploadId:s};u[a]={error:t,task:c},o(null)}),l++},function(t){if(t)return e(t);for(var r=[],o=[],i=0,n=u.length;i<n;i++){var a=u[i];a.task&&(a.error?o.push(a.task):r.push(a.task))}return e(null,{successList:r,errorList:o})})}).call(d,{Bucket:r,Region:n,Key:s,Headers:t.Headers,AsyncLimit:u,AbortArray:i},function(t,r){if(t)return e(t);e(null,r)})}),"bucket"===l)a.call(d,{Bucket:r,Region:n},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])});else if("file"===l){if(!s)return e({error:"abort_upload_task_no_key"});a.call(d,{Bucket:r,Region:n,Key:s},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])})}else{if("task"!==l)return e({error:"abort_unknown_level"});if(!c)return e({error:"abort_upload_task_no_id"});if(!s)return e({error:"abort_upload_task_no_key"});h.emit("get_abort_array",[{Key:s,UploadId:c}])}},sliceCopyFile:function(t,e){var r=new i,a=this,s=t.Bucket,c=t.Region,l=t.Key,u=t.CopySource,d=u.match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^/]+\/(.+)$/);if(d){var h=d[1],f=d[3],p=decodeURIComponent(d[4]),g=void 0===t.SliceSize?a.options.CopySliceSize:t.SliceSize;g=Math.max(0,Math.min(g,5368709120));var m,_,y=t.ChunkSize||this.options.CopyChunkSize,T=this.options.CopyChunkParallelLimit,b=0;r.on("copy_slice_complete",function(t){a.multipartComplete({Bucket:s,Region:c,Key:l,UploadId:t.UploadId,Parts:t.PartList},function(t,r){if(t)return _(null,!0),e(t);_({loaded:m,total:m},!0),e(null,r)})}),r.on("get_copy_data_finish",function(t){o.eachLimit(t.PartList,T,function(e,r){var i=e.PartNumber,n=e.CopySourceRange,d=e.end-e.start,h=0;(function(t,e){var r=t.TaskId,i=t.Bucket,n=t.Region,a=t.Key,s=t.CopySource,c=t.UploadId,l=1*t.PartNumber,u=t.CopySourceRange,d=this.options.ChunkRetryTimes+1,h=this;o.retry(d,function(e){h.uploadPartCopy({TaskId:r,Bucket:i,Region:n,Key:a,CopySource:s,UploadId:c,PartNumber:l,CopySourceRange:u,onProgress:t.onProgress},function(t,r){e(t||null,r)})},function(t,r){return e(t,r)})}).call(a,{Bucket:s,Region:c,Key:l,CopySource:u,UploadId:t.UploadId,PartNumber:i,CopySourceRange:n,onProgress:function(t){b+=t.loaded-h,h=t.loaded,_({loaded:b,total:m})}},function(t,o){if(t)return r(t);_({loaded:b,total:m}),b+=d-h,e.ETag=o.ETag,r(t||null,o)})},function(o){if(o)return _(null,!0),e(o);r.emit("copy_slice_complete",t)})}),r.on("get_file_size_finish",function(o){var i;!function(){for(var e=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],r=1048576,o=0;o<e.length&&!(m/(r=1024*e[o]*1024)<=a.options.MaxPartNumber);o++);t.ChunkSize=y=Math.max(y,r);for(var i=Math.ceil(m/y),n=[],s=1;s<=i;s++){var c=(s-1)*y,l=s*y<m?s*y-1:m-1,u={PartNumber:s,start:c,end:l,CopySourceRange:"bytes="+c+"-"+l};n.push(u)}t.PartList=n}(),(i="Replaced"===t.Headers["x-cos-metadata-directive"]?t.Headers:o)["x-cos-storage-class"]=t.Headers["x-cos-storage-class"]||o["x-cos-storage-class"],i=n.clearKey(i),a.multipartInit({Bucket:s,Region:c,Key:l,Headers:i},function(o,i){if(o)return e(o);t.UploadId=i.UploadId,r.emit("get_copy_data_finish",t)})}),a.headObject({Bucket:h,Region:f,Key:p},function(o,i){if(o)o.statusCode&&404===o.statusCode?e({ErrorStatus:p+" Not Exist"}):e(o);else if(void 0!==(m=t.FileSize=i.headers["content-length"])&&m)if(_=n.throttleOnProgress.call(a,m,t.onProgress),m<=g)t.Headers["x-cos-metadata-directive"]||(t.Headers["x-cos-metadata-directive"]="Copy"),a.putObjectCopy(t,function(t,r){if(t)return _(null,!0),e(t);_({loaded:m,total:m},!0),e(t,r)});else{var s=i.headers,c={"Cache-Control":s["cache-control"],"Content-Disposition":s["content-disposition"],"Content-Encoding":s["content-encoding"],"Content-Type":s["content-type"],Expires:s.expires,"x-cos-storage-class":s["x-cos-storage-class"]};n.each(s,function(t,e){0===e.indexOf("x-cos-meta-")&&e.length>"x-cos-meta-".length&&(c[e]=t)}),r.emit("get_file_size_finish",c)}else e({error:'get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.'})})}else e({error:"CopySource format error"})}};t.exports.init=function(t,e){n.each(s,function(e,r){t.prototype[r]=n.apiWrapper(r,e)})}},function(t,e){t.exports={eachLimit:function(t,e,r,o){if(o=o||function(){},!t.length||e<=0)return o();var i=0,n=0,a=0;!function s(){if(i>=t.length)return o();for(;a<e&&n<t.length;)a+=1,r(t[(n+=1)-1],function(e){e?(o(e),o=function(){}):(a-=1,(i+=1)>=t.length?o():s())})}()},retry:function(t,e,r){var o=function(i){e(function(e,n){e&&i<t?o(i+1):r(e,n)})};t<1?r():o(1)}}},function(t,e,r){"use strict";var o=r(9),i=r(1),n=r(0);function a(t){var e={GrantFullControl:[],GrantWrite:[],GrantRead:[],GrantReadAcp:[],GrantWriteAcp:[],ACL:""},r={FULL_CONTROL:"GrantFullControl",WRITE:"GrantWrite",READ:"GrantRead",READ_ACP:"GrantReadAcp",WRITE_ACP:"GrantWriteAcp"},o=t.AccessControlList.Grant;o&&(o=n.isArray(o)?o:[o]);var i={READ:0,WRITE:0,FULL_CONTROL:0};return o.length&&n.each(o,function(o){"qcs::cam::anyone:anyone"===o.Grantee.ID||"http://cam.qcloud.com/groups/global/AllUsers"===o.Grantee.URI?i[o.Permission]=1:o.Grantee.ID!==t.Owner.ID&&e[r[o.Permission]].push('id="'+o.Grantee.ID+'"')}),i.FULL_CONTROL||i.WRITE&&i.READ?e.ACL="public-read-write":i.READ?e.ACL="public-read":e.ACL="private",n.each(r,function(t){e[t]=s(e[t].join(","))}),e}function s(t){var e,r,o=t.split(","),i={};for(e=0;e<o.length;)i[r=o[e].trim()]?o.splice(e,1):(i[r]=!0,o[e]=r,e++);return o.join(",")}function c(t){var e=t.bucket,r=e.substr(0,e.lastIndexOf("-")),o=e.substr(e.lastIndexOf("-")+1),i=t.domain,a=t.region,s=t.object;i||(i=["cn-south","cn-south-2","cn-north","cn-east","cn-southwest","sg"].indexOf(a)>-1?"{Region}.myqcloud.com":"cos.{Region}.myqcloud.com",t.ForcePathStyle||(i="{Bucket}."+i)),i=(i=i.replace(/\{\{AppId\}\}/gi,o).replace(/\{\{Bucket\}\}/gi,r).replace(/\{\{Region\}\}/gi,a).replace(/\{\{.*?\}\}/gi,"")).replace(/\{AppId\}/gi,o).replace(/\{BucketName\}/gi,r).replace(/\{Bucket\}/gi,e).replace(/\{Region\}/gi,a).replace(/\{.*?\}/gi,""),/^[a-zA-Z]+:\/\//.test(i)||(i="https://"+i),"/"===i.slice(-1)&&(i=i.slice(0,-1));var c=i;return t.ForcePathStyle&&(c+="/"+e),c+="/",s&&(c+=n.camSafeUrlEncode(s).replace(/%2F/g,"/")),t.isLocation&&(c=c.replace(/^https?:\/\//,"")),c}function l(t,e){var r=n.clone(t.Headers);delete r["Content-Type"],delete r["Cache-Control"],n.each(r,function(t,e){""===t&&delete r[e]});var o=function(t){var r=!1,o=t.Authorization;if(o)if(o.indexOf(" ")>-1)r=!1;else if(o.indexOf("q-sign-algorithm=")>-1&&o.indexOf("q-ak=")>-1&&o.indexOf("q-sign-time=")>-1&&o.indexOf("q-key-time=")>-1&&o.indexOf("q-url-param-list=")>-1)r=!0;else try{(o=i.atob(o)).indexOf("a=")>-1&&o.indexOf("k=")>-1&&o.indexOf("t=")>-1&&o.indexOf("r=")>-1&&o.indexOf("b=")>-1&&(r=!0)}catch(t){}r?e&&e(null,t):e&&e("authorization error")},a=this,s=t.Bucket||"",c=t.Region||"",l="name/cos:PostObject"!==t.Action&&t.Key?t.Key:"";a.options.ForcePathStyle&&s&&(l=s+"/"+l);var u="/"+l,d={},h=t.Scope;if(!h){var f=t.Action||"",p=t.ResourceKey||t.Key||"";h=t.Scope||[{action:f,bucket:s,region:c,prefix:p}]}var g=n.md5(JSON.stringify(h));a._StsCache=a._StsCache||[],function(){var t,e;for(t=a._StsCache.length-1;t>=0;t--){e=a._StsCache[t];var r=Math.round(n.getSkewTime(a.options.SystemClockOffset)/1e3)+30;if(e.StartTime&&r<e.StartTime||r>=e.ExpiredTime)a._StsCache.splice(t,1);else if(!e.ScopeLimit||e.ScopeLimit&&e.ScopeKey===g){d=e;break}}}();var m,_=function(){var e=d.StartTime&&d.ExpiredTime?d.StartTime+";"+d.ExpiredTime:"",i={Authorization:n.getAuth({SecretId:d.TmpSecretId,SecretKey:d.TmpSecretKey,Method:t.Method,Pathname:u,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:a.options.SystemClockOffset,KeyTime:e}),XCosSecurityToken:d.XCosSecurityToken||"",Token:d.Token||"",ClientIP:d.ClientIP||"",ClientUA:d.ClientUA||""};o(i)};if(d.ExpiredTime&&d.ExpiredTime-n.getSkewTime(a.options.SystemClockOffset)/1e3>60)_();else if(a.options.getAuthorization)a.options.getAuthorization.call(a,{Bucket:s,Region:c,Method:t.Method,Key:l,Pathname:u,Query:t.Query,Headers:r,Scope:h},function(t){"string"==typeof t&&(t={Authorization:t}),t.TmpSecretId&&t.TmpSecretKey&&t.XCosSecurityToken&&t.ExpiredTime?((d=t||{}).Scope=h,d.ScopeKey=g,a._StsCache.push(d),_()):o(t)});else{if(!a.options.getSTS)return m={Authorization:n.getAuth({SecretId:t.SecretId||a.options.SecretId,SecretKey:t.SecretKey||a.options.SecretKey,Method:t.Method,Pathname:u,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:a.options.SystemClockOffset}),XCosSecurityToken:a.options.XCosSecurityToken},o(m),m;a.options.getSTS.call(a,{Bucket:s,Region:c},function(t){(d=t||{}).Scope=h,d.ScopeKey=g,d.TmpSecretId=d.SecretId,d.TmpSecretKey=d.SecretKey,a._StsCache.push(d),_()})}return""}function u(t,e){var r=this;!t.headers&&(t.headers={}),!t.qs&&(t.qs={}),t.VersionId&&(t.qs.versionId=t.VersionId),t.qs=n.clearKey(t.qs),t.headers&&(t.headers=n.clearKey(t.headers)),t.qs&&(t.qs=n.clearKey(t.qs));var i=n.clone(t.qs);t.action&&(i[t.action]="");var a=function(s){var u=r.options.SystemClockOffset;l.call(r,{Bucket:t.Bucket||"",Region:t.Region||"",Method:t.method,Key:t.Key,Query:i,Headers:t.headers,Action:t.Action,ResourceKey:t.ResourceKey,Scope:t.Scope},function(i,l){t.AuthData=l,function(t,e){var r=this,i=t.TaskId;if(!i||r._isRunningTask(i)){var a=t.Bucket,s=t.Region,l=t.Key,u=t.method||"GET",d=t.url,h=t.body,f=t.json,p=t.rawBody;d=d||c({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:a,region:s,object:l}),t.action&&(d=d+"?"+t.action);var g={method:u,url:d,headers:t.headers,qs:t.qs,filePath:t.filePath,body:h,json:f};g.headers.Authorization=t.AuthData.Authorization,t.AuthData.Token&&(g.headers.token=t.AuthData.Token),t.AuthData.ClientIP&&(g.headers.clientIP=t.AuthData.ClientIP),t.AuthData.ClientUA&&(g.headers.clientUA=t.AuthData.ClientUA),t.AuthData.XCosSecurityToken&&(g.headers["x-cos-security-token"]=t.AuthData.XCosSecurityToken),g.headers&&(g.headers=n.clearKey(g.headers)),g=n.clearKey(g),t.onProgress&&"function"==typeof t.onProgress&&(g.onProgress=function(e){if(!i||r._isRunningTask(i)){var o=e?e.loaded:0;t.onProgress({loaded:o,total:e.total})}}),r.options.ForcePathStyle&&(g.pathStyle=r.options.ForcePathStyle);var m=o(g,function(t,o,a){var s,c=function(t,a){if(i&&r.off("inner-kill-task",_),!s){s=!0;var c={};o&&o.statusCode&&(c.statusCode=o.statusCode),o&&o.headers&&(c.headers=o.headers),t?(t=n.extend(t||{},c),e(t,null)):(a=n.extend(a||{},c),e(null,a))}};if(t)c({error:t});else{var l;try{l=n.xml2json(a)||{}}catch(t){l=a||{}}var u=o.statusCode;2===Math.floor(u/100)?(p&&((l={}).body=a),l.Error?c({error:l.Error}):c(null,l)):c({error:l.Error||l})}}),_=function(t){t.TaskId===i&&(m&&m.abort&&m.abort(),r.off("inner-kill-task",_))};i&&r.on("inner-kill-task",_)}}.call(r,t,function(o,i){o&&s<2&&(u!==r.options.SystemClockOffset||function(t){var e=!1,r=!1,o=t.headers&&(t.headers.date||t.headers.Date)||"";try{var i=t.error.Code,a=t.error.Message;("RequestTimeTooSkewed"===i||"AccessDenied"===i&&"Request has expired"===a)&&(r=!0)}catch(t){}if(t)if(r&&o){var s=Date.parse(o);this.options.CorrectClockSkew&&Math.abs(n.getSkewTime(this.options.SystemClockOffset)-s)>=3e4&&(this.options.SystemClockOffset=s-Date.now(),e=!0)}else 5===Math.round(t.statusCode/100)&&(e=!0);return e}.call(r,o))?(t.headers&&(delete t.headers.Authorization,delete t.headers.token,delete t.headers.clientIP,delete t.headers.clientUA,delete t.headers["x-cos-security-token"]),a(s+1)):e(o,i)})})};a(0)}var d={getService:function(t,e){"function"==typeof t&&(e=t,t={});var r=this.options.ServiceDomain,o=t.AppId||this.options.appId,i=t.Region;r?(r=r.replace(/\{\{AppId\}\}/gi,o||"").replace(/\{\{Region\}\}/gi,i||"").replace(/\{\{.*?\}\}/gi,""),/^[a-zA-Z]+:\/\//.test(r)||(r="https://"+r),"/"===r.slice(-1)&&(r=r.slice(0,-1))):r=i?"https://cos."+i+".myqcloud.com":"https://service.cos.myqcloud.com",u.call(this,{Action:"name/cos:GetService",url:r+"/",method:"GET"},function(t,r){if(t)return e(t);var o=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Buckets&&r.ListAllMyBucketsResult.Buckets.Bucket||[];o=n.isArray(o)?o:[o];var i=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Owner||{};e(null,{Buckets:o,Owner:i,statusCode:r.statusCode,headers:r.headers})})},putBucket:function(t,e){var r=this,o={};o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-read-acp"]=t.GrantReadAcp,o["x-cos-grant-write-acp"]=t.GrantWriteAcp,o["x-cos-grant-full-control"]=t.GrantFullControl,u.call(this,{Action:"name/cos:PutBucket",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:o},function(o,i){if(o)return e(o);var n=c({domain:r.options.Domain,bucket:t.Bucket,region:t.Region,isLocation:!0});e(null,{Location:n,statusCode:i.statusCode,headers:i.headers})})},getBucket:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r.marker=t.Marker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,u.call(this,{Action:"name/cos:GetBucket",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListBucketResult||{},i=o.Contents||[],a=o.CommonPrefixes||[];i=n.isArray(i)?i:[i],a=n.isArray(a)?a:[a];var s=n.clone(o);n.extend(s,{Contents:i,CommonPrefixes:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},headBucket:function(t,e){u.call(this,{Action:"name/cos:HeadBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"HEAD"},function(t,r){e(t,r)})},deleteBucket:function(t,e){u.call(this,{Action:"name/cos:DeleteBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"DELETE"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketAcl:function(t,e){u.call(this,{Action:"name/cos:GetBucketACL",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var o=r.AccessControlPolicy||{},i=o.Owner||{},s=o.AccessControlList.Grant||[];s=n.isArray(s)?s:[s];var c=a(o);r.headers&&r.headers["x-cos-acl"]&&(c.ACL=r.headers["x-cos-acl"]),c=n.extend(c,{Owner:i,Grants:s,statusCode:r.statusCode,headers:r.headers}),e(null,c)})},putBucketAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var i=n.clone(t.AccessControlPolicy||{}),a=i.Grants||i.Grant;a=n.isArray(a)?a:[a],delete i.Grant,delete i.Grants,i.AccessControlList={Grant:a},o=n.json2xml({AccessControlPolicy:i}),r["Content-Type"]="application/xml",r["Content-MD5"]=n.binaryBase64(n.md5(o))}n.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=s(r[e]))}),u.call(this,{Action:"name/cos:PutBucketACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:r,action:"acl",body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketCors:function(t,e){u.call(this,{Action:"name/cos:GetBucketCORS",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchCORSConfiguration"===t.error.Code){var o={CORSRules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=r.CORSConfiguration||{},a=i.CORSRules||i.CORSRule||[];a=n.clone(n.isArray(a)?a:[a]),n.each(a,function(t){n.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[e],t[o]=n.isArray(i)?i:[i]})}),e(null,{CORSRules:a,statusCode:r.statusCode,headers:r.headers})}})},putBucketCors:function(t,e){var r=(t.CORSConfiguration||{}).CORSRules||t.CORSRules||[];r=n.clone(n.isArray(r)?r:[r]),n.each(r,function(t){n.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[o],t[e]=n.isArray(i)?i:[i]})});var o=n.json2xml({CORSConfiguration:{CORSRule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=n.binaryBase64(n.md5(o)),u.call(this,{Action:"name/cos:PutBucketCORS",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"cors",headers:i},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketCors:function(t,e){u.call(this,{Action:"name/cos:DeleteBucketCORS",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLocation:function(t,e){u.call(this,{Action:"name/cos:GetBucketLocation",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"location"},function(t,r){if(t)return e(t);e(null,r)})},putBucketTagging:function(t,e){var r=t.Tagging||{},o=r.TagSet||r.Tags||t.Tags||[];o=n.clone(n.isArray(o)?o:[o]);var i=n.json2xml({Tagging:{TagSet:{Tag:o}}}),a=t.Headers;a["Content-Type"]="application/xml",a["Content-MD5"]=n.binaryBase64(n.md5(i)),u.call(this,{Action:"name/cos:PutBucketTagging",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:i,action:"tagging",headers:a},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketTagging:function(t,e){u.call(this,{Action:"name/cos:GetBucketTagging",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"NoSuchTagSet"!==t.error.Code)e(t);else{var o={Tags:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else{var i=[];try{i=r.Tagging.TagSet.Tag||[]}catch(t){}i=n.clone(n.isArray(i)?i:[i]),e(null,{Tags:i,statusCode:r.statusCode,headers:r.headers})}})},deleteBucketTagging:function(t,e){u.call(this,{Action:"name/cos:DeleteBucketTagging",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketPolicy:function(t,e){u.call(this,{Action:"name/cos:GetBucketPolicy",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy",rawBody:!0},function(t,r){if(t)return t.statusCode&&403===t.statusCode?e({ErrorStatus:"Access Denied"}):t.statusCode&&405===t.statusCode?e({ErrorStatus:"Method Not Allowed"}):t.statusCode&&404===t.statusCode?e({ErrorStatus:"Policy Not Found"}):e(t);var o={};try{o=JSON.parse(r.body)}catch(t){}e(null,{Policy:o,statusCode:r.statusCode,headers:r.headers})})},putBucketPolicy:function(t,e){var r=t.Policy,o=r;try{"string"==typeof r?r=JSON.parse(o):o=JSON.stringify(r)}catch(t){e({error:"Policy format error"})}var i=t.Headers;i["Content-Type"]="application/json",i["Content-MD5"]=n.binaryBase64(n.md5(o)),u.call(this,{Action:"name/cos:PutBucketPolicy",method:"PUT",Bucket:t.Bucket,Region:t.Region,action:"policy",body:n.isBrowser?o:r,headers:i,json:!0},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketPolicy:function(t,e){u.call(this,{Action:"name/cos:DeleteBucketPolicy",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLifecycle:function(t,e){u.call(this,{Action:"name/cos:GetBucketLifecycle",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchLifecycleConfiguration"===t.error.Code){var o={Rules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=[];try{i=r.LifecycleConfiguration.Rule||[]}catch(t){}i=n.clone(n.isArray(i)?i:[i]),e(null,{Rules:i,statusCode:r.statusCode,headers:r.headers})}})},putBucketLifecycle:function(t,e){var r=(t.LifecycleConfiguration||{}).Rules||t.Rules||[];r=n.clone(r);var o=n.json2xml({LifecycleConfiguration:{Rule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=n.binaryBase64(n.md5(o)),u.call(this,{Action:"name/cos:PutBucketLifecycle",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"lifecycle",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketLifecycle:function(t,e){u.call(this,{Action:"name/cos:DeleteBucketLifecycle",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},putBucketVersioning:function(t,e){if(t.VersioningConfiguration){var r=t.VersioningConfiguration||{},o=n.json2xml({VersioningConfiguration:r}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=n.binaryBase64(n.md5(o)),u.call(this,{Action:"name/cos:PutBucketVersioning",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"versioning",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})}else e({error:"missing param VersioningConfiguration"})},getBucketVersioning:function(t,e){u.call(this,{Action:"name/cos:GetBucketVersioning",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"versioning"},function(t,r){t||!r.VersioningConfiguration&&(r.VersioningConfiguration={}),e(t,r)})},putBucketReplication:function(t,e){var r=n.clone(t.ReplicationConfiguration),o=n.json2xml({ReplicationConfiguration:r});o=(o=o.replace(/<(\/?)Rules>/gi,"<$1Rule>")).replace(/<(\/?)Tags>/gi,"<$1Tag>");var i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=n.binaryBase64(n.md5(o)),u.call(this,{Action:"name/cos:PutBucketReplication",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"replication",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketReplication:function(t,e){u.call(this,{Action:"name/cos:GetBucketReplication",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"ReplicationConfigurationnotFoundError"!==t.error.Code)e(t);else{var o={ReplicationConfiguration:{Rules:[]},statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else t||!r.ReplicationConfiguration&&(r.ReplicationConfiguration={}),r.ReplicationConfiguration.Rule&&(r.ReplicationConfiguration.Rules=r.ReplicationConfiguration.Rule,delete r.ReplicationConfiguration.Rule),e(t,r)})},deleteBucketReplication:function(t,e){u.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getObject:function(t,e){var r={};r["response-content-type"]=t.ResponseContentType,r["response-content-language"]=t.ResponseContentLanguage,r["response-expires"]=t.ResponseExpires,r["response-cache-control"]=t.ResponseCacheControl,r["response-content-disposition"]=t.ResponseContentDisposition,r["response-content-encoding"]=t.ResponseContentEncoding,u.call(this,{Action:"name/cos:GetObject",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers,qs:r,rawBody:!0},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0}):e(r)}var a={};if(a.Body=o.body,o&&o.headers){var s=o.headers;a.ETag=s.etag||s.Etag||s.ETag||""}n.extend(a,{statusCode:o.statusCode,headers:o.headers}),e(null,a)})},headObject:function(t,e){u.call(this,{Action:"name/cos:HeadObject",method:"HEAD",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0,statusCode:i}):e(r)}if(o.headers){var n=o.headers;o.ETag=n.etag||n.Etag||n.ETag||""}e(null,o)})},listObjectVersions:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r["key-marker"]=t.KeyMarker,r["version-id-marker"]=t.VersionIdMarker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,u.call(this,{Action:"name/cos:GetBucketObjectVersions",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"versions"},function(t,r){if(t)return e(t);var o=r.ListVersionsResult||{},i=o.DeleteMarker||[];i=n.isArray(i)?i:[i];var a=o.Version||[];a=n.isArray(a)?a:[a];var s=n.clone(o);delete s.DeleteMarker,delete s.Version,n.extend(s,{DeleteMarkers:i,Versions:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},putObject:function(t,e){var r=this,o=t.ContentLength,i=n.throttleOnProgress.call(r,o,t.onProgress);n.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(a){a&&(t.Headers["Content-MD5"]=n.binaryBase64(a)),void 0!==t.ContentLength&&(t.Headers["Content-Length"]=t.ContentLength),u.call(r,{Action:"name/cos:PutObject",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,body:t.Body,onProgress:i},function(n,a){if(n)return i(null,!0),e(n);if(i({loaded:o,total:o},!0),a&&a.headers){var s=a.headers,l=s.etag||s.Etag||s.ETag||"",u=c({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});return u=u.substr(u.indexOf("://")+3),e(null,{Location:u,ETag:l,statusCode:a.statusCode,headers:s})}e(null,a)})})},postObject:function(t,e){var r=this,o={};o["Cache-Control"]=t.CacheControl,o["Content-Disposition"]=t.ContentDisposition,o["Content-Encoding"]=t.ContentEncoding,o["Content-MD5"]=t.ContentMD5,o["Content-Length"]=t.ContentLength,o["Content-Type"]=t.ContentType,o.Expect=t.Expect,o.Expires=t.Expires,o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-full-control"]=t.GrantFullControl,o["x-cos-storage-class"]=t.StorageClass;var i=t.FilePath;for(var a in t)a.indexOf("x-cos-meta-")>-1&&(o[a]=t[a]);var s=n.throttleOnProgress.call(r,o["Content-Length"],t.onProgress);u.call(this,{Action:"name/cos:PostObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:o,filePath:i,onProgress:s},function(o,i){if(s(null,!0),o)return e(o);if(i&&i.headers){var n=i.headers,a=n.etag||n.Etag||n.ETag||"",l=c({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0});return e(null,{Location:l,statusCode:i.statusCode,headers:n,ETag:a})}e(null,i)})},deleteObject:function(t,e){u.call(this,{Action:"name/cos:DeleteObject",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,VersionId:t.VersionId},function(t,r){if(t){var o=t.statusCode;return o&&204===o?e(null,{statusCode:o}):o&&404===o?e(null,{BucketNotFound:!0,statusCode:o}):e(t)}e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectAcl:function(t,e){u.call(this,{Action:"name/cos:GetObjectACL",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var o=r.AccessControlPolicy||{},i=o.Owner||{},s=o.AccessControlList&&o.AccessControlList.Grant||[];s=n.isArray(s)?s:[s];var c=a(o);r.headers&&r.headers["x-cos-acl"]&&(c.ACL=r.headers["x-cos-acl"]),c=n.extend(c,{Owner:i,Grants:s,statusCode:r.statusCode,headers:r.headers}),e(null,c)})},putObjectAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var i=n.clone(t.AccessControlPolicy||{}),a=i.Grants||i.Grant;a=n.isArray(a)?a:[a],delete i.Grant,delete i.Grants,i.AccessControlList={Grant:a},o=n.json2xml({AccessControlPolicy:i}),r["Content-Type"]="application/xml",r["Content-MD5"]=n.binaryBase64(n.md5(o))}n.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=s(r[e]))}),u.call(this,{Action:"name/cos:PutObjectACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"acl",headers:r,body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},optionsObject:function(t,e){var r=t.Headers;r.Origin=t.Origin,r["Access-Control-Request-Method"]=t.AccessControlRequestMethod,r["Access-Control-Request-Headers"]=t.AccessControlRequestHeaders,u.call(this,{Action:"name/cos:OptionsObject",method:"OPTIONS",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:r},function(t,r){if(t)return t.statusCode&&403===t.statusCode?e(null,{OptionsForbidden:!0,statusCode:t.statusCode}):e(t);var o=r.headers||{};e(null,{AccessControlAllowOrigin:o["access-control-allow-origin"],AccessControlAllowMethods:o["access-control-allow-methods"],AccessControlAllowHeaders:o["access-control-allow-headers"],AccessControlExposeHeaders:o["access-control-expose-headers"],AccessControlMaxAge:o["access-control-max-age"],statusCode:r.statusCode,headers:r.headers})})},putObjectCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^/]+\/(.+)$/);if(r){var o=r[1],i=r[3],a=decodeURIComponent(r[4]);u.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:a},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(t,r){if(t)return e(t);var o=n.clone(r.CopyObjectResult||{});n.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},deleteMultipleObject:function(t,e){var r=t.Objects||[],o=t.Quiet;r=n.isArray(r)?r:[r];var i=n.json2xml({Delete:{Object:r,Quiet:o||!1}}),a=t.Headers;a["Content-Type"]="application/xml",a["Content-MD5"]=n.binaryBase64(n.md5(i));var s=n.map(r,function(e){return{action:"name/cos:DeleteObject",bucket:t.Bucket,region:t.Region,prefix:e.Key}});u.call(this,{Scope:s,method:"POST",Bucket:t.Bucket,Region:t.Region,body:i,action:"delete",headers:a},function(t,r){if(t)return e(t);var o=r.DeleteResult||{},i=o.Deleted||[],a=o.Error||[];i=n.isArray(i)?i:[i],a=n.isArray(a)?a:[a];var s=n.clone(o);n.extend(s,{Error:a,Deleted:i,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},restoreObject:function(t,e){var r=t.Headers;if(t.RestoreRequest){var o=t.RestoreRequest||{},i=n.json2xml({RestoreRequest:o});r["Content-Type"]="application/xml",r["Content-MD5"]=n.binaryBase64(n.md5(i)),u.call(this,{Action:"name/cos:RestoreObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,body:i,action:"restore",headers:r},function(t,r){e(t,r)})}else e({error:"missing param RestoreRequest"})},uploadPartCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^/]+\/(.+)$/);if(r){var o=r[1],i=r[3],a=decodeURIComponent(r[4]);u.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:a},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers},function(t,r){if(t)return e(t);var o=n.clone(r.CopyPartResult||{});n.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},multipartInit:function(t,e){u.call(this,{Action:"name/cos:InitiateMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"uploads",headers:t.Headers},function(t,r){return t?e(t):(r=n.clone(r||{}))&&r.InitiateMultipartUploadResult?e(null,n.extend(r.InitiateMultipartUploadResult,{statusCode:r.statusCode,headers:r.headers})):void e(null,r)})},multipartUpload:function(t,e){var r=this;n.getFileSize("multipartUpload",t,function(){n.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(o){o&&(t.Headers["Content-MD5"]=n.binaryBase64(o)),u.call(r,{Action:"name/cos:UploadPart",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers,onProgress:t.onProgress,body:t.Body||null},function(t,r){if(t)return e(t);if(r&&r.headers){var o=r.headers;r.ETag=o.etag||o.Etag||o.ETag||""}e(null,r)})})})},multipartComplete:function(t,e){for(var r=this,o=t.UploadId,i=t.Parts,a=0,s=i.length;a<s;a++)0!==i[a].ETag.indexOf('"')&&(i[a].ETag='"'+i[a].ETag+'"');var l=n.json2xml({CompleteMultipartUpload:{Part:i}}),d=t.Headers;d["Content-Type"]="application/xml",d["Content-MD5"]=n.binaryBase64(n.md5(l)),u.call(this,{Action:"name/cos:CompleteMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{uploadId:o},body:l,headers:d},function(o,i){if(o)return e(o);var a=c({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0}),s=i.CompleteMultipartUploadResult||{},l=n.extend(s,{Location:a,statusCode:i.statusCode,headers:i.headers});e(null,l)})},multipartList:function(t,e){var r={};r.delimiter=t.Delimiter,r["encoding-type"]=t.EncodingType,r.prefix=t.Prefix||"",r["max-uploads"]=t.MaxUploads,r["key-marker"]=t.KeyMarker,r["upload-id-marker"]=t.UploadIdMarker,r=n.clearKey(r),u.call(this,{Action:"name/cos:ListMultipartUploads",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"uploads"},function(t,r){if(t)return e(t);if(r&&r.ListMultipartUploadsResult){var o=r.ListMultipartUploadsResult.Upload||[],i=r.ListMultipartUploadsResult.CommonPrefixes||[];i=n.isArray(i)?i:[i],o=n.isArray(o)?o:[o],r.ListMultipartUploadsResult.Upload=o,r.ListMultipartUploadsResult.CommonPrefixes=i}var a=n.clone(r.ListMultipartUploadsResult||{});n.extend(a,{statusCode:r.statusCode,headers:r.headers}),e(null,a)})},multipartListPart:function(t,e){var r={};r.uploadId=t.UploadId,r["encoding-type"]=t.EncodingType,r["max-parts"]=t.MaxParts,r["part-number-marker"]=t.PartNumberMarker,u.call(this,{Action:"name/cos:ListParts",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListPartsResult||{},i=o.Part||[];i=n.isArray(i)?i:[i],o.Part=i;var a=n.clone(o);n.extend(a,{statusCode:r.statusCode,headers:r.headers}),e(null,a)})},multipartAbort:function(t,e){var r={};r.uploadId=t.UploadId,u.call(this,{Action:"name/cos:AbortMultipartUpload",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectUrl:function(t,e){var r=c({ForcePathStyle:this.options.ForcePathStyle,protocol:t.Protocol||this.options.Protocol,domain:this.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});if(void 0!==t.Sign&&!t.Sign)return e(null,{Url:r}),r;var o=l.call(this,{Action:"PUT"===(t.Method||"").toUpperCase()?"name/cos:PutObject":"name/cos:GetObject",Bucket:t.Bucket||"",Region:t.Region||"",Method:t.Method||"get",Key:t.Key,Expires:t.Expires},function(t,o){if(e)if(t)e(t);else{var i=r;i+="?"+(o.Authorization.indexOf("q-signature")>-1?o.Authorization:"sign="+encodeURIComponent(o.Authorization)),o.XCosSecurityToken&&(i+="&x-cos-security-token="+o.XCosSecurityToken),o.ClientIP&&(i+="&clientIP="+o.ClientIP),o.ClientUA&&(i+="&clientUA="+o.ClientUA),o.Token&&(i+="&token="+o.Token),setTimeout(function(){e(null,{Url:i})})}});return o?r+"?"+o.Authorization+(o.XCosSecurityToken?"&x-cos-security-token="+o.XCosSecurityToken:""):r},getAuth:function(t){return n.getAuth({SecretId:t.SecretId||this.options.SecretId||"",SecretKey:t.SecretKey||this.options.SecretKey||"",Method:t.Method,Key:t.Key,Query:t.Query,Headers:t.Headers,Expires:t.Expires,SystemClockOffset:this.options.SystemClockOffset})}};t.exports.init=function(t,e){e.transferToTaskMethod(d,"postObject"),n.each(d,function(e,r){t.prototype[r]=n.apiWrapper(r,e)})}},function(t,e,r){var o=r(0),i={};t.exports.transferToTaskMethod=function(t,e){i[e]=t[e],t[e]=function(t,r){t.SkipTask?i[e].call(this,t,r):this._addTask(e,t,r)}},t.exports.init=function(t){var e=[],r={},n=0,a=0,s=function(t){var e={id:t.id,Bucket:t.Bucket,Region:t.Region,Key:t.Key,FilePath:t.FilePath,state:t.state,loaded:t.loaded,size:t.size,speed:t.speed,percent:t.percent,hashPercent:t.hashPercent,error:t.error};return t.FilePath&&(e.FilePath=t.FilePath),e},c=function(){t.emit("list-update",{list:o.map(e,s)})},l=function(){var r;if(e.length>t.options.UploadQueueSize)for(r=0;r<e.length&&e.length>t.options.UploadQueueSize&&r<a;r++)e[r]&&"waiting"===e[r].state||(e.splice(r,1),a--)},u=function(){if(a<e.length&&n<t.options.FileParallelLimit){var r=e[a];if("waiting"===r.state){n++,r.state="checking";var s=o.formatParams(r.api,r.params);i[r.api].call(t,s,function(e,o){t._isRunningTask(r.id)&&("checking"!==r.state&&"uploading"!==r.state||(r.state=e?"error":"success",e&&(r.error=e),n--,c(),u(t),r.callback&&r.callback(e,o),"success"===r.state&&(r.params&&(delete r.params.Body,delete r.params),delete r.callback)),l())}),c()}a++,u(t)}},d=function(e,o){var i=r[e];if(i){var a=i&&"waiting"===i.state,s=i&&("checking"===i.state||"uploading"===i.state);if("canceled"===o&&"canceled"!==i.state||"paused"===o&&a||"paused"===o&&s){if("paused"===o&&i.params.Body&&"function"==typeof i.params.Body.pipe)return;i.state=o,t.emit("inner-kill-task",{TaskId:e,toState:o}),c(),s&&(n--,u(t)),"canceled"===o&&(i.params&&(delete i.params.Body,delete i.params),delete i.callback)}l()}};t._addTasks=function(e){o.each(e,function(e){t._addTask(e.api,e.params,e.callback,!0)}),c()},t._addTask=function(i,n,a,s){n=o.formatParams(i,n);var d=o.uuid();n.TaskId=d,n.TaskReady&&n.TaskReady(d);var h={params:n,callback:a,api:i,index:e.length,id:d,Bucket:n.Bucket,Region:n.Region,Key:n.Key,FilePath:n.FilePath||"",state:"waiting",loaded:0,size:0,speed:0,percent:0,hashPercent:0,error:null},f=n.onHashProgress;n.onHashProgress=function(e){t._isRunningTask(h.id)&&(h.hashPercent=e.percent,f&&f(e),c())};var p=n.onProgress;return n.onProgress=function(e){t._isRunningTask(h.id)&&("checking"===h.state&&(h.state="uploading"),h.loaded=e.loaded,h.size=e.total,h.speed=e.speed,h.percent=e.percent,p&&p(e),c())},r[d]=h,e.push(h),h.size=n.FileSize,!s&&c(),u(t),l(),d},t._isRunningTask=function(t){var e=r[t];return!(!e||"checking"!==e.state&&"uploading"!==e.state)},t.getTaskList=function(){return o.map(e,s)},t.cancelTask=function(t){d(t,"canceled")},t.pauseTask=function(t){d(t,"paused")},t.restartTask=function(t){var e=r[t];!e||"paused"!==e.state&&"error"!==e.state||(e.state="waiting",c(),a=Math.min(a,e.index),u())}}}])},t.exports=o()},function(t,e,r){var o,i=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(t,e){if(!o[t]){o[t]={};for(var r=0;r<t.length;r++)o[t][t.charAt(r)]=r}return o[t][e]}var n={compressToBase64:function(t){if(null==t)return"";var r=n._compress(t,6,function(t){return e.charAt(t)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,function(r){return i(e,t.charAt(r))})},compressToUTF16:function(e){return null==e?"":n._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:n._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=n.compress(t),r=new Uint8Array(2*e.length),o=0,i=e.length;o<i;o++){var a=e.charCodeAt(o);r[2*o]=a>>>8,r[2*o+1]=a%256}return r},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var r=new Array(e.length/2),o=0,i=r.length;o<i;o++)r[o]=256*e[2*o]+e[2*o+1];var a=[];return r.forEach(function(e){a.push(t(e))}),n.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":n._compress(t,6,function(t){return r.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,function(e){return i(r,t.charAt(e))}))},compress:function(e){return n._compress(e,16,function(e){return t(e)})},_compress:function(t,e,r){if(null==t)return"";var o,i,n,a={},s={},c="",l="",u="",d=2,h=3,f=2,p=[],g=0,m=0;for(n=0;n<t.length;n+=1)if(c=t.charAt(n),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=h++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(a,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<f;o++)g<<=1,m==e-1?(m=0,p.push(r(g)),g=0):m++;for(i=u.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1}else{for(i=1,o=0;o<f;o++)g=g<<1|i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i=0;for(i=u.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,f),f++),delete s[u]}else for(i=a[u],o=0;o<f;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,f),f++),a[l]=h++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<f;o++)g<<=1,m==e-1?(m=0,p.push(r(g)),g=0):m++;for(i=u.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1}else{for(i=1,o=0;o<f;o++)g=g<<1|i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i=0;for(i=u.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,f),f++),delete s[u]}else for(i=a[u],o=0;o<f;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,f),f++)}for(i=2,o=0;o<f;o++)g=g<<1|1&i,m==e-1?(m=0,p.push(r(g)),g=0):m++,i>>=1;for(;;){if(g<<=1,m==e-1){p.push(r(g));break}m++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:n._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,r,o){var i,n,a,s,c,l,u,d=[],h=4,f=4,p=3,g="",m=[],_={val:o(0),position:r,index:1};for(i=0;i<3;i+=1)d[i]=i;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(d[3]=u,n=u,m.push(u);;){if(_.index>e)return"";for(a=0,c=Math.pow(2,p),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;d[f++]=t(a),u=f-1,h--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=o(_.index++)),a|=(s>0?1:0)*l,l<<=1;d[f++]=t(a),u=f-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,p),p++),d[u])g=d[u];else{if(u!==f)return null;g=n+n.charAt(0)}m.push(g),d[f++]=n+g.charAt(0),n=g,0==--h&&(h=Math.pow(2,p),p++)}}};return n}();void 0===(o=function(){return i}.call(e,r,e,t))||(t.exports=o)},function(t,e){t.exports=o;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function o(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function i(t){return!0===(t&&t.__isLong__)}o.prototype.__isLong__,Object.defineProperty(o.prototype,"__isLong__",{value:!0}),o.isLong=i;var n={},a={};function s(t,e){var r,o,i;return e?(i=0<=(t>>>=0)&&t<256)&&(o=a[t])?o:(r=l(t,(0|t)<0?-1:0,!0),i&&(a[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(r=l(t,t<0?-1:0,!1),i&&(n[t]=r),r)}function c(t,e){if(isNaN(t))return e?y:_;if(e){if(t<0)return y;if(t>=p)return S}else{if(t<=-g)return D;if(t+1>=g)return E}return t<0?c(-t,e).neg():l(t%f|0,t/f|0,e)}function l(t,e,r){return new o(t,e,r)}o.fromInt=s,o.fromNumber=c,o.fromBits=l;var u=Math.pow;function d(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return _;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var o;if((o=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return d(t.substring(1),e,r).neg();for(var i=c(u(r,8)),n=_,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+s),r);if(s<8){var h=c(u(r,s));n=n.mul(h).add(c(l))}else n=(n=n.mul(i)).add(c(l))}return n.unsigned=e,n}function h(t,e){return"number"==typeof t?c(t,e):"string"==typeof t?d(t,e):l(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}o.fromString=d,o.fromValue=h;var f=4294967296,p=f*f,g=p/2,m=s(1<<24),_=s(0);o.ZERO=_;var y=s(0,!0);o.UZERO=y;var T=s(1);o.ONE=T;var b=s(1,!0);o.UONE=b;var v=s(-1);o.NEG_ONE=v;var E=l(-1,2147483647,!1);o.MAX_VALUE=E;var S=l(-1,-1,!0);o.MAX_UNSIGNED_VALUE=S;var D=l(0,-2147483648,!1);o.MIN_VALUE=D;var A=o.prototype;A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},A.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(D)){var e=c(t),r=this.div(e),o=r.mul(e).sub(this);return r.toString(t)+o.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=c(u(t,6),this.unsigned),n=this,a="";;){var s=n.div(i),l=(n.sub(s.mul(i)).toInt()>>>0).toString(t);if((n=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(D)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},A.isZero=function(){return 0===this.high&&0===this.low},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return 1==(1&this.low)},A.isEven=function(){return 0==(1&this.low)},A.equals=function(t){return i(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},A.eq=A.equals,A.notEquals=function(t){return!this.eq(t)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(t){return this.comp(t)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(t){return this.comp(t)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(t){return this.comp(t)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(t){return this.comp(t)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(t){if(i(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(D)?D:this.not().add(T)},A.neg=A.negate,A.add=function(t){i(t)||(t=h(t));var e=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,a=t.high>>>16,s=65535&t.high,c=t.low>>>16,u=0,d=0,f=0,p=0;return f+=(p+=n+(65535&t.low))>>>16,d+=(f+=o+c)>>>16,u+=(d+=r+s)>>>16,u+=e+a,l((f&=65535)<<16|(p&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},A.subtract=function(t){return i(t)||(t=h(t)),this.add(t.neg())},A.sub=A.subtract,A.multiply=function(t){if(this.isZero())return _;if(i(t)||(t=h(t)),r)return l(r.mul(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned);if(t.isZero())return _;if(this.eq(D))return t.isOdd()?D:_;if(t.eq(D))return this.isOdd()?D:_;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return c(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,o=65535&this.high,n=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,d=t.low>>>16,f=65535&t.low,p=0,g=0,y=0,T=0;return y+=(T+=a*f)>>>16,g+=(y+=n*f)>>>16,y&=65535,g+=(y+=a*d)>>>16,p+=(g+=o*f)>>>16,g&=65535,p+=(g+=n*d)>>>16,g&=65535,p+=(g+=a*u)>>>16,p+=e*f+o*d+n*u+a*s,l((y&=65535)<<16|(T&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},A.mul=A.multiply,A.divide=function(t){if(i(t)||(t=h(t)),t.isZero())throw Error("division by zero");var e,o,n;if(r)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return b;n=y}else{if(this.eq(D))return t.eq(T)||t.eq(v)?D:t.eq(D)?T:(e=this.shr(1).div(t).shl(1)).eq(_)?t.isNegative()?T:v:(o=this.sub(t.mul(e)),n=e.add(o.div(t)));if(t.eq(D))return this.unsigned?y:_;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=_}for(o=this;o.gte(t);){e=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(e)/Math.LN2),s=a<=48?1:u(2,a-48),d=c(e),f=d.mul(t);f.isNegative()||f.gt(o);)f=(d=c(e-=s,this.unsigned)).mul(t);d.isZero()&&(d=T),n=n.add(d),o=o.sub(f)}return n},A.div=A.divide,A.modulo=function(t){return i(t)||(t=h(t)),r?l((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return l(~this.low,~this.high,this.unsigned)},A.and=function(t){return i(t)||(t=h(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},A.or=function(t){return i(t)||(t=h(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},A.xor=function(t){return i(t)||(t=h(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},A.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?l(this.low>>>t|e<<32-t,e>>>t,this.unsigned):l(32===t?e:e>>>t-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},A.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},A.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},o.fromBytes=function(t,e,r){return r?o.fromBytesLE(t,e):o.fromBytesBE(t,e)},o.fromBytesLE=function(t,e){return new o(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},o.fromBytesBE=function(t,e){return new o(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(t,e,r){t.exports=function(){"use strict";var t,e,r,o,i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},n=function(){return(n=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},a=(s.prototype.indexOf=function(t,e){for(var r=0;r<t.length;r++)if(t[r].callback===e)return r;return-1},s.prototype.on=function(t,e,r){if(void 0===r&&(r=0),this){var o=this.__EventsList[t];if(o=o||(this.__EventsList[t]=[]),-1!==this.indexOf(o,e))return this;var i={name:t,type:r||0,callback:e};return o.push(i),this}},s.prototype.one=function(t,e){this.on(t,e,1)},s.prototype.remove=function(t,e){if(this){var r=this.__EventsList[t];if(!r)return null;if(!e){try{delete this.__EventsList[t]}catch(t){}return null}if(r.length){var o=this.indexOf(r,e);r.splice(o,1)}return this}},s);function s(){var t=this;this.emit=function(e,r){if(t){var o,i=t.__EventsList[e];if(i&&i.length){i=i.slice();for(var n=0;n<i.length;n++){o=i[n];try{var a=o.callback.apply(t,[r]);if(1===o.type&&t.remove(e,o.callback),!1===a)break}catch(e){throw e}}}return t}},this.__EventsList={}}function c(t){try{return encodeURIComponent(decodeURIComponent(t))}catch(t){return""}}function l(t){try{return(JSON.stringify(t,(e=[],r=[],function(t,o){if(o instanceof Error)return"Error.message【 "+o.message+" 】;  Error.stack【 "+o.stack+" 】";if("object"==typeof o&&null!==o){var i=e.indexOf(o);if(-1!==i)return"[Circular "+r[i]+"]";e.push(o),r.push(t||"root")}return o}),4)||"undefined").replace(/"/gim,"")}catch(t){return"error happen when aegis stringify: \n "+t.message+" \n "+t.stack}var e,r}(o=t=t||{}).INFO_ALL="-1",o.API_RESPONSE="1",o.INFO="2",o.ERROR="4",o.PROMISE_ERROR="8",o.AJAX_ERROR="16",o.SCRIPT_ERROR="32",o.IMAGE_ERROR="64",o.CSS_ERROR="128",o.CONSOLE_ERROR="256",o.MEDIA_ERROR="512",o.RET_ERROR="1024",o.REPORT="2048",(r=e=e||{})[r.number=-1]="number",r.string="";var u,d,h,f,p,g,m=["ret","retcode","code"];function _(t,e){this.type="fetch",this.data=t||{},this.data.response=e}function y(t){this.type="xhr",this.data=t}Object.defineProperty(y.prototype,"sourceURL",{get:function(){return this.data.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"status",{get:function(){return Number(this.data.status)},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"headers",{get:function(){var t=this.data.getAllResponseHeaders().split("\n"),e={};return t.forEach(function(t){if(t){var r=t.split(": "),o=r[0],i=r[1].trim();e[o]=i}}),e},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"sourceURL",{get:function(){return this.data.url},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"status",{get:function(){return Number(this.data.status)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"headers",{get:function(){var t={};return this.data.headers.forEach(function(e,r){t[r]=e}),t},enumerable:!0,configurable:!0}),(g=u=u||{})[g.android=1]="android",g[g.ios=2]="ios",g[g.other=100]="other",(p=d=d||{})[p.oldX5=1]="oldX5",p[p.newX5=2]="newX5",p[p.other=3]="other",(f=h=h||{})[f.unknown=100]="unknown",f[f.wifi=1]="wifi",f[f.net2g=2]="net2g",f[f.net3g=3]="net3g",f[f.net4g=4]="net4g",f[f.net5g=5]="net5g";var T=!(f[f.net6g=6]="net6g"),b=[],v=[],E=[],S=!1;function D(t,e){var r;void 0===t&&(t=0);var o=[];return function(i,n){if(o.push(i),e&&o.length>=e)return n(o.splice(0,o.length)),void(r&&clearTimeout(r));r&&clearTimeout(r),r=setTimeout(function(){r=null,n(o.splice(0,o.length))},t)}}function A(t,e){return Array.isArray(t)?e(t.map(function(t){return{msg:"string"==typeof t.msg?t.msg:[].concat(t.msg).map(l).join(" "),level:t.level}})):e({msg:"string"==typeof t.msg?t.msg:l(t.msg),level:t.level})}var C=function(){};function O(t){if(!t||!t.reduce||!t.length)throw new TypeError("createPipeline need at least one function param");return 1===t.length?function(e,r){t[0](e,r||C)}:t.reduce(function(t,e){return function(r,o){return void 0===o&&(o=C),t(r,function(t){return e&&e(t,o)})}})}var R=(I.prototype.init=function(t,e){var r=this;this.setConfig(t),I.installedPlugins.forEach(function(t){t.call(r,e)}),this.lifeCycle.emit("onInited")},I.prototype.setConfig=function(t){return Object.assign(this.config,t),this.bean.id=this.config.id||"",this.bean.uin=this.config.uin||"",this.bean.version=this.config.version||"1.23.2",this.lifeCycle.emit("onConfigChange",t),this.config},I.prototype.extendBean=function(t,e){this.bean[t]=e},I.use=function(t){-1===I.installedPlugins.indexOf(t)&&I.installedPlugins.push(t)},I.prototype.send=function(t,e,r){throw new Error('You need to override "send" method')},I.prototype._sendSDKError=function(t){this.send({url:"https://aegis.qq.com/collect?id=1085&msg[0]="+encodeURIComponent(l(t))+"&level[0]=2&from="+this.config.id+"&count=1&version="+this.config.id+"(1.23.2)",addBean:!1,method:"get"})},I.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this._normalLogPipeline({msg:e,level:t.INFO})},I.prototype.infoAll=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this._normalLogPipeline({msg:e,level:t.INFO_ALL})},I.prototype.report=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this._normalLogPipeline({msg:e,level:t.REPORT})},I.prototype.reportPv=function(t){t&&this.send({url:this.config.url+"/"+t,addBean:!1})},I.prototype.reportTime=function(t,e){"string"==typeof t&&"number"==typeof e&&this._submitCustomTime(t,e)},I.prototype.time=function(t){"string"==typeof t&&(this._timeMap[t]||(this._timeMap[t]=Date.now()))},I.prototype.timeEnd=function(t){"string"==typeof t&&this._timeMap[t]&&(this._submitCustomTime(t,Date.now()-this._timeMap[t]),delete this._timeMap[t])},I.prototype._submitCustomTime=function(t,e){this._customTimePipeline({name:t,duration:e})},I.installedPlugins=[],I.LOG_TYPE=t,I);function I(e){var r,o=this;this.config={version:0,delay:1500,repeat:5,random:1,url:"https://aegis.qq.com/collect",speedUrl:"https://aegis.qq.com/speed",customTimeUrl:"https://aegis.qq.com/speed/custom",whiteListUrl:"https://aegis.qq.com/aegis/whitelist",performanceUrl:"https://aegis.qq.com/speed/performance",listenOnerror:!0},this.lifeCycle=new a,this.bean={},this._normalLogPipeline=O([D(this.config.delay,5),A,(r=this.lifeCycle.emit,function(t,e){return r("beforeWrite",t),e(t)}),function(e){var r=!1,o=!1;setTimeout(function(){e.send({url:e.config.whiteListUrl||""},function(t){try{0===(t=JSON.parse(t)||{}).retcode&&(r=t.result.is_in_white_list)}catch(t){}o=!0},function(){o=!0})},50);var i=[];return function(e,n){if(r)n(e.concat(i.splice(0)).map(function(e){return e.level===t.INFO_ALL&&(e.level=t.INFO),e}));else{var a=e.filter(function(e){if(e.level!==t.INFO&&e.level!==t.API_RESPONSE)return e.level===t.INFO_ALL&&(e.level=t.INFO),!0;o||(i.push(e),200<=i.length&&(i.length=200))});a.length&&n(a)}}}(this),function(t,e){var r=JSON.parse(JSON.stringify(t));o.lifeCycle.emit("beforeReport",r);var i=o.config.beforeReport;if("function"==typeof i&&(t=t.filter(function(t){return!1!==i(t)})),t.length)return e(t)},function(t){o.send({url:o.config.url||"",data:function(t){return(t=Array.isArray(t)?t:[t]).map(function(t,e){return Object.getOwnPropertyNames(t).map(function(r){return c(r)+"["+e+"]="+c(t[r])}).join("&")}).join("&")+(t.length?"&count="+t.length:"")}(t),method:"post",contentType:"application/x-www-form-urlencoded"},function(){var e=o.config.onReport;"function"==typeof e&&t.forEach(function(t){e(t)})})}]),this._timeMap={},this._customTimePipeline=O([D(this.config.delay),function(t){o.send({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:t}))})}])}function x(){try{var t=getCurrentPages();return(t[t.length-1]||{}).route||""}catch(t){return""}}function B(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t[0]),o=1;o<t.length;o++){var i=t[o];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r[n]=i[n])}return r}function P(t,e){return""+t==""+e}function w(){var t=this;if(M.getFileSystemManager)try{var e=this.config,r=e.id,o=void 0===r?"":r,i=e.uin,n=void 0===i?0:i,a=e.url,s=void 0===a?"":a;if(!n)return;var c=new q({limit:this.config.offlineLogLime});this.lifeCycle.on("beforeReport",function(e){void 0===e&&(e=[]),c.save2Offline(e,t.config)}),c.ready(function(e){e||t.send({url:s+"/offlineAuto"},function(r){var i=(r.data.toString().match(/window\._badjsOfflineAuto\('(.*)'\)/)||[])[1];if(i){if(e)return;c.getLogs({id:o,uin:n},function(e,r,a,l){if(e);else{var u=B({logs:r,msgObj:a,urlObj:l,secretKey:i},{id:o,uin:n}),d=s+"/offlineLog";t.send({url:d,data:{offline_log:u},method:"post"},function(){c.clearLogs()})}})}})})}catch(t){}}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var e=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o){o=Object(o);for(var i=Object.keys(Object(o)),n=0,a=i.length;n<a;n++){var s=i[n],c=Object.getOwnPropertyDescriptor(o,s);void 0!==c&&c.enumerable&&(e[s]=o[s])}}}return e}});var N,L,k,M=wx||qq,q=(j.prototype.checkLimit=function(t,e){void 0===e&&(e=function(){});var r=this.fileSystem,o=this._filePath,i=this.limitSize;r.readFile({filePath:o,encoding:"utf8",success:function(n){var a=n.data;if((a=a.toString()+t).length>i){for(var s=a.split("\n"),c="",l=s.length-1;0<=l&&!(s[l]&&(c=s[l]+"\n"+c).length>i);l--);r.writeFile({filePath:o,data:c,success:e})}else r.appendFile({data:t,filePath:o,encoding:"utf8",success:e,fail:function(t){}})}})},j.prototype.getLogs=function(t,e){var r=this.fileSystem,o=this._filePath;r.readFile({filePath:o,encoding:"utf8",fail:function(t){},success:function(r){var o=r.data,i=(void 0===o?"":o).toString().split("\n").filter(function(t){return t}).map(function(t){return JSON.parse(t)}),n=[],a={},s=[],c={},l=[],u=0,d=0;i&&(n=i.map(function(e){if(P(e.id,t.id)&&P(e.uin,t.uin)){var r=e.from,o=e.level,i=e.msg,n=e.time,h=e.version;return"number"!=typeof a[i]&&(s.push(i),a[i]=u++),"number"!=typeof c[r]&&(l.push(r),c[r]=d++),{f:c[r],l:o,m:a[i],t:n,v:h}}})),e(null,n,s,l)}})},j),F=M.request,U=(i(L=G,k=N=R),L.prototype=null===k?Object.create(k):(H.prototype=k.prototype,new H),Object.defineProperty(G.prototype,"_bean",{get:function(){var t=this;return Object.getOwnPropertyNames(this.bean).map(function(e){return e+"="+t.bean[e]}).join("&")+"&from="+encodeURIComponent(x())},enumerable:!0,configurable:!0}),G.prototype._initOfflineLog=function(){G.use(w)},G.prototype.uploadLogs=function(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.lifeCycle.emit("uploadLogs",t,e)},G.__version__="1.23.2",G._sessionID="session-"+Date.now(),G.asyncPluginIndex=0,G);function G(t){var e,r=N.call(this,t)||this;r._originRequest=F,r.send=function(t,e,o){if(t&&"string"==typeof t.url&&""!==t.url&&r.bean.id){var i=t.url;if(r.config.whiteListUrl===i){var n=e;e=function(t){n&&n(JSON.stringify(t.data))}}!1!==t.addBean&&(i=i+(-1===i.indexOf("?")?"?":"&")+r._bean),"get"===(t.method||"get").toLocaleLowerCase()?(i=function(t,e){if("string"!=typeof t)return"";if("object"==typeof e&&e){var r=Object.getOwnPropertyNames(e).map(function(t){var r=e[t];return t+"="+("string"==typeof r?encodeURIComponent(r):encodeURIComponent(JSON.stringify(r)))}).join("&").replace(/eval/gi,"evaI");return t+(-1===t.indexOf("?")?"?":"&")+r}return t}(i,t.data),r._originRequest({url:i,success:e,fail:o})):("string"==typeof t.data&&(t.data=t.data.replace(/eval/gi,"evaI")),r._originRequest({url:i,header:t.contentType?{"content-type":t.contentType}:void 0,method:"POST",data:t.data,success:e,fail:o}))}},r._speedLogPipeline=O([(e={},function(t,r){if(Array.isArray(t)){var o=t.filter(function(t){var r=!e[t.url];return e[t.url]=!0,r});o.length&&r(o)}else e[t.url]||r(t),e[t.url]=!0}),D(r.config.delay),function(t,e){r.lifeCycle.emit("beforeReportSpeed",t);var o=r.config.beforeReportSpeed;if("function"==typeof o&&(t=t.filter(function(t){return!1!==o(t)})),t.length)return e(t)},function(t){r.send({url:""+r.config.speedUrl,method:"post",data:function(t,e){var r={fetch:[],static:[]},o={};return Array.isArray(t)?t.forEach(function(t){r[t.type].push(t)}):r[t.type].push(t),o.payload=JSON.stringify(n({duration:r},e)),o}(t,r.bean)})}]);try{t.offlineLog&&r._initOfflineLog(),r.init(t,G),r.extendBean("sessionId",G._sessionID)}catch(t){r._sendSDKError(t)}return r}function H(){this.constructor=L}function j(t){var e,r,o=this,i=void 0===t?{}:t,n=i.path,a=void 0===n?"/.aegis.offline.log":n,s=i.limit,c=void 0===s?2e4:s;this.offlineBuffer=[],this.ready=function(t){o.fileSystem?setTimeout(function(){t(null)},0):(t(new Error("getFileSystemManager file")),o.offlineLog=!1)},this.insertLog=(e=null,r=[],function(t){r=r.concat(t),e=e||setTimeout(function(){e=null;var t=o,i=t.fileSystem,n=t._filePath,a=r.map(function(t){return JSON.stringify(t)}).join("\n")+"\n";if(a){var s=function(t){t?o.checkLimit(a,function(){r=[]}):i.writeFile({data:a,filePath:n,encoding:"utf8",fail:function(t){},success:function(){r=[]}})};i.access({path:n,success:function(){s(!0)},fail:function(){s()}})}},2e3)}),this.addLogs=function(t){o.fileSystem&&o.insertLog(t)},this.clearLogs=function(){var t=o,e=t.fileSystem,r=t._filePath;e.writeFile({filePath:r,data:"",fail:function(){e.unlinkSync(r)}})},this.save2Offline=function(t,e){Array.isArray(t)||(t=[t]);var r=t.map(function(t){return"string"==typeof t&&(t={msg:t}),B({id:e.id,uin:e.uin,time:Date.now()-0,version:e.version,from:x()},t)});o.fileSystem?o.insertLog(r):(o.fileSystem||o.offlineBuffer.length||o.ready(function(t){t||o.offlineBuffer.length&&(o.addLogs(o.offlineBuffer),o.offlineBuffer=[])}),o.offlineBuffer=o.offlineBuffer.concat(r))},this._filePath=M.env.USER_DATA_PATH+a,this.fileSystem=M.getFileSystemManager(),this.limitSize=c}return U.use(function(){E.push(this._normalLogPipeline),S||(S=!0,(wx||qq).onError(function(e){var r;e&&(r={msg:e,level:t.ERROR},E.forEach(function(t){t(r)}))}))}),U.use(function(){this.config.reportApiSpeed&&(b.push(this._speedLogPipeline),v.push(this._normalLogPipeline),T||(T=!0,function(){function e(e){var r=Date.now();return o(n(n({},e),{success:function(o){try{var i={method:e.method||"get",url:(s=e.url,"string"==typeof s?s.split("?")[0]||"":s),duration:Date.now()-r,status:0,isHttps:function(t){return/^https/.test(t)}(e.url),type:"fetch"};i.ret=function(t,e){try{"string"==typeof t&&(t=JSON.parse(t));var r=Object.getOwnPropertyNames(t).filter(function(t){return-1!==m.indexOf(t.toLowerCase())});return r.length?""+t[r[0]]:"unknown"}catch(t){return"unknown"}}(o.data),a=i,b.forEach(function(t){t(a)}),n={msg:"req url: "+i.url+" \nres time: "+i.duration+" \nres data: "+JSON.stringify(o.data),level:t.API_RESPONSE},v.forEach(function(t){t(n)})}catch(o){}finally{e.success&&e.success(o)}var n,a,s}}))}var r=wx||qq,o=r.request;try{Object.defineProperty(r,"request",{get:function(){return e}})}catch(r){}}()))}),U.use(function(){var t=this;!function(t){var e=wx||qq;try{var r=e.getStorageSync("AEGIS_ID");r||(r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),e.setStorageSync("AEGIS_ID",r)),t(r||"")}catch(e){t("")}}(function(e){t.bean.aid=e})}),U}()},function(t,e,r){t.exports=function(){"use strict";var t=r(5),e=Function.bind.call(Function.call,Array.prototype.reduce),o=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),i=Function.bind.call(Function.call,Array.prototype.concat);return Object.values||(Object.values=function(r){return e(t(r),function(t,e){return i(t,"string"==typeof e&&o(r,e)?[r[e]]:[])},[])}),Object.entries||(Object.entries=function(r){return e(t(r),function(t,e){return i(t,"string"==typeof e&&o(r,e)?[[e,r[e]]]:[])},[])}),Object}()},function(t,e){"object"==typeof Reflect&&"function"==typeof Reflect.ownKeys?t.exports=Reflect.ownKeys:"function"==typeof Object.getOwnPropertySymbols?t.exports=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:t.exports=Object.getOwnPropertyNames},function(t,e,r){"use strict";function o(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),o=1;o<arguments.length;o++){var i=arguments[o];if(null!=i)for(var n=Object.keys(Object(i)),a=0,s=n.length;a<s;a++){var c=n[a],l=Object.getOwnPropertyDescriptor(i,c);void 0!==l&&l.enumerable&&(r[c]=i[c])}}return r}t.exports={assign:o,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:o})}}},function(t,e,r){"use strict";function o(){this.VERSION="2.5.0",this.REPORT_VERSION=this.VERSION+"_20200624_1909",this.MINIPROGRAM_REPORT_VERSION=this.VERSION+"_20200630_2136",this.NATIVEVERSION="web",this.PLATFORM="web",this.SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?sdkappid=",this.TEST_SERVER_URL="https://test.tim.qq.com/v4/ilvb_test/whiteboard?sdkappid=",this.COS_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/cos",this.TEST_COS_SERVER_URL="https://test.tim.qq.com/v4/ilvb_test/cos",this.WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whitelist?sdkappid=",this.TEST_WHITELIST_SERVER_URL="https://test.tim.qq.com/v4/ilvb_test/whitelist?sdkappid=",this.TRANSCODE_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/transcode?sdkappid=",this.TEST_TRANSCODE_SERVER_URL="https://test.tim.qq.com/v4/ilvb_test/transcode?sdkappid=",this.TEST_HEARTBEAT_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/report_heartbeat?sdkappid=",this.HEARTBEAT_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_heartbeat/report_heartbeat?sdkappid=",this.NOTIFY_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/notify?sdkappid=",this.TEST_NOTIFY_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/notify?sdkappid=",this.fontUrl="https://res.qcloudtiw.com/board/fonts/simhei-Regular.ttf",this.SUB_CMD={GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},this.CDN_DOMAIN="qcloudtiw.com",this.PROGRESS_ENABLE=!1,this.PROGRESS_SHOW_DELAY=100,this.SYNC_VIDEO_STATUS_INTERVAL=3e3,this.SYNC_VIDEO_STATUS_PRECISION=3e3,this.COMMON_GROUP="#DEFAULT",this.COMMON_DEFAULT_BOARD="#DEFAULT",this.SCALE=100,this.MAX_SCALE=1600,this.MIN_SCALE=100,this.RATIO="16:9",this.THIN=100,this.SMOOTH_LEVEL=0,this.MIN_LINE_WIDTH=1,this.MIN_FONT_SIZE=1,this.TEXT_MAX_LENGTH=2e3,this.TEXT_SIZE=320,this.TEXT_COLOR=0,this.TEXT_FONT_FAMILY="customFontFamily,sans-serif,serif,monospace",this.DATA_SYNC_ENABLE=!0,this.PRELOAD_DEPTH=5,this.IMAGESFILE_MAX_URL_LENGTH=5e3,this.REALTIMEDATA_MAX_LENGTH=7e3,this.RENDER_INTERVAL=20,this.IMAGE_TIMEOUT=10,this.TEXT_FONT_STYLE={NORMAL:0,BOLD:1,ITALIC:2,BOLD_ITALIC:3},this.FILE_TYPE={IMG:0,H5PPT:1,VOD:2,LIVE:3,H5FILE:4,VODFILE:5,IMAGESFILE:6},this.VIDEO_STATUS={STOP:0,PLAY:1,PAUSE:2},this.VIDEO_ACTION={PASSIVE:1,API:2,EXCEPTIOIN:3},this.VIDEO_FORMAT={NONE:"",MP4:"mp4",M3U8:"m3u8",FLV:"flv",RTMP:"rtmp"},this.ABOUTBLANK="about:blank",this.penCursorIcon="https://res.qcloudtiw.com/board/icons/pen2.png",this.laserCursorIcon="https://res.qcloudtiw.com/board/icons/laserpen.png",this.defaultLoadingImage="https://res.qcloudtiw.com/board/icons/default-loading-96px.png",this.ICONS={0:{cursor:"auto"},1:{cursor:"none",url:this.penCursorIcon,offsetX:0,offsetY:0},2:{cursor:"auto"},3:{cursor:"none",url:this.laserCursorIcon,offsetX:32,offsetY:32},4:{cursor:"crosshair"},5:{cursor:"crosshair"},6:{cursor:"crosshair"},7:{cursor:"crosshair"},8:{cursor:"crosshair"},9:{cursor:"auto"},10:{cursor:"crosshair"},11:{cursor:"text"},12:{cursor:"move"}},this.PROTOCOL_ACTION={LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,INPUT_TEXT_ACTION:13,IMAGE_ELEMENT:20,H5Web_ELEMENT:21,FILE_MESSAGE_ACTION:40,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,FILE_CLEAR_ACTION:103,RESET_DATA_ACTION:104,SET_BOARD_RATIO_ACTION:105,SET_BOARD_FIT_MODE_ACTION:106,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,SWITCH_ACTION:401,ADD_FILE_ACTION:501,PPT_EVENT_ACTION:601,VIDEO_EVENT_ACTION:701,H5WEB_EVENT_ACTION:801}}r.r(e),o.prototype.setPlatform=function(t){this.PLATFORM=t},o.prototype.setNativeVersion=function(t){this.NATIVEVERSION=t};var i=new o,n=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq},a=r(2),s=r.n(a),c={performanceNow:0,serverTime:0,localTime:0,localServerTimeDiff:0,seq:0,getCurrentTimeStamp:function(){var t=0;return window&&window.performance&&window.performance.now?t=this.serverTime+parseInt(window.performance.now()-this.performanceNow):(isNaN(this.localServerTimeDiff)&&(this.localServerTimeDiff=0),t=Date.now()-this.localServerTimeDiff),t},getSeq:function(){var t=parseInt(this.getCurrentTimeStamp()/1e3);return 1*new s.a(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}},l={isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"==Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"==Object.prototype.toString.call(t)},isFile:function(t){return"[object File]"==Object.prototype.toString.call(t)},isUndefined:function(t){return"[object Undefined]"==Object.prototype.toString.call(t)},isNull:function(t){return"[object Null]"==Object.prototype.toString.call(t)},isNumber:function(t){return"[object Number]"==Object.prototype.toString.call(t)},isPromise:function(t){return"[object Promise]"==Object.prototype.toString.call(t)},decimalToRgba:function(t){6===t.length&&(t+="ff");var e=[];return t.replace(/../g,function(t,r){var o;o=3==e.length?parseInt(t,"0x10")/255:parseInt(t,"0x10"),e.push(o)}),"rgba("+e.join(",")+")"},hexToRgba:function(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),t="#"+e.join(""),"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+", 1)"},rgbaToDecimal:function(t){for(var e=t.toString().match(/[\d\.]+/g),r="",o=0;o<3;o++)r+=("0"+(0|Number(e[o])).toString(16)).slice(-2);var i="ff";return e.length>=4&&(i=("0"+(0|Number(Math.min(255,255*e[3]))).toString(16)).slice(-2)),r+i},dealColor:function(t){if(t<0)return"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+",1)";var e=parseInt(t).toString(16),r=e.substr(e.length-2,e.length)||0;return e=(e="000000"+(e=e.substr(0,e.length-2))).substring(e.length-6,e.length),this.decimalToRgba(e+r)},formatColor:function(t){var e=this.rgbaToDecimal(t);return parseInt(e,16)},getEffectivePoint:function(t,e){return t<=0?t=Math.floor(e/2):t>=1e4&&(t=1e4-Math.floor(e/2)),t},getAVSdkTimestamp:function(){var t=this.getTimeStamp()+"",e=t.substring(0,5)+"00000000",r=t.substr(5),o=parseInt(e,10).toString(2).substr(-32);return parseInt(o,2)+(4294967295&r)},getTimeStamp:function(){return c.getCurrentTimeStamp()},getSecondTime:function(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff:function(t){return this.getTimeStamp()-t},formatDateTime:function(t){var e=t?new Date(t):new Date,r=e.getFullYear(),o=e.getMonth()+1;o=o<10?"0"+o:o;var i=e.getDate();i=i<10?"0"+i:i;var n=e.getHours();n=n<10?"0"+n:n;var a=e.getMinutes(),s=e.getSeconds();return a=a<10?"0"+a:a,s=s<10?"0"+s:s,String(r)+String(o)+String(i)+String(n)+String(a)+String(s)},boardId2Fid:function(t){return t.substring(t.indexOf("#"))},boardId2Uid:function(t){if(t===i.COMMON_DEFAULT_BOARD)return"";var e="";try{e=(e=t.substring(0,t.match(/_\d+_\d+_#\w+$/).index)).substring(e.indexOf("_")+1)}catch(t){}return e},boardIdGetSeq:function(t){return t.match(/\d+_#/)[0].replace(/\D/gi,"")},isCosUrl:function(t){return t.indexOf("myqcloud.com")>-1&&t.indexOf("cos")>-1},cosUrlExtractFileName:function(t){t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e=t.substring(t.lastIndexOf("/")+1);return t.indexOf("-1257240443")>-1&&e.match(/\d+_/)&&(e=e.substr(e.match(/^\d+_/)[0].length)),decodeURIComponent(e)},fileDownLoadUrlToPreviewUrl:function(t){if(t.startsWith("https")||(t=t.startsWith("http")?t.replace("http","https"):"https://"+t),t.endsWith("/"))return t;t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e="//";t.indexOf(e)>-1&&(t=t.substring(t.indexOf(e)+e.length)),e=".";var r=t.indexOf(e);return e=".com","https://"+t.substr(0,r)+".preview.myqcloud.com"+t.substring(t.indexOf(e)+e.length)+"?cmd=doc_preview&of=pic&page="},fontStyle2CanvasFontStyle:function(t){var e="";return 0===t?e="":1===t?e="bold":2===t?e="italic":3===t&&(e="italic bold"),e+" "},maxCommonDivisor:function(t,e){return 0!=e?this.maxCommonDivisor(e,t%e):t},calcRatioWidthHeight:function(t,e){var r,o;try{var i=t.split(":");r=1*i[0],r=isNaN(r)?e.split(":")[0]:r,o=1*i[1],o=isNaN(o)?e.split(":")[1]:o}catch(t){return this.calcRatioWidthHeight(e)}return{ratioWidth:r,ratioHeight:o}},isMobile:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},isIOS:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/iphone|ipad|ipod/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},isIOS8910:function(){return!!this.isIOS()&&!!navigator.userAgent.toLowerCase().match(/OS (8|9|10)[_\d]* like Mac OS X/i)},isAndroid:function(){var t=navigator.userAgent.toLowerCase();return/android/i.test(t)},isTBS:function(){var t=navigator.userAgent.toLowerCase();return/tbs/i.test(t)},parseQueryString:function(t){for(var e={},r=[],o="",i="",n=t.substring(t.indexOf("?")+1,t.length).split("&"),a=0,s=n.length;a<s;a++)o=(r=n[a].split("="))[0],i=r[1],e[o]=i;return e},extractTouch:function(t){return t&&t.changedTouches&&t.changedTouches[0]?{clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,force:t.changedTouches[0].force,identifier:t.changedTouches[0].identifier,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY,radiusX:t.changedTouches[0].radiusX,radiusY:t.changedTouches[0].radiusY,rotationAngle:t.changedTouches[0].rotationAngle,screenX:t.changedTouches[0].screenX,screenY:t.changedTouches[0].screenY}:{}},extractTaskId:function(t){var e=t.match(".*/([0-9a-zA-Z-]+)_tiw/h5/.*");return e&&e.length>1?e[1]:t.substring(t.indexOf(".com/")+5,t.indexOf("/index.html"))},camelCase2CamelCase:function(t){if(this.isString(t))return t.replace(/(.)(.*)/,t.charAt(0).toUpperCase()+"$2");if(this.isObject(t)){var e={};for(var r in t)e[this.camelCase2CamelCase(r)]=t[r];return e}},CamelCase2camelCase:function(t){if(this.isString(t))return t.replace(/(.)(.*)/,t.charAt(0).toLowerCase()+"$2");if(this.isObject(t)){var e={};for(var r in t)e[this.CamelCase2camelCase(r)]=t[r];return e}},debounce:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,r=null;return function(){var o=this,i=arguments;clearTimeout(r),r=setTimeout(function(){t.apply(o,i)},e)}},calcPointAndBoardRightBorderDistance:function(t,e,r,o,i,n){return{distanceX:t-i/1e4*t,distanceY:r-n/1e4*r}},calcPointAndContainerRightBorderDistance:function(t,e,r,o,i,n,a,s){var c=0,l=0;return t<e?(c=t-a/1e4*t,l=r-s/1e4*r):(c=(t-e)/2+(50-i)*t/100+e-a/1e4*t,l=(r-o)/2+(50-n)*r/100+o-s/1e4*r),{distanceX:c,distanceY:l}},calcPointAndContainerLeftBorderDistance:function(t,e,r,o,i,n,a,s){var c=0,l=0;return t<e?(c=a/1e4*t,l=s/1e4*r):(c=a/1e4*t-(t-e)/2-(50-i)*t/100,l=s/1e4*r-(r-o)/2-(50-n)*r/100),{distanceX:c,distanceY:l}},compress:function(t){return t?r(1).compressToBase64(t):""},decompress:function(t){return t?r(1).decompressFromBase64(t):""},canvasTextAutoLine:function(t,e,r,o,i,n,a){var s=0,c=0,l=e.split("\n"),u=0,d=0,h=a||i-r-10-2-1,f=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,p=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return l.forEach(function(e,i){if(i>0&&(o+=n),s=0,c=0,""==e)t.fillText(e,r,o),u+=n,s=0;else for(var a=0,l=0;l<e.length;l++)f.test(e[l])||p.test(e[l])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,d=Math.max(d,s),s>h+t.measureText(e[l]).width/2&&(t.fillText(e.substring(c,l),r,o,h),d=Math.min(d,h),l>0&&(u+=n,o+=n),s=0,c=l,a<e.length&&(a++,--l)),l==e.length-1&&(t.fillText(e.substring(c,e.length),r,o,h),u+=n)}),[d,u]},renderTextAutoLine:function(t,e,r,o,i,n,a){var s=0,c=0,l=e.split("\n"),u=0,d=0,h=a||i-r-10-2-1,f=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,p=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return l.forEach(function(e,i){if(i>0&&(o+=n),s=0,c=0,""==e)t.fillText(e,r,o),u+=n,s=0;else for(var a=0;a<e.length&&(f.test(e[a])||p.test(e[a])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,d=Math.max(d,s),!(s>h&&(t.fillText(e.substring(c,a),r,o,h),d=Math.min(d,h),u+=n,o+=n,s=0,c=a,--a<0)));a++)a==e.length-1&&(t.fillText(e.substring(c,e.length),r,o,h),u+=n)}),[d,u]},calcCanvasTextWidthAndHeight:function(t,e,r,o,i,n){for(var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4,s=arguments.length>7?arguments[7]:void 0,c=0,l=e.split("\n"),u=0,d=0,h=Math.min(Math.max(i-r-Math.floor(100*i/1e4),0),a),f=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,p=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/,g=t.measureText("M").width,m=0,_=0;_<l.length;_++){var y=l[_];if(c=0,(u+=n)>s)break;if(""==y)m+=1,c=0;else{0!=_&&(m+=1);for(var T=!1,b=0,v=0;v<y.length;v++)if(f.test(y[v])||p.test(y[v])?c+=2*g:c+=g,d=Math.max(d,c),c>h){if(T=!0,d=Math.min(d,h),u+=n,c=0,0==v){b=y.length-v;break}if(u>s){b=y.length-v;break}if(--v<0)break}m+=y.length,T&&(m-=b)}}return{textWidth:d,textHeight:u,limitIndex:m}}};function u(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=e.time||l.getTimeStamp(),this.thin=e.thin,this.writing=e.writing,this.startSeq=e.belongSeq,this.endSeq=0,this.drawIndex=0,this.lines=[{action:e.action,x:e.x,y:e.y,w:e.w,belongSeq:e.belongSeq,seq:e.seq,timestamp:e.timestamp}],this.fitCurve=[],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}u.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=l.getEffectivePoint(t+this.thin,this.thin)),t-this.thin<this.border.minX&&(this.border.minX=l.getEffectivePoint(t-this.thin,this.thin)),e+this.thin>this.border.maxY&&(this.border.maxY=l.getEffectivePoint(e+this.thin,this.thin)),e-this.thin<this.border.minY&&(this.border.minY=l.getEffectivePoint(e-this.thin,this.thin))},u.prototype.sort=function(){this.lines.sort(function(t,e){return t.seq-e.seq})};var d=u,h=function(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=l.getTimeStamp(),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.style=e.style,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}},f=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}},p=function(t,e){this.action=e.action,this.user=t,this.type="raser",this.seq=e.seq,this.color=e.color,this.radius=e.radius,this.timestamp=e.timestamp,this.location={x:e.x,y:e.y},this.toolType=e.toolType||3},g=function(t,e){this.user=t,this.type="inputtext",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.scale=1,this.color=0,this.typeFace="",this.textSize=0,this.fontStyle=0,this.time=l.getTimeStamp(),this.text="",this.show=!0,this.textWidth=0,this.textHeight=0,this.location={x:e.x,y:e.y}},m={BOARD_ACTION_TYPE:{LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid",INPUTTEXT:"inputtext",MOUSE:"mouse",ZOOM:"zoom","GRAPH-STRAIGHTLINE":"graph-straightLine","GRAPH-ELLIPSE":"graph-ellipse"},BOARD_MODE:{BOARD:0,FILE:1},BACKGROUND_TYPE:{IMAGE:0,H5:1},FILL_MODE:{DEFAULT:0,LEFT:4,TOP:5,RIGHT:6,BOTTOM:7},COLOR:{RED:4278190335,WHITE:4294967295},EVENT:{HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",REAL_TIME_DATA:"real_time_data",ADD_DATA_ERROR:"add_data_error",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_FILE:"add_group",ADD_H5PPT_FILE:"add_h5ppt_file",DELETE_FILE:"delete_group",SWITCH_FILE:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload",BOARD_CAN_UNDO:"board_can_undo",BOARD_CAN_REDO:"board_can_redo",VERIFY_SDK_SUCC:"verify_sdk_succ",VERIFY_SDK_ERROR:"verify_sdk_error",CANVAS_MOUSEDOWN:"canvas_mousedown",CANVAS_MOUSEMOVE:"canvas_mousemove",CANVAS_MOUSEUP:"canvas_mouseup",CANVAS_MOUSELEAVE:"canvas_mouseleave",CANVAS_TOUCHSTART:"canvas_touchstart",CANVAS_TOUCHMOVE:"canvas_touchmove",CANVAS_TOUCHEND:"CANVAS_touchend",CANVAS_TOUCHCANCEL:"canvas_touchcancel",UPDATE_BACKGROUND_IMAGE_SUCCESS:"update_background_image_success",UPDATE_BACKGROUND_IMAGE_ERROR:"update_background_image_error",COS:{GET_SIGN_ERROR:"get_sign_error",TASK_READY:"task_ready",HASH_PROGRESS:"hash_progress",PROGRESS:"progress",GET_SIGN_SUCCESS:"get_sign_success",DOES_NOT_SUPPORT_UPLOAD:"does_not_support_upload",UPLOAD_SUCCESS:"upload_success",UPLOAD_ERROR:"upload_error"}}};function _(){this.wxSysData=wx.getSystemInfoSync(),this.waterUrl="https://report-log-lv0.api.qcloud.com"}_.prototype={events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},send:function(t,e){this.defDatas.brand=this.wxSysData.brand,this.defDatas.model=this.wxSysData.model,this.defDatas.platform=this.wxSysData.platform,this.defDatas.system=this.wxSysData.system,this.defDatas.weixinversion=this.wxSysData.version;try{e=this.fillDatas(e),wx.request({url:t,data:JSON.stringify(e),method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){},fail:function(t){}})}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:e[r]=void 0!==t[r]?t[r]:this.defDatas[r];return e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},defDatas:{action:"",version:i.MINIPROGRAM_REPORT_VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"miniprog",log_time:0,business:"ticsdk",roomid:0,boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:null,userAgent:null,cookie:null,brand:null,model:null,platform:null,system:null,weixinversion:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=this.waterUrl;this.send(r,Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:l.getTimeStamp()}))}catch(t){}}};var y=new _;function T(t){if(this.permissions=!1,this.reportEnable=!1,this.option=Object.assign({},t),!this.option.tlsData)throw new Error("not found sdkAppId|userId|userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found userId");if(!this.option.tlsData.userSig)throw new Error("not found userSig");this.BOARD_URL=(t.isTest?i.TEST_SERVER_URL:i.SERVER_URL)+this.option.tlsData.sdkAppId,this.COS_SERVER_URL=t.isTest?i.TEST_COS_SERVER_URL:i.COS_SERVER_URL,this.WHITELIST_SERVER_URL=(t.isTest?i.TEST_WHITELIST_SERVER_URL:i.WHITELIST_SERVER_URL)+this.option.tlsData.sdkAppId,this.TRANSCODE_SERVER_URL=(t.isTest?i.TEST_TRANSCODE_SERVER_URL:i.TRANSCODE_SERVER_URL)+this.option.tlsData.sdkAppId,this.HEARTBEAT_SERVER_URL=(t.isTest?i.TEST_HEARTBEAT_SERVER_URL:i.HEARTBEAT_SERVER_URL)+this.option.tlsData.sdkAppId,this.retryCount=3,this.retryRequestMap={}}T.prototype._generateRequestId=function(){return"".concat(Math.floor(1e7*Math.random()))},T.prototype.setPermissions=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.permissions=t},T.prototype.setReportEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.reportEnable=t},T.prototype.reportMsg=function(t,e,r){if(this.option.classId&&this.permissions&&this.reportEnable){var o={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.classId,10),board_data_list:t};this.postPromise(null,o).then(function(t){e(t.data)},function(t){r(t)})}},T.prototype.getBoardData=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o={first_time:t,cmd:"open_conf_svc",sub_cmd:"get_board_data_bulk",seq:c.getSeq(),conf_id:parseInt(this.option.classId,10),version:1};this.postPromise(null,o).then(function(r){e(r.data,t)},r)},T.prototype.getLineData=function(t,e,r){var o={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.classId,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.postPromise(null,o).then(function(t){e(t.data)},r)},T.prototype.getFileInfo=function(t,e,r){var o={cmd:"open_conf_svc",sub_cmd:"get_file",conf_id:parseInt(this.option.classId,10),fid:t.fid};this.postPromise(null,o).then(function(t){e(t.data)},r)},T.prototype.getDocTotalPage=function(t){return this.getPromise(t,{responseType:"blob"})},T.prototype.requestFileMessage=function(t){return this.getPromise(t,{responseType:"text"})},T.prototype.getCosAuthData=function(t){var e=this.COS_SERVER_URL+"?SdkAppId=".concat(this.option.tlsData.sdkAppId,"&Identifier=").concat(this.option.tlsData.identifier,"&UserSig=").concat(this.option.tlsData.userSig);return this.postPromise(e,{cmd:"open_cos_svc",sub_cmd:"get_cos_token_for_bucket",bucket:t,duration:300,version:2})},T.prototype.createTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(e,Object.assign({Action:"CreateTranscode"},l.camelCase2CamelCase(t),{IsStaticPPT:!0}))},T.prototype.describeTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(e,Object.assign({Action:"DescribeTranscode"},l.camelCase2CamelCase(t)))},T.prototype.applyPermissions=function(){var t=this.WHITELIST_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(t,{cmd:"open_conf_svc",sub_cmd:"verify_sdk",sdkappid:1*this.option.tlsData.sdkAppId,version:1})},T.prototype.heartbeat=function(t){var e=this.HEARTBEAT_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier+"&contenttype=json&random="+parseInt(1e8*Math.random(0,1));return this.postPromise(e,Object.assign({HeartbeatVersion:"1.0"},t))},T.prototype.postPromise=function(t,e,r){var o=this;return new Promise(function(i,n){!function t(e,r,i,n,a){e=e||o.BOARD_URL+"&usersig="+o.option.tlsData.userSig+"&identifier="+o.option.tlsData.identifier,i||(i=o._generateRequestId(),o.retryRequestMap[i]={times:0}),o.retryRequestMap[i].times++,wx.request({url:e,data:r,method:"POST",header:{"content-type":"application/json"},success:function(t){delete o.retryRequestMap[i],n(t)},fail:function(){o.retryRequestMap[i].times>o.retryCount?a({url:e,data:r,requestId:i}):setTimeout(function(){"open_conf_svc"===r.cmd&&"get_board_data_bulk"===r.sub_cmd&&!1===r.first_time&&(r.first_time=!0),t(e,r,i,n,a)},200)}})}(t,e,r,function(t){i(t)},function(t){n(t)})})},T.prototype.getPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise(function(r,o){wx.request({url:t,data:e,method:"GET",header:{"content-type":"application/json"},responseType:e.responseType||"arraybuffer",success:function(t){r(t)},fail:function(){o.apply(this,arguments)}})})};var b=T;function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var E={TEDU_BOARD_IMAGE_FIT_MODE_CENTER:0,TEDU_BOARD_IMAGE_FIT_MODE_LEFT:4,TEDU_BOARD_IMAGE_FIT_MODE_TOP:5,TEDU_BOARD_IMAGE_FIT_MODE_RIGHT:6,TEDU_BOARD_IMAGE_FIT_MODE_BOTTOM:7};"object"===("undefined"==typeof window?"undefined":v(window))&&(window.TEduBoardImageFitMode=E);var S=E;function D(t){this.request=t}D.prototype.setPreCallback=function(t){this.preCallback=t},D.prototype.setCallback=function(t){this.callback=t},D.prototype.reportCreateBoards=function(t,e){var r;if(0!==(r=Array.isArray(e)?e:[e]).length){var o=l.getTimeStamp();this.reportMsg([{type:"createBoards",seq:c.getSeq(),content:{fid:l.boardId2Fid(r[0]),createBoards:r,updateTime:l.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?y.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("createBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){y.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},D.prototype.reportDeleteBoard=function(t,e){var r=l.getTimeStamp();this.reportMsg([{type:"deleteBoards",seq:c.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?y.boardAction("deleteBoards",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):y.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(o){y.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},D.prototype.reportSetBoardBgColor=function(t,e){var r=l.getTimeStamp();this.reportMsg([{type:"setBoardBG",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp(),colorRGBA:e}}],function(o){o.ErrorCode||o.error_code?y.boardAction("setBoardBG",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):y.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(o){y.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},D.prototype.reportClear=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"clean",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("clean",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("clean",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},D.prototype.reportClearDraws=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"cleanDraws",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("cleanDraws",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},D.prototype.reportImage=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.BACKGROUND_TYPE.IMAGE,i=l.getTimeStamp();this.reportMsg([{type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:e,updateTime:l.getTimeStamp(),type:o,mode:r}}],function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o={};o[t]=e,y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})})},D.prototype.reportImages=function(t){for(var e=l.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var i;i=t.slice(100*r,100*(r+1)),this.reportMsg(i,function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})})}},D.prototype.reportSwitchBoard=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"switchBoard",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("switchBoard",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("switchBoard",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},D.prototype.reportGlobalBgColor=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"setGlobalBG",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?y.boardAction("setGlobalBG",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):y.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){y.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},D.prototype.reportAddLine=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"addLine",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("addLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})}):y.boardAction("addLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})},function(r){y.boardAction("addLine",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})})},D.prototype.reportAddText=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"addText",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("addText",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):y.boardAction("addText",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){y.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},D.prototype.reportDisplayLine=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"displayLine",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("displayLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):y.boardAction("displayLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){y.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},D.prototype.reportGraphData=function(t){var e=l.getTimeStamp();this.reportMsg(t,function(r){t.forEach(function(t){r.ErrorCode||r.error_code?y.boardAction(t.type,{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):y.boardAction(t.type,{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(r){t.forEach(function(t){y.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},D.prototype.reportAddFile=function(t){var e=t.fid,r=t.title,o=t.downloadURL,i=t.pageCount,n=t.currentPageIndex,a=t.currentPageStep,s=t.uid,u=t.timestamp,d=t.platform,h=t.type,f=l.getTimeStamp();this.reportMsg([{type:"addFile",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),fid:e,title:r,downloadURL:o,pageCount:i,currentPageIndex:n,currentPageStep:a,uid:s,timestamp:u,platform:d,type:h}}],function(t){t.ErrorCode||t.error_code?y.boardAction("addFile",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r}):y.boardAction("addFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})},function(t){y.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})})},D.prototype.reportDeleteFile=function(t){var e=l.getTimeStamp();this.reportMsg([{type:"deleteFile",seq:c.getSeq(),content:{fid:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("deleteFile",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):y.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){y.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},D.prototype.reportsetBoardRatio=function(t){this.reportMsg([{type:"setRatio",seq:c.getSeq(),content:{ratio:t}}],function(t){},function(t){})},D.prototype.reportCleanAll=function(){var t=l.getTimeStamp();this.reportMsg([{type:"cleanAll",seq:c.getSeq()}],function(e){e.ErrorCode||e.error_code?y.boardAction("cleanAll",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){y.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},D.prototype.reportMsg=function(t,e,r){var o=this;this.preCallback&&this.preCallback(t),this.request.reportMsg(t,function(r){e&&e(r),o.callback&&o.callback(t,null)},function(e){r&&r(e),o.callback&&o.callback(t,e)})};var A=D,C={postMessage:function(t,e){t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")},init:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"init",data:e},"*")},count:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"count"},"*")},getCurrentSlideIndex:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_slide_index"},"*")},getCurrentStepIndex:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_index"},"*")},getCurrentStepCount:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_count"},"*")},nextPage:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_page"},"*")},prevPage:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_page"},"*")},gotoNextStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_step_new",data:e},"*")},gotoPreviousStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_step_new",data:e},"*")},gotoSlide:function(t,e,r){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_slide",data:{slideIndex:e,autoStart:r}},"*")},gotoTimestamp:function(t,e,r,o,i){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp",data:{slideIndex:e,stepIndex:r,autoStart:o,timeOffset:i}},"*")},gotoTimestampNew:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp_new",data:{slideIndex:e.slideIndex,stepIndex:e.stepIndex,resetStep:e.resetStep,usePrevNextStepMethod:e.usePrevNextStepMethod,isPassive:e.isPassive}},"*")},clearIframeCache:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"clear_cache"},"*")},setFid:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"set_fid",data:e},"*")},pptAction:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"ppt_action",data:e},"*")},sendMouseEvent:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"mouse_event",data:e},"*")}};function O(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var R=function(){function t(e,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardId=e||"",this.backgroundUrl="",r&&(this.backgroundUrl=r.url||""),this.backgroundColor=o||""}var e,r;return e=t,(r=[{key:"setBoardId",value:function(t){this.boardId=t}},{key:"setBackgroundUrl",value:function(t){this.backgroundUrl=t}},{key:"getBoardId",value:function(){return this.boardId}},{key:"getBackgroundUrl",value:function(){return this.backgroundUrl}},{key:"setBackgroundColor",value:function(t){this.backgroundColor=t}},{key:"getBackgroundColor",value:function(){return this.backgroundColor}}])&&O(e.prototype,r),t}(),I={TEDU_BOARD_ERROR_INIT:1,TEDU_BOARD_ERROR_AUTH:2,TEDU_BOARD_ERROR_LOAD:3,TEDU_BOARD_ERROR_UPLOAD:4,TEDU_BOARD_ERROR_TIM_INVALID:5,TEDU_BOARD_ERROR_HISTORYDATA:6,TEDU_BOARD_ERROR_RUNTIME:7,TEDU_BOARD_ERROR_AUTH_TIMEOUT:8,TEDU_BOARD_ERROR_DATA_TOO_LARGE:9},x=0;function B(t,e){this.request=t,this.elkLog=e}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function N(t,e,r){return e&&w(t.prototype,e),r&&w(t,r),t}function L(t,e){return function(t){if(Array.isArray(t))return t}
/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */(t)||function(t,e){var r=[],o=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);o=!0);}catch(t){i=!0,n=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw n}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function k(t,e,r,o,i,n){var a,s,c,l=L(function(t,e,r){var o,i,n,a,s,c,l,u;i=0,n=t.length/2;var d=q(e,10);for(s=0,c=t.length;s<c;s++)l=t[s],u=F(e,r[s],d,10),(o=(a=G.subtract(H.q(e,u),l))[0]*a[0]+a[1]*a[1])>i&&(i=o,n=s);return[i,n]}(t,a=function(t,e,r,o){var i,n,a,s,c,l,u,d,h,f,p,g,m,_,y,T,b,v=t[0],E=t[t.length-1];for(i=[v,null,null,E],n=G.zeros_Xx2x2(e.length),m=0,_=e.length;m<_;m++)b=1-(T=e[m]),(a=n[m])[0]=G.mulItems(r,3*T*(b*b)),a[1]=G.mulItems(o,3*b*(T*T));for(s=[[0,0],[0,0]],c=[0,0],m=0,_=t.length;m<_;m++)T=e[m],a=n[m],s[0][0]+=G.dot(a[0],a[0]),s[0][1]+=G.dot(a[0],a[1]),s[1][0]+=G.dot(a[0],a[1]),s[1][1]+=G.dot(a[1],a[1]),y=G.subtract(t[m],H.q([v,v,E,E],T)),c[0]+=G.dot(a[0],y),c[1]+=G.dot(a[1],y);return l=s[0][0]*s[1][1]-s[1][0]*s[0][1],u=s[0][0]*c[1]-s[1][0]*c[0],d=c[0]*s[1][1]-c[1]*s[0][1],f=0===l?0:u/l,(h=0===l?0:d/l)<(p=1e-6*(g=G.vectorLen(G.subtract(v,E))))||f<p?(i[1]=G.addArrays(v,G.mulItems(r,g/3)),i[2]=G.addArrays(E,G.mulItems(o,g/3))):(i[1]=G.addArrays(v,G.mulItems(r,h)),i[2]=G.addArrays(E,G.mulItems(o,f))),i}(t,r,o,i),e),2);return s=l[0],c=l[1],n&&n({bez:a,points:t,params:e,maxErr:s,maxPoint:c}),[a,s,c]}function M(t,e,r){return r.map(function(r,o){return function(t,e,r){var o=G.subtract(H.q(t,r),e),i=H.qprime(t,r),n=G.mulMatrix(o,i),a=G.sum(G.squareItems(i))+2*G.mulMatrix(o,H.qprimeprime(t,r));return 0===a?r:r-n/a}(t,e[o],r)})}B.prototype.setPreCallback=function(t){this.preCallback=t},B.prototype.setCallback=function(t){this.callback=t},B.prototype.reportCreateBoards=function(t,e){var r,o=this;if(0!==(r=Array.isArray(e)?e:[e]).length){var i=l.getTimeStamp();this.reportMsg([{type:"createBoards",seq:c.getSeq(),content:{fid:l.boardId2Fid(r[0]),createBoards:r,updateTime:l.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?o.elkLog.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):o.elkLog.boardAction("createBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){o.elkLog.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},B.prototype.reportDeleteBoard=function(t,e){var r=this,o=l.getTimeStamp();this.reportMsg([{type:"deleteBoards",seq:c.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:l.getTimeStamp()}}],function(i){i.ErrorCode||i.error_code?r.elkLog.boardAction("deleteBoards",{action_result:i.ErrorCode?"ErrorCode:".concat(i.ErrorCode):"error_code:".concat(i.error_code),action_info:i.ErrorInfo||i.error_msg,time_consume:l.getTimeDiff(o),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):r.elkLog.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(o),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(i){r.elkLog.boardAction("deleteBoards",{action_result:-9999,action_info:i&&i.message,time_consume:l.getTimeDiff(o),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},B.prototype.reportSetBoardBgColor=function(t,e){var r=this,o=l.getTimeStamp();this.reportMsg([{type:"setBoardBG",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp(),colorRGBA:e}}],function(i){i.ErrorCode||i.error_code?r.elkLog.boardAction("setBoardBG",{action_result:i.ErrorCode?"ErrorCode:".concat(i.ErrorCode):"error_code:".concat(i.error_code),action_info:i.ErrorInfo||i.error_msg,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):r.elkLog.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(i){r.elkLog.boardAction("setBoardBG",{action_result:-9999,action_info:i&&i.message,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},B.prototype.reportClear=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"clean",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("clean",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("clean",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(o){e.elkLog.boardAction("clean",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportClearDraws=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"cleanDraws",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("cleanDraws",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(o){e.elkLog.boardAction("cleanDraws",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportImage=function(t,e){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.BACKGROUND_TYPE.IMAGE,n=l.getTimeStamp();this.reportMsg([{type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:e,updateTime:l.getTimeStamp(),type:i,mode:o}}],function(o){var i={};i[t]=e,o.ErrorCode||o.error_code?r.elkLog.boardAction("image",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(n),boardid:null,boardid_list:[i],to_boardId:null,color:null,file_id:null,file_title:null}):r.elkLog.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(n),boardid:null,boardid_list:[i],to_boardId:null,color:null,file_id:null,file_title:null})},function(o){var i={};i[t]=e,r.elkLog.boardAction("image",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(n),boardid:null,boardid_list:[i],to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportImages=function(t){for(var e=this,r=l.getTimeStamp(),o=0,i=Math.ceil(t.length/100);o<i;o++){var n;n=t.slice(100*o,100*(o+1)),this.reportMsg(n,function(o){var i=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,i.push(e)}),o.ErrorCode||o.error_code?e.elkLog.boardAction("image",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:i,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:i,to_boardId:null,color:null,file_id:null,file_title:null})},function(o){var i=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,i.push(e)}),e.elkLog.boardAction("image",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:i,to_boardId:null,color:null,file_id:null,file_title:null})})}},B.prototype.reportSwitchBoard=function(t){var e=this,r=t.boardId,o=t.fid,i=t.url,n=t.type,a=t.page,s=t.step,u=t.ratio,d=t.scale,h=l.getTimeStamp();this.reportMsg([{type:"switchBoard",seq:c.getSeq(),content:{boardId:r,fid:o,url:i,type:n,page:a,step:s,ratio:u,scale:d,updateTime:l.getTimeStamp()}}],function(t){t.ErrorCode||t.error_code?e.elkLog.boardAction("switchBoard",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(h),boardid:r,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):e.elkLog.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:l.getTimeDiff(h),boardid:r,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(t){e.elkLog.boardAction("switchBoard",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(h),boardid:r,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportGlobalBgColor=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"setGlobalBG",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),colorRGBA:t}}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("setGlobalBG",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):e.elkLog.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(o){e.elkLog.boardAction("setGlobalBG",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},B.prototype.reportAddLine=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"addLine",seq:c.getSeq(),content:t}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("addLine",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})}):e.elkLog.boardAction("addLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})},function(o){e.elkLog.boardAction("addLine",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,extra_info:JSON.stringify({belongSeq:t.belongSeq})})})},B.prototype.reportAddText=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"addText",seq:c.getSeq(),content:t}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("addText",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text}):e.elkLog.boardAction("addText",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text})},function(o){e.elkLog.boardAction("addText",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null,text:t.text})})},B.prototype.reportDisplayLine=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"displayLine",seq:c.getSeq(),content:t}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("displayLine",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):e.elkLog.boardAction("displayLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(o){e.elkLog.boardAction("displayLine",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},B.prototype.reportGraphData=function(t){var e=this,r=l.getTimeStamp();this.reportMsg(t,function(o){t.forEach(function(t){o.ErrorCode||o.error_code?e.elkLog.boardAction(t.type,{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):e.elkLog.boardAction(t.type,{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(o){t.forEach(function(t){e.elkLog.boardAction(t.type,{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},B.prototype.reportAddFile=function(t){var e=this,r=t.fid,o=t.title,n=t.downloadURL,a=t.pageCount,s=t.currentPageIndex,u=t.currentPageStep,d=t.uid,h=t.timestamp,f=t.platform,p=t.type,g=t.ratio,m=t.scale,_=t.isTranscodeFile,y=t.status,T=t.progress,b=l.getTimeStamp();this.reportMsg([{type:"addFile",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),fid:r,title:o,downloadURL:n,pageCount:a,currentPageIndex:s,currentPageStep:u,uid:d,timestamp:h,platform:f||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:g,scale:m,isTranscodeFile:_,status:y,progress:T}}],function(t){t.ErrorCode||t.error_code?e.elkLog.boardAction("addFile",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(b),extra_info:JSON.stringify({downloadURL:n,pageCount:a,currentPageIndex:s,currentPageStep:u,uid:d,timestamp:h,platform:f||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:g,scale:m,isTranscodeFile:_,status:y,progress:T}),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:r,file_title:o}):e.elkLog.boardAction("addFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(b),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:r,file_title:o,extra_info:JSON.stringify({downloadURL:n,pageCount:a,currentPageIndex:s,currentPageStep:u,uid:d,timestamp:h,platform:f||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:g,scale:m,isTranscodeFile:_,status:y,progress:T})})},function(t){e.elkLog.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(b),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:r,file_title:o,extra_info:JSON.stringify({downloadURL:n,pageCount:a,currentPageIndex:s,currentPageStep:u,uid:d,timestamp:h,platform:f||i.PLATFORM,type:p||i.FILE_TYPE.IMG,ratio:g,scale:m,isTranscodeFile:_,status:y,progress:T})})})},B.prototype.reportDeleteFile=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"deleteFile",seq:c.getSeq(),content:{fid:t,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("deleteFile",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):e.elkLog.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(o){e.elkLog.boardAction("deleteFile",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},B.prototype.reportDrag=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"drag",seq:c.getSeq(),content:t}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("drag",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)}):e.elkLog.boardAction("drag",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)})},function(o){e.elkLog.boardAction("drag",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)})})},B.prototype.reportsetBoardRatio=function(t){var e=this,r=l.getTimeStamp();this.reportMsg([{type:"setRatio",seq:c.getSeq(),content:t}],function(o){o.ErrorCode||o.error_code?e.elkLog.boardAction("setRatio",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)}):e.elkLog.boardAction("setRatio",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)})},function(o){e.elkLog.boardAction("setRatio",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),extra_info:JSON.stringify(t)})})},B.prototype.reportsetBoardContentFitMode=function(t){this.reportMsg([{type:"setBoardContentFitMode",seq:c.getSeq(),content:t}],function(t){},function(t){})},B.prototype.reportImageElement=function(t){var e=[];l.isArray(t)?t.forEach(function(t){e.push({type:"imageElement",seq:c.getSeq(),content:t})}):e.push({type:"imageElement",seq:c.getSeq(),content:t}),this.reportMsg(e,function(t){},function(t){})},B.prototype.reportElement=function(t){var e=[];l.isArray(t)?t.forEach(function(t){e.push({type:t.type,seq:c.getSeq(),content:t.property})}):e.push({type:t.type,seq:c.getSeq(),content:t.property}),this.reportMsg(e,function(t){},function(t){})},B.prototype.reportCleanAll=function(){var t=this,e=l.getTimeStamp();this.reportMsg([{type:"cleanAll",seq:c.getSeq()}],function(r){r.ErrorCode||r.error_code?t.elkLog.boardAction("cleanAll",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):t.elkLog.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){t.elkLog.boardAction("cleanAll",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportMsg=function(t,e,r){var o=this;this.preCallback&&this.preCallback(t),this.request.reportMsg(t,function(r){e&&e(r),o.callback&&o.callback(t,null)},function(e){r&&r(e),o.callback&&o.callback(t,e)})};var q=function(t,e){for(var r,o=[0],i=t[0],n=0,a=1;a<=e;a++)r=H.q(t,a/e),n+=G.vectorLen(G.subtract(r,i)),o.push(n),i=r;return o.map(function(t){return t/n})};function F(t,e,r,o){if(e<0)return 0;if(e>1)return 1;for(var i,n,a,s,c=1;c<=o;c++)if(e<=r[c]){a=(c-1)/o,n=c/o,s=(e-(i=r[c-1]))/(r[c]-i)*(n-a)+a;break}return s}function U(t,e){return G.normalize(G.subtract(t,e))}var G=function(){function t(){P(this,t)}return N(t,null,[{key:"zeros_Xx2x2",value:function(t){for(var e=[];t--;)e.push([0,0]);return e}},{key:"mulItems",value:function(t,e){return t.map(function(t){return t*e})}},{key:"mulMatrix",value:function(t,e){return t.reduce(function(t,r,o){return t+r*e[o]},0)}},{key:"subtract",value:function(t,e){return t.map(function(t,r){return t-e[r]})}},{key:"addArrays",value:function(t,e){return t.map(function(t,r){return t+e[r]})}},{key:"addItems",value:function(t,e){return t.map(function(t){return t+e})}},{key:"sum",value:function(t){return t.reduce(function(t,e){return t+e})}},{key:"dot",value:function(e,r){return t.mulMatrix(e,r)}},{key:"vectorLen",value:function(t){return Math.hypot.apply(Math,function(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(t))}},{key:"divItems",value:function(t,e){return t.map(function(t){return t/e})}},{key:"squareItems",value:function(t){return t.map(function(t){return t*t})}},{key:"normalize",value:function(t){return this.divItems(t,this.vectorLen(t))}}]),t}(),H=function(){function t(){P(this,t)}return N(t,null,[{key:"q",value:function(t,e){var r=1-e,o=G.mulItems(t[0],r*r*r),i=G.mulItems(t[1],3*r*r*e),n=G.mulItems(t[2],3*r*e*e),a=G.mulItems(t[3],e*e*e);return G.addArrays(G.addArrays(o,i),G.addArrays(n,a))}},{key:"qprime",value:function(t,e){var r=1-e,o=G.mulItems(G.subtract(t[1],t[0]),3*r*r),i=G.mulItems(G.subtract(t[2],t[1]),6*r*e),n=G.mulItems(G.subtract(t[3],t[2]),3*e*e);return G.addArrays(G.addArrays(o,i),n)}},{key:"qprimeprime",value:function(t,e){return G.addArrays(G.mulItems(G.addArrays(G.subtract(t[2],G.mulItems(t[1],2)),t[0]),6*(1-e)),G.mulItems(G.addArrays(G.subtract(t[3],G.mulItems(t[2],2)),t[1]),6*e))}}]),t}(),j=function(t,e,r){if(!Array.isArray(t))return[];var o=!0;if(t.forEach(function(e){Array.isArray(e)&&!e.some(function(t){return"number"!=typeof t})&&e.length===t[0].length||(o=!1)}),!o)return[];if((t=t.filter(function(e,r){return 0===r||!e.every(function(e,o){return e===t[r-1][o]})})).length<2)return[];var i=t.length,n=U(t[1],t[0]),a=U(t[i-2],t[i-1]);return function t(e,r,o,i,n){var a,s,c,l,u,d,h,f,p,g,m,_,y;if(2===e.length)return _=G.vectorLen(G.subtract(e[0],e[1]))/3,[a=[e[0],G.addArrays(e[0],G.mulItems(r,_)),G.addArrays(e[1],G.mulItems(o,_)),e[1]]];s=function(t){var e,r,o,i=[];return t.forEach(function(t,n){e=n?r+G.vectorLen(G.subtract(t,o)):0,i.push(e),r=e,o=t}),i=i.map(function(t){return t/r})}(e);var T=L(k(e,s,s,r,o,n),3);if(a=T[0],l=T[1],d=T[2],l<i)return[a];if(l<i*i)for(c=s,u=l,h=d,y=0;y<20;y++){var b=L(k(e,s,c=M(a,e,c),r,o,n),3);if(a=b[0],l=b[1],d=b[2],l<i)return[a];if(d===h){var v=l/u;if(v>.9999&&v<1.0001)break}u=l,h=d}if(m=[],(f=G.subtract(e[d-1],e[d+1])).every(function(t){return 0===t})){var E=[-(f=G.subtract(e[d-1],e[d]))[1],f[0]];f[0]=E[0],f[1]=E[1]}return p=G.normalize(f),g=G.mulItems(p,-1),(m=m.concat(t(e.slice(0,d+1),r,p,i,n))).concat(t(e.slice(d),g,o,i,n))}(t,n,a,e,r)};function V(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION,this.scale=e.scale,this.xOffsetRatio=e.xOffsetRatio,this.yOffsetRatio=e.yOffsetRatio,this.xOffset=e.xOffset,this.yOffset=e.yOffset}var e,r;return e=t,(r=[{key:"update",value:function(t){Object.assign(this,t),this.scale=Math.floor(this.scale)}},{key:"getReportData",value:function(){return{updateTime:l.getSecondTime(),xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4)),scale:Math.floor(this.scale)}}},{key:"getRealTimeData",value:function(){return{action:this.action,time:l.getTimeStamp(),seq:c.getSeq(),scale:Math.floor(this.scale),xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4))}}}])&&V(e.prototype,r),t}();function K(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var W=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={}}var e,r;return e=t,(r=[{key:"addDragData",value:function(t,e){this.data[t]||(this.data[t]=e)}},{key:"getDragData",value:function(t){return this.data[t]}},{key:"updateDragData",value:function(t,e){this.data[t].update(e)}}])&&K(e.prototype,r),t}();function z(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var X=function(){function t(e){var r=e.newEnterId,o=void 0===r?0:r,i=e.classId,n=e.request,a=e.log;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$request=n,this.elkLog=a,this.classId=Number(i),this.newEnterId=Number(o)||0,this.defaultTimeout=3e4,this.maxTimeout=10*this.defaultTimeout,this.timeout=this.defaultTimeout,this.status=!0,this.sto=null,this.maxRetry=10,this.retryCount=0,this.LastReportTime=0,this.visible=!0,this._heartbeatLifecycle="live"}var e,r;return e=t,(r=[{key:"beat",value:function(t){var e=this;clearTimeout(this.sto);var r={LastReportTime:this.LastReportTime,HeartbeatVersion:"2.0",RoomId:this.classId,HeartbeatList:[{BusinessType:"whiteboard",Submodule:"",CustomData:{Event:t}}],ClientVersion:i.VERSION,NewEnterId:this.newEnterId,UserAgent:navigator?navigator.userAgent:"",BackgroundState:this.visible?0:1};if("destroy"===this._heartbeatLifecycle)return Promise.reject();var o=l.getTimeStamp(),n=this.$request.heartbeat(r);return l.isPromise(n)?n.then(function(t){t.data.Response&&!t.data.Response.Error?(e.retryCount=0,e.LastReportTime=t.data.Response.ReportTime,e.timeout=1e3*t.data.Response.IntervalTime,e.trigger()):(e.retryCount++,e.timeout=Math.min(Math.ceil(e.retryCount/10)*e.defaultTimeout,e.maxTimeout),e.trigger(),e.reportElk(o,t.data))}).catch(function(t){e.retryCount++,e.timeout=Math.min(Math.ceil(e.retryCount/10)*e.defaultTimeout,e.maxTimeout),e.trigger(),e.reportElk(o,t)}):Promise.reject()}},{key:"trigger",value:function(){var t=this;clearTimeout(this.sto),this.sto=setTimeout(function(){t.beat(null).catch(function(t){})},this.timeout||this.defaultTimeout)}},{key:"setClassId",value:function(t){this.classId=Number(t)}},{key:"setVisible",value:function(t){this.visible=t;var e=[{name:t?"visible":"unvisible",timestamp:l.getSecondTime()}];this.beat(e).catch(function(t){})}},{key:"start",value:function(){var t=[{name:"init",timestamp:l.getSecondTime()}];this.beat(t).catch(function(t){})}},{key:"pause",value:function(){this.status=!1,clearTimeout(this.sto)}},{key:"resume",value:function(){this.status=!0,this.beat(null).catch(function(t){})}},{key:"destroy",value:function(){var t=this,e=[{name:"uninit",timestamp:l.getSecondTime()}];this.beat(e).then(function(){t._heartbeatLifecycle="destroy",clearTimeout(t.sto)}).catch(function(){t._heartbeatLifecycle="destroy",clearTimeout(t.sto)})}},{key:"reportElk",value:function(t,e){this.elkLog.report("heartbeat_error",{time_consume:l.getTimeStamp()-t,extra_info:JSON.stringify({retryCount:this.retryCount,error:e})})}}])&&z(e.prototype,r),t}(),J={TEDU_BOARD_WARNING_SYNC_DATA_PARSE_FAILED:1,TEDU_BOARD_WARNING_H5PPT_ALREADY_EXISTS:3,TEDU_BOARD_WANNING_ILLEGAL_OPERATION:5,TEDU_BOARD_WARNING_H5FILE_ALREADY_EXISTS:6,TEDU_BOARD_WARNING_VIDEO_ALREADY_EXISTS:7,TEDU_BOARD_WARNING_IMAGESFILE_ALREADY_EXISTS:8},$={TEDU_BOARD_TEXT_STYLE_NORMAL:0,TEDU_BOARD_TEXT_STYLE_BOLD:1,TEDU_BOARD_TEXT_STYLE_ITALIC:2,TEDU_BOARD_TEXT_STYLE_BOLD_ITALIC:3},Z={TEDU_BOARD_UPLOAD_STATUS_SUCCEED:1,TEDU_BOARD_UPLOAD_STATUS_FAILED:2},Q=r(0),tt=r.n(Q),et={TEB_INIT:"TEB_INIT",TEB_OPERATE_CANUNDO_STATUS_CHANGED:"TEB_OPERATE_CANUNDO_STATUS_CHANGED",TEB_OPERATE_CANREDO_STATUS_CHANGED:"TEB_OPERATE_CANREDO_STATUS_CHANGED",TEB_ADDBOARD:"TEB_ADDBOARD",TEB_SYNCDATA:"TEB_SYNCDATA",TEB_ERROR:"TEB_ERROR",TEB_WARNING:"TEB_WARNING",TEB_HISTROYDATA_SYNCCOMPLETED:"TEB_HISTROYDATA_SYNCCOMPLETED",TEB_IMAGE_STATUS_CHANGED:"TEB_IMAGE_STATUS_CHANGED",TEB_H5BACKGROUND_STATUS_CHANGED:"TEB_H5BACKGROUND_STATUS_CHANGED",TEB_DELETEBOARD:"TEB_DELETEBOARD",TEB_GOTOBOARD:"TEB_GOTOBOARD",TEB_ADDH5PPTFILE:"TEB_ADDH5PPTFILE",TEB_ADDFILE:"TEB_ADDFILE",TEB_DELETEFILE:"TEB_DELETEFILE",TEB_FILEUPLOADSTATUS:"TEB_FILEUPLOADSTATUS",TEB_SWITCHFILE:"TEB_SWITCHFILE",TEB_SETBACKGROUNDIMAGE:"TEB_SETBACKGROUNDIMAGE",TEB_FILEUPLOADPROGRESS:"TEB_FILEUPLOADPROGRESS",TEB_LAYOUT:"TEB_LAYOUT",TEB_TRANSCODEPROGRESS:"TEB_TRANSCODEPROGRESS",TEB_ADDIMAGESFILE:"TEB_ADDIMAGESFILE"};function rt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ot(t,e,r){this.cos=null,this.options=Object.assign({sdkAppId:null,appid:null,bucket:null},t,{region:"ap-shanghai",path:"TIC/"}),this.request=e,this.userDataKeyMap={},this.event=r,this.bucketCosMap={},this.init(this.options)}ot.prototype.init=function(t){tt.a},ot.prototype.uploadImgFile=function(t){var e=this,r=t.path,o=t.userData,i=t.name,n=l.getTimeStamp();return this.uploadCosImageFile({filePath:r,fileName:i,userData:o}).then(function(t){e.event.fire(e,et.TEB_FILEUPLOADSTATUS,Z.TEDU_BOARD_UPLOAD_STATUS_SUCCEED,{code:0,errorMsg:"",userData:o});var r="https://".concat(t.Bucket,".file.myqcloud.com/").concat(t.Key);return Promise.resolve({fileName:i,fileUrl:r,userData:o})},function(t){return e.event.fire(e,et.TEB_FILEUPLOADSTATUS,Z.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:t.statusCode?t.statusCode:-3,errorMsg:JSON.stringify(t.error),userData:o}),Promise.reject(t)}).catch(function(t){e.event.fire(e,et.TEB_FILEUPLOADSTATUS,Z.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:-4,errorMsg:"stack:"+t.stack+" message:"+t.message,userData:o}),y.report("cos_upload_file",{action_result:2,action_info:"stack:"+t.stack+" message:"+t.message,time_consume:l.getTimeStamp()-n,extra_info:JSON.stringify({userData:o})})})},ot.prototype.uploadCosImageFile=function(t){var e=this,r=t.filePath,o=t.fileName,i=t.userData;return this.upload({path:this.options.path+this.options.sdkAppId+"/"+l.getTimeStamp()+"/"+o,filePath:r,userData:i,onProgress:function(t){e.event.fire(self,et.TEB_FILEUPLOADPROGRESS,Object.assign({userData:i},t))}})},ot.prototype.transcodeUploadFile=function(t){var e=l.getTimeStamp(),r=t.path,o=t.userData,i=t.name;return this.uploadCosFileFromTranscode({filePath:r,fileName:i,userData:o}).then(function(t){return Promise.resolve(t)},function(t){return Promise.reject(t)}).catch(function(t){y.report("cos_upload_file",{action_result:2,action_info:"stack:"+t.stack+" message:"+t.message,time_consume:l.getTimeStamp()-e,extra_info:JSON.stringify({userData:o})})})},ot.prototype.uploadCosFileFromTranscode=function(t){var e=this,r=t.filePath,o=t.fileName,i=t.userData;return this.upload({path:this.options.path+this.options.sdkAppId+"/"+l.getTimeStamp()+"/"+o,filePath:r,userData:i,onProgress:function(t){var r=Object.assign({userData:i},t);e.event.fire(e,et.TEB_FILEUPLOADPROGRESS,r),y.report(et.TEB_FILEUPLOADPROGRESS,{extra_info:JSON.stringify(r)})}})},ot.prototype.upload=function(t,e){var r=this;return new Promise(function(o,i){var n,a=(t.bucket||r.options.bucket)+"-"+(t.appid||r.options.appid),s=t.path,c="",u="",d="";e?(c="Body",u=t.body,d="putObject"):(c="FilePath",u=t.filePath,d="postObject");var h=r;r.bucketCosMap[a]?r.cos=r.bucketCosMap[a]:(r.cos=new tt.a({getAuthorization:function(t,e){var o=r.userDataKeyMap["/"+t.Query.prefix],i=t.Bucket.substr(0,t.Bucket.lastIndexOf("-"));r.request.getCosAuthData(i).then(function(t){try{if(t&&t.data&&0==t.data.error_code){var i=t.data;e({TmpSecretId:i.tmp_secret_id,TmpSecretKey:i.tmp_secret_key,XCosSecurityToken:i.session_token,ExpiredTime:i.expired_time})}else h.event.fire(r,"TEB_FILEUPLOADSTATUS",Z.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:t.data.error_code,userData:o,errorMsg:"get cos securitytoken fail, ".concat(t.data.error_msg)})}catch(t){h.event.fire(r,"TEB_FILEUPLOADSTATUS",Z.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:-1,userData:o,errorMsg:"get cos securitytoken fail"})}}).catch(function(t){h.event.fire(r,"TEB_FILEUPLOADSTATUS",Z.TEDU_BOARD_UPLOAD_STATUS_FAILED,{code:-2,userData:o,errorMsg:"get cos securitytoken fail"})})}}),r.bucketCosMap[a]=r.cos),r.cos[d]((rt(n={Bucket:a,Region:t.region||r.options.region,Key:s},c,u),rt(n,"onTaskReady",function(e){l.isFunction(t.onTaskReady)&&t.onTaskReady(e)}),rt(n,"onHashProgress",function(e){l.isFunction(t.onHashProgress)&&t.onHashProgress(e)}),rt(n,"onProgress",function(e){l.isFunction(t.onProgress)&&t.onProgress(e)}),n),function(e,r){r&&200===r.statusCode?(r=Object.assign({Bucket:a,Key:s},r),o(r),y.report("cos_upload_file",{time_consume:0,extra_info:JSON.stringify({bucket:a,userData:t.userData,data:r})})):(y.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(e),extra_info:JSON.stringify({bucket:a,userData:t.userData})}),i(e))})})};var it=ot;function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t){var e=this;this.event=t.event,this.options=JSON.parse(JSON.stringify(t)),this.context=t.context,this.maxSeq=0,this.maxAddTextSeq=0,this.maxMoveSeq=0,this.request=new b(t),this.report=new A(this.request),this.report.setCallback(function(t,r){r||e.addReportAckData(t)}),this.report.setPreCallback(function(t){e.addReportAckData(t,!1)}),this.permissions=0,"[object Undefined]"===Object.prototype.toString.call(t.syncHistroyEnable)||"[object Null]"===Object.prototype.toString.call(t.syncHistroyEnable)?this.syncHistroyEnable=!0:this.syncHistroyEnable=t.syncHistroyEnable,this.identifier=t.tlsData.identifier,this.classId=t.classId,this.user=t.tlsData.identifier,this.data={},this.progressEnable=i.PROGRESS_ENABLE,this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.pptFilePreloaded={},this.boardRatio={},this.dragDataList=new W,this.scale=this.options.scale||i.SCALE,this.ratio=this.options.ratio||i.RATIO,this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.color=0,this.thin=0,this.typeFace=i.TEXT_FONT_FAMILY,this.textSize=0,this.textColor="",this.fontStyle=$.TEDU_BOARD_TEXT_STYLE_NORMAL,this.smoothLevel=0,this.dataSyncEnable=!1,this.preloadDepth=0,this.globalBackgroundColor=0,this.type=null,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.reportAckDatas={},this.sendAckDatas={},this.beforeMoveType="",this.containerWidth=0,this.containerHeight=0,this.boardWidth=0,this.boardHeight=0,this.ctx=null,this.boardContentFitMode=0,this.imageTimeout=i.IMAGE_TIMEOUT,this.faceData=[],this.transcodeIntervalMap={},this.taskIdUserDataMap={},this.fileMessageCosInfo={bucket:null,appid:null,region:null},this.fileCos=null,y.setSdkAppid(t.tlsData.sdkAppId),y.setRoomId(this.classId),y.setUserId(t.tlsData.identifier),this.heartbeat=new X({classId:this.classId,request:this.request}),this.applyPermissions(function(){}),this.initInterval(),this.cosData={cosAppId:null,cosBucket:null}}at.prototype.applyPermissions=function(t){var e=this,r=l.getTimeStamp();this.request.applyPermissions().then(function(t){if(e.permissions=0,0===t.data.error_code){var o=l.getTimeStamp();if(t.data.level)return window&&window.performance&&window.performance.now?(c.performanceNow=window.performance.now(),c.serverTime=t.data.server_time+Math.floor((o-r)/2)):(c.localTime=l.getTimeStamp(),c.serverTime=t.data.server_time+Math.floor((o-r)/2),c.localServerTimeDiff=c.localTime-c.serverTime),e.cosData={appid:t.data.cos_appid,bucket:t.data.cos_bucket},e.fileMessageCosInfo.bucket=t.data.file_message.bucket,e.fileMessageCosInfo.appid=t.data.file_message.appid,e.fileMessageCosInfo.region=t.data.file_message.region,e.fileCos=new it(Object.assign({sdkAppId:e.options.sdkAppId},e.options.cosData,e.cosData),e.request,e.event),e.permissions=t.data.level,e.request.setPermissions(e.permissions),e.setDefaultBoard(),e.initData(e.options),e.syncHistroyEnable&&e.classId&&e.syncHistroyData(),y.report("verify_sdk",{time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})}),e.event.fire(e,"TEB_INIT"),e.heartbeat.start(),void e.setNeedDraw(!0);e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_ERROR_AUTH,"please purchase the service first"),y.report("verify_sdk",{action_result:t.data.error_code,action_info:JSON.stringify(t.data),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})})}else void 0!==t.data.error_code&&0!=t.data.error_code?(e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_ERROR_RUNTIME,t.data.error_msg),y.report("verify_sdk",{action_result:t.data.error_code,action_info:JSON.stringify(t.data),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})})):void 0!==t.data.ErrorCode?(60008===t.data.ErrorCode?e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_TIMEOUT_AUTH,"the request has timed out. please try again"):e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_ERROR_RUNTIME,t.data.ErrorMsg),y.report("verify_sdk",{action_result:t.data.ErrorCode,action_info:JSON.stringify(t.data),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})})):(e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_ERROR_RUNTIME,"server error"),y.report("verify_sdk",{action_result:-9999,action_info:JSON.stringify(t.data),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})}));e.permissions=0,e.request.setPermissions(e.permissions)},function(t){e.permissions=0,e.request.setPermissions(e.permissions),e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_TIMEOUT_AUTH,"the request has timed out. please try again"),y.report("verify_sdk",{action_result:-9998,action_info:JSON.stringify(t),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})})})},at.prototype.createBoardIdForFile=function(t,e,r,o,i){for(var n=1,a=[],s=0;s<o;s++){var c="".concat(i,"_").concat(e,"_").concat(r,"_").concat(n++,"_").concat(t);a.push(c)}return a},at.prototype.createBoardId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,e=arguments.length>1?arguments[1]:void 0;return 0==this.boardIdSeq?(this.boardIdSeq++,i.COMMON_DEFAULT_BOARD):(i.COMMON_GROUP,"".concat(i.PLATFORM,"_").concat(this.identifier,"_").concat(e||l.getSecondTime(),"_").concat(this.boardIdSeq++,"_").concat(t))},at.prototype.initInterval=function(){var t=this;this.sendInterval=setInterval(function(){t.realTimeData.length>0&&t.sendRequest()},200)},at.prototype.resetData=function(){this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.seq=0,this.maxSeq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.maxSeq=0,this.maxAddTextSeq=0,this.maxMoveSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.setDefaultBoard(),this.initData(this.options)},at.prototype.initData=function(t){var e=this;this.setProgressEnable(t.progressEnable),this.setColor(t.brushColor),this.setThin(t.brushThin),this.setTextFontFamily(t.textFamily),this.setTextSize(t.textSize),this.setTextColor(t.textColor),this.setTextFontStyle(t.textStyle),this.setSmoothLevel(t.smoothLevel),this.setDataSyncEnable(t.dataSyncEnable),this.setPreloadDepth(t.preloadDepth),this.setBoardContentFitMode(t.boardContentFitMode,!1),this.setImageTimeout(t.imageTimeout||i.IMAGE_TIMEOUT),"[object Undefined]"!==Object.prototype.toString.call(t.toolType)&&"[object Null]"!==Object.prototype.toString.call(t.toolType)||(t.toolType=1),this.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t.toolType]]),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea(),setTimeout(function(){e.event.fire(e,"TEB_OPERATE_CANREDO_STATUS_CHANGED",e.canRedo()),e.event.fire(e,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",e.canUndo())},500)},at.prototype.addBoard=function(t){var e=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=[];if(Array.isArray(t))o=t;else{if(!t)return;o=[t]}var n={};for(var a in o.forEach(function(t,r){e.userData[t]={},e.userData[t][e.identifier]=[],e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.backgroundColor[t]=e.globalBackgroundColor,e.backgroundPic[t]={url:"",user:t===i.COMMON_DEFAULT_BOARD?e.identifier:l.boardId2Uid(t),show:!0,mode:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,type:m.BACKGROUND_TYPE.IMAGE},-1===e.boardList.indexOf(t)&&e.boardList.push(t);var o=l.boardId2Fid(t);n[o]||(n[o]=[]),n[o].push(t)}),n)this.event.fire(this,"TEB_ADDBOARD",n[a],a);return this.sortBoard(),r&&this.report.reportCreateBoards(this.currentBoard,o),this.boardList},at.prototype.findLine=function(t,e,r){for(var o,i=this.userData[t][e],n=0,a=i.length;n<a;n++){var s=i[n];if("line"===s.type&&s.seq==r.belongSeq){o=s;break}}return o},at.prototype.setNeedDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.needDraw=t},at.prototype.getNeedDraw=function(){return this.needDraw},at.prototype.getBoardList=function(){return this.boardList},at.prototype.getBoardPicList=function(){return this.backgroundPic},at.prototype.setDefaultBoard=function(){this.currentGroup=i.COMMON_GROUP;var t=l.getSecondTime();this.addGroup(i.COMMON_GROUP,i.COMMON_GROUP,this.user,null,1,0,t,i.PLATFORM,i.FILE_TYPE.IMG,0),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard,!1),this.setBackgroundColor(l.formatColor(this.globalBackgroundColor),!0),delete this.setDefaultBoard},at.prototype.removeBoard=function(t){Array.isArray(t)||(t=[t]);for(var e=[],r=[],o=!1,n={},a=0,s=t.length;a<s;a++){var c,u=t[a];if(u!==i.COMMON_DEFAULT_BOARD&&(c=this.boardList.indexOf(u))>-1){e.push(u);var d=l.boardId2Fid(u);if(n[d]||(n[d]=[]),n[d].push(u),delete this.userData[u],delete this.data[u],delete this.opData[u],delete this.opIndex[u],delete this.backgroundColor[u],delete this.backgroundPic[u],u==this.currentBoard){o=!0;var h=this.getBoardByGroup(this.currentGroup),f=h.indexOf(u);if(this.currentBoard=0===f?h[f+1]:h[f-1],!this.currentBoard){var p=this.getBoardByGroup(i.COMMON_GROUP);this.currentBoard=p[this.getFileInfo(i.COMMON_GROUP).currentPageIndex]}}this.boardList.splice(c,1);var g=l.boardId2Fid(u),m=this.getBoardByGroup(g),_=this.getFileInfo(g);0===m.length?_&&(this.deleteGroup(g),r.push(g)):_&&(_.pageCount=_.pageCount-1,_.pageCount===_.currentPageIndex&&(_.currentPageIndex=_.currentPageIndex-1),this.updateFileInfo(_))}}var y=l.boardId2Fid(this.currentBoard),T=this.getBoardByGroup(y);for(var b in(_=this.getFileInfo(y))&&(_.pageCount=T.length,_.currentPageIndex=T.indexOf(this.currentBoard),this.updateFileInfo(_)),this.currentGroup=l.boardId2Fid(this.currentBoard),n)this.event.fire(this,"TEB_DELETEBOARD",n[b],b);return o&&this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,l.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),{deleteBoards:e,deleteFids:r}},at.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentBoard,e=arguments.length>1?arguments[1]:void 0,r=this.removeBoard(t)||[],o=r.deleteBoards,n=r.deleteFids;if(o.length){var a=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";a&&this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:a,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var s=[];e?n.indexOf(e)>-1?s=n:s.push(e):s=n;var u=this.getBoardByGroup(this.currentGroup),d=u.indexOf(this.currentBoard),h=c.getSeq();this.addRealtimeData({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:h,toBoardId:this.currentBoard,deleteBoards:s.length?[]:o,deleteFiles:s.length?s:[],page:d,step:0}),this.maxSeq=h,this.report.reportDeleteBoard(o,this.currentBoard);var f=this.getFileInfo(this.currentGroup);f.currentPageIndex=d,f.currentPageStep=0,f.pageCount=u.length,this.report.reportAddFile(f)}return o},at.prototype.getGroup=function(){var t=this,e=Object.assign([],this.groups);return e.forEach(function(e){var r=[];e.type===i.FILE_TYPE.IMG&&(t.getBoardByGroup(e.fid)||[]).forEach(function(e){var o=new R(e,t.backgroundPic[e],t.backgroundColor[e]);r.push(o)}),e.boardInfoList=r}),e},at.prototype.getFileInfo=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.COMMON_GROUP,e=null,r=this.getGroup(),o=0,n=r.length;o<n;o++){var a=r[o];if(t===a.fid){e=a;break}}return e},at.prototype.getBoardByGroup=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.COMMON_GROUP;return this.boardList.filter(function(e){return t===i.COMMON_GROUP&&e===i.COMMON_DEFAULT_BOARD||e.indexOf("_".concat(t))>-1})},at.prototype.addGroupNotReport=function(t,e,r,o,n,a,s){for(var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.PLATFORM,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.FILE_TYPE.IMG,u=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,f=!1,p=0,g=this.groups.length;p<g;p++)if(this.groups[p].fid==t){f=!0;break}if(f)return this.groups;l==i.FILE_TYPE.IMAGESFILE?this.event.fire(this,"TEB_ADDIMAGESFILE",t):this.event.fire(this,"TEB_ADDTRANSCODEFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:c,ratio:d,type:l,scale:h};return this.groups.push(m)},at.prototype.addGroup=function(t,e,r,o,n,a,s){for(var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.PLATFORM,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.FILE_TYPE.IMG,u=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,f=!1,p=0,g=this.groups.length;p<g;p++)if(this.groups[p].fid==t){f=!0;break}if(f)return this.groups;l==i.FILE_TYPE.IMAGESFILE?this.event.fire(this,"TEB_ADDIMAGESFILE",t):this.event.fire(this,"TEB_ADDTRANSCODEFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:c,ratio:d,type:l,scale:h};return t&&t!==i.COMMON_GROUP&&this.report.reportAddFile(m),this.groups.push(m)},at.prototype.deleteGroup=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t===i.COMMON_GROUP)return[];for(var r=-1,o=0,n=this.groups.length;o<n;o++)if(this.groups[o].fid==t){r=o;break}return r>-1&&(this.groups.splice(r,1),C.clearIframeCache(this.iframeDom)),e&&this.report.reportDeleteFile(t),this.getBoardByGroup(t)},at.prototype.setColor=function(t){t||(t=m.COLOR.RED),this.cancelSelect(),"number"==typeof t?this.color=l.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.color=t):this.color=l.hexToRgba(t)},at.prototype.getColor=function(){return this.color},at.prototype.setThin=function(t){t||(t=i.THIN),this.cancelSelect(),this.thin=t},at.prototype.getThin=function(){return this.thin},at.prototype.setSmoothLevel=function(t){"[object Undefined]"!==Object.prototype.toString.call(t)&&"[object Null]"!==Object.prototype.toString.call(t)||(t=i.SMOOTH_LEVEL),t=Math.max(0,Math.min(1,t)),this.smoothLevel=t},at.prototype.getSmoothLevel=function(){return this.smoothLevel},at.prototype.setTextSize=function(t){t||(t=i.TEXT_SIZE),this.cancelSelect(),this.textSize=t},at.prototype.getTextSize=function(){return this.textSize},at.prototype.setTextColor=function(t){t||(t=i.TEXT_COLOR),this.cancelSelect(),"number"==typeof t?this.textColor=l.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.textColor=t):this.textColor=l.hexToRgba(t)},at.prototype.getTextColor=function(){return this.textColor},at.prototype.setTextFontFamily=function(t){t||(t=i.TEXT_FONT_FAMILY),this.cancelSelect(),this.typeFace=t},at.prototype.getTextFontFamily=function(){return this.typeFace},at.prototype.setTextFontStyle=function(t){t||(t=$.TEDU_BOARD_TEXT_STYLE_NORMAL),this.cancelSelect(),this.fontStyle=t},at.prototype.getTextFontStyle=function(){return this.fontStyle},at.prototype.setDataSyncEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DATA_SYNC_ENABLE;this.request.setReportEnable(t),this.dataSyncEnable=t},at.prototype.isDataSyncEnable=function(){return this.dataSyncEnable},at.prototype.setProgressEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.PROGRESS_ENABLE;this.progressEnable=t},at.prototype.isProgressEnable=function(){return this.progressEnable},at.prototype.setPreloadDepth=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.PRELOAD_DEPTH;this.preloadDepth=t},at.prototype.setType=function(t){var e=Object.values(m.BOARD_ACTION_TYPE);this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=m.BOARD_ACTION_TYPE.LINE},at.prototype.getType=function(){return this.type},at.prototype.setTransparent=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.transparent=t},at.prototype.getTransparent=function(){return this.transparent},at.prototype.setBackgroundColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.COLOR.WHITE,e=arguments.length>1?arguments[1]:void 0,r=this.currentBoard;"object"===nt(t)&&(r=t.boardId,t=t.color);var o=0;"number"==typeof t?(this.backgroundColor[r]=l.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.backgroundColor[r]=t,o=l.formatColor(t)):(this.backgroundColor[r]=l.hexToRgba(t),o=l.formatColor(l.hexToRgba(t))),this.setNeedDraw(!0),e||(this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),color:o,isGlobal:0}),this.report.reportSetBoardBgColor(r,o))},at.prototype.getBackgroundColor=function(){return this.backgroundColor[this.getCurrentBoard()]},at.prototype.setSelectArea=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.selectArea={x:t,y:e,width:r,height:o}},at.prototype.getSelectArea=function(){return this.selectArea},at.prototype.getCurrentBoard=function(){return this.currentBoard},at.prototype.getCurrentFile=function(){return this.currentGroup},at.prototype.getData=function(){return this.data},at.prototype.getFaceData=function(){var t,e,r=this.getCurrentBoardData(),o=this.faceData.pop();if(o&&o.content&&o.content.fid){var n=o.content;if(n.type===i.FILE_TYPE.IMG){t={downloadURL:n.url,currentPageIndex:n.page,currentPageStep:n.step,type:n.type,fid:n.fid,ratio:n.ratio};var a="";n.url&&((a=l.fileDownLoadUrlToPreviewUrl(n.url)).endsWith("/")?a+=n.page+1+".jpg":a+=n.page+1),e={mode:0,show:!0,type:0,url:a}}else n.type===i.FILE_TYPE.H5PPT&&(t={downloadURL:n.url,currentPageIndex:n.page,currentPageStep:n.step,type:n.type,fid:n.fid,ratio:n.ratio},e={mode:0,show:!0,type:0,url:""})}return this.faceData=[],{fileInfo:t,backgroundColor:r.backgroundColor,currentPic:e,data:r.data}},at.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard],ratio:this.boardRatio[this.currentBoard],scale:this.getBoardScale()}},at.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},at.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},at.prototype.getSelectList=function(){return this.selectedList},at.prototype.clearBoard=function(t){if(this.currentBoard){for(var e in this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard])this.userData[this.currentBoard][e]=[];this.userData[this.currentBoard][this.identifier]=[],t||(this.backgroundPic[this.currentBoard]={show:!1,mode:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,url:"",type:m.BACKGROUND_TYPE.IMAGE,user:""},this.backgroundColor[this.currentBoard]=this.globalBackgroundColor),this.cancelSelect(),this.setNeedDraw(!0)}},at.prototype.clearFileDrawData=function(t){var e=this;t.forEach(function(t){(e.getBoardByGroup(t)||[]).forEach(function(t){e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.userData[t]={},e.userData[t][e.identifier]=[]})}),this.cancelSelect(),this.setNeedDraw(!0)},at.prototype.clear=function(){this.clearBoard(),this.addRealtimeData({action:101,seq:c.getSeq()}),this.report.reportClear(this.currentBoard)},at.prototype.clearDraws=function(){this.clearBoard(!0),this.addRealtimeData({action:102,seq:c.getSeq()}),this.report.reportClearDraws(this.currentBoard)},at.prototype.clearFileDraws=function(t){var e=this;if(t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var r=[];t.forEach(function(t){r=r.concat(e.getBoardByGroup(t))}),this.addRealtimeData({action:i.PROTOCOL_ACTION.FILE_CLEAR_ACTION,seq:c.getSeq(),fids:t}),this.report.reportClearDraws(r)}},at.prototype.clearAll=function(){this.report.reportCleanAll(),this.addRealtimeData({action:i.PROTOCOL_ACTION.RESET_DATA_ACTION,seq:c.getSeq()}),this.sendRequest(),this.resetData()},at.prototype.addBackgroundPic=function(t){var e=this,r=t.boardIds,o=t.urls,n=t.type,a=void 0===n?m.BACKGROUND_TYPE.IMAGE:n,s=t.needReport,u=void 0===s||s,d=t.position,h=void 0===d?S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER:d,f=[],p=[];if(Array.isArray(r)){if(!Array.isArray(o)||r.length!=o.length)return!1;f=r,p=o}else{if(Array.isArray(o))return!1;f=[r],p=[o]}var g=[];this.cancelSelect(),f.forEach(function(t,r){t===e.currentBoard&&u&&e.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(p[r]),time:l.getTimeStamp(),seq:c.getSeq(),mode:h,type:a,cleanBoard:0}),e.data[t]||e.addBoard(t),e.backgroundPic[t].url=p[r],e.backgroundPic[t].show=!0,e.backgroundPic[t].mode=h,e.backgroundPic[t].type=a,g.push({type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:p[r],updateTime:l.getTimeStamp(),type:a,mode:h}})}),u&&this.report.reportImages(g),this.setNeedDraw(!0)},at.prototype.setBackgroundPic=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;t&&(this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1,position:e}),this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:l.getTimeStamp(),seq:c.getSeq(),mode:e,type:m.BACKGROUND_TYPE.IMAGE,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,e))},at.prototype.setBackgroundH5=function(t){this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.H5,needReport:!1}),this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:l.getTimeStamp(),seq:c.getSeq(),mode:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,type:m.BACKGROUND_TYPE.H5,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER,m.BACKGROUND_TYPE.H5)},at.prototype.updateCurrentFillMode=function(t){var e=this.backgroundPic[this.currentBoard];e&&e.url&&this.setBackgroundPic(e.url,t)},at.prototype.deleteBackgroundPic=function(t){this.cancelSelect(),this.backgroundPic[t].show=!1,this.setNeedDraw(!0)},at.prototype.cancelBackgroundPic=function(){this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.addRealtimeData({action:i.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"",0)},at.prototype.clearGlobalBgColor=function(){this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},at.prototype.switchPage=function(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t=(e=this.getBoardByGroup(this.getCurrentFile()))[r=Math.min(r,e.length-1)],this.switchBoard(t)},at.prototype.switchH5Board=function(t){var e=t.fid,r=t.slideIndex,o=t.stepIndex;this.cancelSelect();var n=this.getBoardByGroup(e),a=this.getFileInfo(e),s=n[r];this.currentBoard=s,this.currentGroup=e,a.currentPageIndex=r,a.currentPageStep=o,a.pageCount=n.length;var u=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";u&&this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:u,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var d=c.getSeq();return this.addRealtimeData({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:d,toBoardId:s,deleteBoards:[],deleteFiles:[],page:a.currentPageIndex,step:o}),this.maxSeq=d,this.sendRequest(),this.report.reportSwitchBoard(s),this.report.reportAddFile(a),this.event.fire(this,"TEB_GOTOBOARD",s,e),this.setNeedDraw(!0),s},at.prototype.switchBoard=function(t){if(this.cancelSelect(),t&&!this.data[t])return!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t,this.currentGroup=l.boardId2Fid(t);var e=this.getBoardByGroup(this.currentGroup),r=this.getFileInfo(this.currentGroup),o=e.indexOf(t),n=r.currentPageStep;r.currentPageIndex=o,r.currentPageStep=n,r.pageCount=e.length;var a=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";a&&this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:a,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var s=c.getSeq();return this.addRealtimeData({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:s,toBoardId:t,deleteBoards:[],deleteFiles:[],page:r.currentPageIndex,step:n}),this.maxSeq=s,this.sendRequest(),this.report.reportSwitchBoard(t),this.report.reportAddFile(r),this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,l.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),t},at.prototype.setGlobalBackgroundColor=function(t,e){var r=this;t||(t=m.COLOR.WHITE);var o=0;"number"==typeof t?(this.globalBackgroundColor=l.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.globalBackgroundColor=t,o=l.formatColor(t)):(this.globalBackgroundColor=l.hexToRgba(t),o=l.formatColor(l.hexToRgba(t))),this.boardList.forEach(function(t){r.backgroundColor[t]=r.globalBackgroundColor}),this.setNeedDraw(!0),e||(this.addRealtimeData({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),color:o,isGlobal:1}),this.report.reportGlobalBgColor(o))},at.prototype.getGlobalBackgroundColor=function(){return this.globalBackgroundColor},at.prototype.preloadBoard=function(){this.preloadDepth=2;for(var t=[],e=[],r=0;r<this.groups.length;++r){var o=this.groups[r];if(o.type!==i.FILE_TYPE.H5PPT){var n=this.getBoardByGroup(o.fid);e=e.concat(n)}}for(var a=e.indexOf(this.currentBoard),s=-this.preloadDepth;s<this.preloadDepth;++s){var c=a+s;if(!(c<0||c>=e.length)){var l=e[c],u=this.backgroundPic[l];if(u&&!u.preloaded&&u.url){if(0===s){u.preloaded=!0;continue}u.type===m.BACKGROUND_TYPE.IMAGE&&t.push(u.url),u.preloaded=!0}}}return t},at.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},at.prototype.collectLineData=function(){var t=this;return{start:function(e,r){var o=c.getSeq();t.belongLineSeq=o;var a=new d(t.identifier,{color:t.color,thin:t.thin,x:e,y:r,show:!0,seq:o,belongSeq:o});t.userData[t.currentBoard][t.identifier].push(a),t.data[t.currentBoard].push(a),t.opData[t.currentBoard].push(new n(t.identifier,{seq:a.seq,type:t.type})),t.opIndex[t.currentBoard]++;var s={action:i.PROTOCOL_ACTION.LINE_START_ACTION,color:l.formatColor(a.color),scale:100,thin:a.thin,time:l.getTimeStamp(),seq:a.seq,belongSeq:a.belongSeq,x:e,y:r};t.addRealtimeData(s)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n||(t.collectLineData().start(e,r),o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1]),n.setBorder(e,r);var a=c.getSeq();n.lines.push({x:e,y:r,seq:a});var s={action:i.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:a,belongSeq:t.belongLineSeq,x:e,y:r};t.addRealtimeData(s)},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n||(t.collectLineData().start(e,r,t.isHandwritingEnable()),o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1]),n.setBorder(e,r);var a=c.getSeq();if(n.lines.push({x:e,y:r,seq:a}),t.smoothLevel>0){var s=[];n.lines.forEach(function(t){s.push([t.x,t.y])}),n.fitCurve=j(s,1e4*t.smoothLevel,null)}var u={action:i.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:t.belongLineSeq,seq:a,x:e,y:r};t.addRealtimeData(u),t.setNeedDraw(!0);var d=[];n.lines.forEach(function(t){d.push({seq:t.seq,x:t.x,y:t.y})}),t.report.reportAddLine({belongSeq:t.belongLineSeq,boardId:t.currentBoard,uid:n.user,colorRGBA:l.formatColor(t.color),scale:100,width:t.thin,time:n.time,updateTime:l.getTimeStamp(),seq:n.seq,hidden:1*!n.show,points:d})},over:function(t,e){this.end(t,e)}}},at.prototype.collectTextInputData=function(){var t=this;return{start:function(e,r){var o,i=c.getSeq();try{var a=t.data[t.currentBoard],s={seq:0,index:-1};if(a.forEach(function(o,i){if("inputtext"===o.type&&o.show&&o.user===t.identifier){var n=5/t.boardWidth*1e4,a=5/t.boardHeight*1e4,c=o.location.x-n,l=o.location.y-a,u=o.location.x+o.textWidth/t.boardWidth*1e4+n,d=o.location.y+o.textHeight/t.boardHeight*1e4+a;e>=c&&e<=u&&r>=l&&r<=d&&o.belongSeq>s.seq&&(s={seq:o.belongSeq,index:i})}}),s.index>-1){var l=t.data[t.currentBoard].splice(s.index,1)[0];l.show=!1,t.setNeedDraw(!0),o=l,(t.userData[t.currentBoard][t.identifier]||[]).forEach(function(e,r){e.belongSeq===o.belongSeq&&t.userData[t.currentBoard][t.identifier].splice(r,1)})}}catch(t){}o||((o=new g(t.identifier,{x:e,y:r,belongSeq:i})).color=t.getTextColor(),o.textSize=t.getTextSize(),o.typeFace=t.getTextFontFamily(),o.fontStyle=t.getTextFontStyle()),t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o);for(var u=!1,d=0,h=t.opData[t.currentBoard].length;d<h;d++)if(t.opData[t.currentBoard][d].seq===o.belongSeq){u=!0;break}return u||(t.opData[t.currentBoard].push(new n(t.identifier,{seq:o.belongSeq,type:t.type})),t.opIndex[t.currentBoard]++),o},inputting:function(e,r,o){var n=t.userData[t.currentBoard][t.identifier].length,a=t.userData[t.currentBoard][t.identifier][n-1],s=c.getSeq();a.text=e,a.seq=s,a.textWidth=r,a.textHeight=o;var u={action:i.PROTOCOL_ACTION.INPUT_TEXT_ACTION,seq:s,belongSeq:a.belongSeq,color:l.formatColor(a.color),scale:100,typeFace:a.typeFace,textSize:Math.floor(a.textSize),fontStyle:a.fontStyle,time:l.getTimeStamp(),x:a.location.x,y:a.location.y,text:e};t.addRealtimeData(u)},draw:function(e){var r=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][r-1];if(!e&&!e.trim()){for(var i=-1,n=0,a=t.opData[t.currentBoard].length;n<a;n++)if(t.opData[t.currentBoard][n].seq===o.belongSeq){i=n;break}return i>-1&&(t.opData[t.currentBoard].splice(i,1),t.opIndex[t.currentBoard]--),t.userData[t.currentBoard][t.identifier].splice(r-1,1),void t.data[t.currentBoard].splice(t.data[t.currentBoard].length-1,1)}o.text=e,o.show=!0,t.report.reportAddText({belongSeq:o.belongSeq,time:o.time,boardId:t.currentBoard,uid:o.user,x:Math.floor(o.location.x),y:Math.floor(o.location.y),colorRGBA:l.formatColor(o.color),scale:100,updateTime:l.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:Math.floor(o.textSize),fontStyle:o.fontStyle,text:e}),t.setNeedDraw(!0)}}},at.prototype.collectEraserData=function(t,e){var r=this.eraserImpactCheck(t,e,this.thin/2);if(r.length>0){this.opData[this.currentBoard].push(new n(this.identifier,{seq:r,type:this.type})),this.opIndex[this.currentBoard]++;var o={action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),x:0,y:0,lines:r};r.length&&(this.addRealtimeData(o),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:r})),this.setNeedDraw(!0)}},at.prototype.collectRaserData=function(){var t=this;return{start:function(e,r){var o=new p(t.identifier,{color:l.dealColor(m.COLOR.RED),radius:t.thin/2,x:e,y:r,seq:c.getSeq()});t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o);var n={action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,r:o.radius,seq:o.seq,x:e,y:r};t.addRealtimeData(n),t.setNeedDraw(!0)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.location={x:e,y:r},t.setNeedDraw(!0),t.addRealtimeData({action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:c.getSeq(),x:e,y:r,r:n.radius})},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.point={x:e,y:r},n.status=0;var a={action:i.PROTOCOL_ACTION.RASER_HIDE_ACTION,seq:n.seq};t.addRealtimeData(a),t.setNeedDraw(!0)},over:function(){var e=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][e-1].status=0,t.setNeedDraw(!0)}}},at.prototype.collectSelectData=function(){var t=this;return{start:function(e,r){t.beforeMoveType="select";var o=new f(t.identifier,{startx:e,starty:r,x:e,y:r});t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][o-1].location={x:e,y:r},t.setNeedDraw(!0)},end:function(e,r,o,i){for(var n=e>o?e:o,a=r>i?r:i,s=e+o-n,c=r+i-a,l=t.data[t.currentBoard].length-1;l>=0;l--){var u=t.data[t.currentBoard][l];if("line"==u.type&&u.show)n>=u.border.maxX&&a>=u.border.maxY&&s<=u.border.minX&&c<=u.border.minY&&(u.select=!0,t.selectedList.push(u));else if("graph"==u.type&&u.show)n>=u.endPoint.x&&a>=u.endPoint.y&&s<=u.startPoint.x&&c<=u.startPoint.y&&(u.select=!0,t.selectedList.push(u));else if("inputtext"==u.type&&u.show&&u.text){var d=u.location.x,h=u.location.y,f=u.location.x+u.textWidth/t.boardWidth*1e4,p=u.location.y+u.textHeight/t.boardHeight*1e4;n>=f&&a>=p&&s<=d&&c<=h&&(u.select=!0,t.selectedList.push(u))}}t.selectArea={x:s,y:c,width:n-s,height:a-c},t.userData[t.currentBoard][t.identifier][t.userData[t.currentBoard][t.identifier].length-1].show=!1,t.setNeedDraw(!0)}}},at.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var r=!1,o=this.data[this.currentBoard].length-1;o>=0;o--){var i=this.data[this.currentBoard][o];if("line"==i.type&&i.show){if(t<i.border.maxX&&t>i.border.minX&&e<i.border.maxY&&e>i.border.minY){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:i.border.minX,y:i.border.minY,width:i.border.maxX-i.border.minX,height:i.border.maxY-i.border.minY};break}}else if("graph"==i.type&&i.show){var n=i.endPoint.x,a=i.endPoint.y,s=i.startPoint.x,c=i.startPoint.y;if(n<s&&(n+=s,n-=s=n-s),a<c&&(a+=c,a-=c=a-c),a+=this.thin,n+=this.thin,s-=this.thin,c-=this.thin,t>=s&&t<=n&&e>=c&&e<=a){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:s,y:c,width:n-s,height:a-c};break}}else if("inputtext"===i.type&&i.show&&i.text){var l=5/this.boardWidth*1e4,u=5/this.boardHeight*1e4,d=i.location.x-l,h=i.location.y-u,f=i.location.x+i.textWidth/this.boardWidth*1e4+l,p=i.location.y+i.textHeight/this.boardHeight*1e4+u;if(t>=d&&t<=f&&e>=h&&e<=p){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:d,y:h,width:f-d,height:p-h};break}}}r&&this.setNeedDraw(!0)},at.prototype.collectMoverData=function(){var t=this;return{beforeStart:function(e,r){if(0==t.selectedList.length)return!1;for(var o=!1,i=0;i<t.selectedList.length;i++){var n=t.selectedList[i];if("line"==n.type){var a=1.5*t.thin,s=1.5*t.thin;if(n.border.minX-a<=e&&n.border.maxX+a>=e&&n.border.minY-s<=r&&n.border.maxY+s>=r){o=!0;break}}else if("graph"==n.type){var c=n.startPoint.x,l=n.endPoint.x,u=n.startPoint.y,d=n.endPoint.y;if(l<c&&(l+=c,l-=c=l-c),d<u&&(d+=u,d-=u=d-u),d+=t.thin,l+=t.thin,u-=t.thin,(c-=t.thin)<=e&&l>=e&&u<=r&&d>=r){o=!0;break}}else if("inputtext"===n.type){var h=5/t.boardWidth*1e4,f=5/t.boardHeight*1e4,p=n.location.x-h,g=n.location.y-f,m=n.location.x+n.textWidth/t.boardWidth*1e4+h,_=n.location.y+n.textHeight/t.boardHeight*1e4+f;if(e>=p&&e<=m&&r>=g&&r<=_){o=!0;break}}}return!!o||(t.cancelSelect(),!1)},start:function(e,r){var o=[];t.selectedList.forEach(function(t){"line"==t.type?o.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?o.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"==t.type&&o.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),t.opData[t.currentBoard].push(new n(t.identifier,{seq:{origin:o,final:[]},type:"move"}))},draw:function(e,r,o,i){if(t.selectedList.length>0){for(var n=0;n<t.selectedList.length;n++){var a=t.selectedList[n],s=e-o,c=r-i;"line"==a.type?(a.border.maxX+=s,a.border.minX+=s,a.border.maxY+=c,a.border.minY+=c,a.lines.forEach(function(t){t.x+=s,t.y+=c}),0!==a.fitCurve.length&&a.fitCurve.forEach(function(t){t[1][0]+=s,t[1][1]+=c,t[2][0]+=s,t[2][1]+=c,t[3][0]+=s,t[3][1]+=c})):"graph"==a.type?(a.startPoint.x+=s,a.startPoint.y+=c,a.endPoint.x+=s,a.endPoint.y+=c):"inputtext"===a.type&&(a.location.x+=s,a.location.y+=c)}t.selectArea.x+=s,t.selectArea.y+=c,t.setNeedDraw(!0)}},end:function(){t.setNeedDraw(!0);var e=[];if(0!=t.selectedList.length){t.selectedList.forEach(function(t){"line"==t.type?e.push({seq:t.seq,x:t.lines[0].x,y:t.lines[0].y,uid:t.user}):"graph"==t.type?e.push({seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y,uid:t.user}):"inputtext"===t.type&&e.push({seq:t.belongSeq,x:t.location.x,y:t.location.y,uid:t.user})});var r={action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:c.getSeq(),moves:e,time:l.getTimeStamp()};t.addRealtimeData(r);var o=[];t.selectedList.forEach(function(t){"line"==t.type?o.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?o.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"===t.type&&o.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),t.opData[t.currentBoard][t.opData[t.currentBoard].length-1].seq.final=o,t.opIndex[t.currentBoard]++;var n=[];e.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var a=[];i.lines.forEach(function(t){a.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:a}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"oval"==i.graph||"circle"==i.graph?s.content.fillRect=i.solid?1:0:"rect"==i.graph&&(s.content.fillRect=i.solid?1:0,s.content.cornerRadius=0),n.push(s)}else"inputtext"===i.type&&e.seq==i.belongSeq&&n.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),t.report.reportGraphData(n)}}}},at.prototype.collectGraphData=function(){var t=this;return{start:function(e,r){var o=t.type.split("-")[1],i=new h(t.identifier,{graph:o,color:t.color,thin:t.thin,seq:c.getSeq(),beginPoint:{x:e,y:r,seq:c.getSeq()},endPoint:{x:e,y:r,seq:c.getSeq()},show:!0,solid:t.type.indexOf("solid")>-1});t.seq=i.seq,t.userData[t.currentBoard][t.identifier].push(i),t.data[t.currentBoard].push(i),t.opData[t.currentBoard].push(new n(t.identifier,{seq:i.startPoint.seq,type:"graph"})),t.opIndex[t.currentBoard]++},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,i=t.userData[t.currentBoard][t.identifier][o-1];i.endPoint.x=e,i.endPoint.y=r,"circle"==i.graph&&t.circleFix(i),t.setNeedDraw(!0)},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,i=t.userData[t.currentBoard][t.identifier][o-1];i.endPoint.x=e,i.endPoint.y=r,"circle"==i.graph&&t.circleFix(i),"line"!=i.graph&&t.graphFix(i),t.setNeedDraw(!0);var n={seq:i.seq,time:l.getTimeStamp(),color:l.formatColor(t.color),scale:100,thin:t.thin,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}};n.action={line:10,oval:11,circle:11,rect:12}[i.graph];var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(t.color),scale:100,width:t.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}},s=t.type.indexOf("solid")>-1?1:0;n.action>10&&(n.fillRect=s,a.content.fillRect=s),12==n.action&&(n.cornerRadius=0,a.content.cornerRadius=0),t.addRealtimeData(n),t.report.reportGraphData([a])},over:function(t,e){this.end(t,e)}}},at.prototype.collectDragData=function(){var t=this;return{start:function(t){var e=t.currentTarget.getElementsByClassName("tx_board_canvas_box")[0];getComputedStyle(e).getPropertyValue("transform"),e.style.left,e.style.top},draw:function(e,r,o,i,n){var a,s,c,l,u=e.currentTarget.getElementsByClassName("tx_board_canvas_box")[0],d=o-n,h=(r-i)/t.boardWidth*100,f=d/t.boardHeight*100;t.boardWidth/t.boardHeight>t.containerWidth/t.containerHeight?(t.boardHeight>t.containerHeight?(c=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,l=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100):(c=50,l=50),a=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,s=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(c=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,l=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,t.boardWidth>t.containerWidth?(a=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,s=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(a=50,s=50));var p=1*u.style.left.replace("%","")+h;p=Math.min(a,Math.max(s,p)),u.style.left=p+"%";var g=1*u.style.top.replace("%","")+f;g=Math.min(c,Math.max(l,g)),u.style.top=g+"%";var m=u.getAttribute("style");-1===m.indexOf("-webkit-transform")&&(m+="-webkit-transform: translateX(-50%) translateY(-50%);"),u.setAttribute("style",m),t.dragDataList.getDragData(t.currentBoard)?t.dragDataList.updateDragData(t.currentBoard,{xOffset:p,yOffset:g}):t.dragDataList.addDragData(t.currentBoard,new Y({scale:t.getBoardScale(),xOffset:p,yOffset:g})),t.addRealtimeData(t.dragDataList.getDragData(t.currentBoard).getRealTimeData())},scaleDraw:function(e,r){if(r.length){var o,n=t.dragDataList.getDragData(t.currentBoard);n&&(o=parseInt(e*r[r.length-1]),o=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,o)),n.scale=o),t.setNeedDraw(!0)}},end:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},touchEnd:function(e){if(e.length){var r=t.dragDataList.getDragData(t.currentBoard);t.setBoardScale(r.scale)}else t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},over:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))}}},at.prototype.cancelSelect=function(){for(var t=this.selectedList.length,e=0;e<t;e++)this.selectedList[e].select=!1;this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},t&&this.setNeedDraw(!0)},at.prototype.eraserImpactCheck=function(t,e,r){var o=this,i=[],n=this.data[this.currentBoard];return n&&n.forEach(function(n){var a=n.thin/2;if("line"==n.type&&n.show){var s=n.border.maxX+a,c=n.border.maxY+a,l=n.border.minX-a,u=n.border.minY-a,d=0;if(t+r<l||t-r>s||e+r<u||e-r>c)return;var h=!1;if(1===n.lines.length){var f=n.lines[0];o.getDistance(t,e,f.x,f.y,f.x,f.y)<=(r+a)*(r+a)&&(h=!0)}else for(var p=1;p<n.lines.length;p++){var g=n.lines[p-1],m=n.lines[p];if(o.getDistance(t,e,g.x,g.y,m.x,m.y)<=(r+a)*(r+a)){h=!0;break}}h&&(n.show=!1,i.push({uid:n.user,seq:n.seq}))}else if("graph"==n.type&&n.show){if("line"==n.graph)(d=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.endPoint.y))<=(r+a)*(r+a)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}));else if("rect"==n.graph)if(n.solid)t>n.startPoint.x&&e>n.startPoint.y&&t<n.endPoint.x&&e<n.endPoint.y&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}));else{var _=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.startPoint.x,n.endPoint.y),y=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.startPoint.y),T=o.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.startPoint.x,n.endPoint.y),b=o.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.endPoint.x,n.startPoint.y);Math.min(_,y,T,b)<=(r+a)*(r+a)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}else if("circle"==n.graph){var v=(n.startPoint.x+n.endPoint.x)/2,E=(n.startPoint.y+n.endPoint.y)/2,S=Math.sqrt(Math.pow(n.startPoint.x-n.endPoint.x,2)+Math.pow(n.startPoint.y-n.endPoint.y,2))/2;d=Math.sqrt(Math.pow(t-v,2)+Math.pow(e-E,2)),n.solid?d<S+r&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq})):Math.abs(S-d)<=r+a&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}else if("oval"==n.graph){var D=(n.startPoint.x+n.endPoint.x)/2,A=(n.startPoint.y+n.endPoint.y)/2,C=Math.abs(n.startPoint.x-n.endPoint.x)/2,O=Math.abs(n.startPoint.y-n.endPoint.y)/2;if(C===O&&0===C)return;var R=Math.pow(t-D,2)/Math.pow(C,2)+Math.pow(e-A,2)/Math.pow(O,2),I=Math.pow(t-D+a,2)/Math.pow(C,2)+Math.pow(e-A+a,2)/Math.pow(O,2),x=Math.pow(t-D+a,2)/Math.pow(C,2)+Math.pow(e-A-a,2)/Math.pow(O,2),B=Math.pow(t-D-a,2)/Math.pow(C,2)+Math.pow(e-A+a,2)/Math.pow(O,2),P=Math.pow(t-D-a,2)/Math.pow(C,2)+Math.pow(e-A-a,2)/Math.pow(O,2);n.solid?(R<=1.2||I<=1.2||x<=1.2||B<=1.2||P<=1.2)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq})):(R<=1.2&&R>=.8||I<=1.2&&I>=.8||x<=1.2&&x>=.8||B<=1.2&&B>=.8||P<=1.2&&P>=.8)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}}else if("inputtext"==n.type&&n.show){var w=n.location.x-0,N=n.location.y-0,L=n.location.x+n.textWidth/o.boardWidth*1e4+0,k=n.location.y+n.textHeight/o.boardHeight*1e4+0;t>w&&e>N&&t<L&&e<k&&(n.show=!1,i.push({uid:n.user,seq:n.belongSeq}))}}),i},at.prototype.getDistance=function(t,e,r,o,i,n){var a,s,c=i-r,l=n-o,u=c*c+l*l,d=-1;0!=u&&(d=((t-r)*c+(e-o)*l)/u),d<0?(a=r,s=o):d>1?(a=i,s=n):(a=r+d*c,s=o+d*l);var h=t-a,f=e-s;return h*h+f*f},at.prototype.circleFix=function(t){var e=Math.abs(t.startPoint.x-t.endPoint.x)*this.boardWidth/1e4,r=Math.abs(t.startPoint.y-t.endPoint.y)*this.boardHeight/1e4;e>r?(t.endPoint.x=t.startPoint.x<t.endPoint.x?t.startPoint.x+1e4*r/this.boardWidth:t.startPoint.x-1e4*r/this.boardWidth,t.endPoint.x=parseInt(t.endPoint.x)):(t.endPoint.y=t.startPoint.y<t.endPoint.y?t.startPoint.y+1e4*e/this.boardHeight:t.startPoint.y-1e4*e/this.boardHeight,t.endPoint.y=parseInt(t.endPoint.y))},at.prototype.graphFix=function(t){var e=t.startPoint.x,r=t.startPoint.y,o=t.endPoint.x,i=t.endPoint.y;t.startPoint={x:e>o?o:e,y:r>i?i:r,seq:t.startPoint.seq},t.endPoint={x:e>o?e:o,y:r>i?r:i,seq:t.endPoint.seq}},at.prototype.sendRequest=function(){if(this.dataSyncEnable){if(this.permissions){var t=JSON.parse(JSON.stringify(this.realTimeData)),e={seq:c.getSeq(),timestamp:l.getTimeStamp(),value:{boardId:this.currentBoard,operator:this.identifier,actions:t}};this.realTimeData=[],t.length&&this.fireSyncDataEvent(this.currentBoard,e)}}else this.realTimeData=[]},at.prototype.fireSyncDataEvent=function(t,e){var r=this;JSON.stringify(e).length>i.REALTIMEDATA_MAX_LENGTH?this.uploadBoardMessageToCos(JSON.stringify(e)).then(function(e){var o={seq:c.getSeq(),timestamp:l.getTimeStamp(),value:{boardId:t,operator:r.identifier,actions:[{action:i.PROTOCOL_ACTION.FILE_MESSAGE_ACTION,seq:c.getSeq(),url:e,boardId:t}]}};r.addSendAckData(JSON.stringify(o),!1),r.event.fire(r,"TEB_SYNCDATA",o)}):(this.addSendAckData(JSON.stringify(e),!1),this.event.fire(this,"TEB_SYNCDATA",e))},at.prototype.addHistory=function(t,e){var r=this,o=this;this.sortBoard(),t.forEach(function(t){var e,n;try{t.content=JSON.parse(t.content)}catch(t){}if("setGlobalBG"===t.type);else if("createBoards"===t.type)t.content&&t.content.createBoards.forEach(function(t){(e=t)&&!o.userData[e]&&o.addBoard(e,!1)});else if("addFile"===t.type){for(var a=t.content.fid,s=t.content.title,c=t.content.downloadURL,u=t.content.pageCount,f=t.content.currentPageIndex,p=t.content.currentPageStep||0,_=t.content.timestamp,T=t.content.uid,b=t.content.platform,v=t.content.type,E=t.content.ratio,S=t.content.scale,D=!1,A=0,C=o.groups.length;A<C;A++){var O=o.groups[A];if(O.fid==a){O.title=s,O.downloadURL=c,O.pageCount=u,O.currentPageIndex=f,O.currentPageStep=p,O.timestamp=_,O.uid=T,O.type=v,O.ratio=E,O.scale=S,D=!0;break}}if(D?D&&a===i.COMMON_GROUP&&o.event.fire(r,"TEB_ADDFILE",a):o.addGroupNotReport(a,s,T,c,u,f,_,b,v,p,E,S),!_&&!T)return;if(a!=i.COMMON_GROUP){for(var R=[],I=o.createBoardIdForFile(a,T,_,u,b),x=[],B=c?l.fileDownLoadUrlToPreviewUrl(c):"",P=0;P<u;P++)e=I[P],B&&(B.endsWith("/")?x.push("".concat(B).concat(P+1,".jpg")):x.push(B+(P+1))),e&&!o.userData[e]&&R.push(e);if(o.addBoard(R),c)if(v==i.FILE_TYPE.IMG)o.addBackgroundPic({boardIds:I,urls:x,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1});else if(v==i.FILE_TYPE.IMAGESFILE){var w=(new Date).getTime(),N=l.decompress(c),L=(new Date).getTime();x=JSON.parse(N),o.addBackgroundPic({boardIds:I,urls:x,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1});var k=L-w;y.report("add_images_file_history",{extra_info:JSON.stringify({urls:N,urls_length:N.length,elapse:k})})}}o.sortGroup()}else e=t.content.boardId,n=t.content.uid,e&&!o.userData[e]&&o.addBoard(e,!1),e&&!o.userData[e][n]&&(o.userData[e][n]=[]);if(t.content.colorRGBA&&(t.content.color=l.dealColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){for(var M,q=0;q<t.content.points.length;q++){var F=t.content.points[q].x,U=t.content.points[q].y,G=t.content.points[0].seq;0==q?M=new d(n,{color:t.content.color,thin:t.content.thin,x:F,y:U,seq:t.content.points[q].seq,belongSeq:G,show:!t.content.hidden}):(M.lines.push({x:F,y:U,belongSeq:G,seq:t.content.points[q].seq}),q==t.content.points.length-1&&(M.sort(),M.endSeq=t.content.points[q].seq)),M.setBorder(F,U)}if(M){var H=!1;o.userData[e][n].forEach(function(t,r){t.seq===M.seq&&(o.userData[e][n][r]=M,H=!0)}),H||o.userData[e][n].push(M),H=!1,o.data[e].forEach(function(t,r){t.seq===M.seq&&(o.data[e][r]=M,H=!0)}),H||o.data[e].push(M)}}else if("addText"==t.type){var j=new g(n,{belongSeq:t.content.belongSeq,x:t.content.x,y:t.content.y});j.seq=t.content.belongSeq,j.scale=t.content.scale,j.color=t.content.color,j.typeFace=t.content.typeface,j.textSize=t.content.textSize,j.fontStyle=t.content.fontStyle,j.time=t.content.time,j.text=unescape(decodeURI(t.content.text)),j.show=!t.content.hidden,o.userData[e][n].push(j),o.data[e].push(j)}else if("displayLine"==t.type)t.content.lines.forEach(function(e){for(var r=0;r<o.userData[o.currentBoard][n].length;r++){var i=o.userData[o.currentBoard][n][r];"line"==i.type&&i.startSeq==e.seq?i.show=!!t.content.display:"graph"==i.type&&i.startPoint.seq==e.seq?i.show=!!t.content.display:"inputtext"==i.type&&i.belongSeq==e.seq&&(i.show=!!t.content.display)}});else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var V=new h(n,t.content);o.userData[e][n].push(V),o.data[e].push(V)}else if("image"==t.type)t.content.url?o.addBackgroundPic({boardIds:t.content.boardId,urls:t.content.url,type:t.content.type,needReport:!1,position:t.content.mode}):o.deleteBackgroundPic(t.content.boardId);else if("clean"==t.type)o.clearBoard(!1);else if("cleanDraws"==t.type)o.clearBoard(!0);else if("switchBoard"==t.type){if(!e)return;(1*t.seq||0)>o.maxSeq?(o.maxSeq=t.seq,o.data[e]||o.addBoard(e,!1),o.currentBoard=e,e===i.COMMON_DEFAULT_BOARD?o.currentGroup=i.COMMON_GROUP:o.currentGroup=e.match(/\d+_#\w+$/)[0].split("_")[1],o.event.fire(r,"TEB_GOTOBOARD",e,l.boardId2Fid(e))):y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:o.maxSeq,boardId:e,method:"addHistory"})})}else if("setBoardBG"==t.type)o.setBackgroundColor({boardId:e,color:t.content.colorRGBA},!0);else if("setGlobalBG"==t.type)o.setGlobalBackgroundColor(t.content.colorRGBA,!0);else if("drag"==t.type)r.dragDataList.addDragData(e,new Y({scale:t.content.scale,xOffset:t.content.xOffset,yOffset:t.content.yOffset}));else if("setRatio"==t.type){var K=t.content||{};for(var W in K)r.boardRatio[W]=K[W]}}),e?o.event.fire(o,"TEB_DRAW_FACE"):o.setNeedDraw(!0)},at.prototype.undo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var o=this.userData[this.currentBoard][e.user][r];if(e.seq==o.seq){o.show=!1,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];"line"==i.type&&e.seq==i.seq?i.show=!0:"graph"==i.type&&e.seq==i.startPoint.seq?i.show=!0:"inputtext"==i.type&&e.seq==i.belongSeq&&(i.show=!0)}}),this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:e.seq});else if("graph"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var a=this.userData[this.currentBoard][e.user][n];if("graph"==a.type&&e.seq==a.startPoint.seq){a.show=!1,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var s=0;s<this.userData[this.currentBoard][e.user].length;s++){var u=this.userData[this.currentBoard][e.user][s];if("inputtext"==u.type&&e.seq==u.belongSeq){u.show=!1,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var d=[];e.seq.origin.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o],n=0,a=0;"line"==i.type&&e.seq==i.seq?(n=e.x-i.lines[0].x,a=e.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(function(t){t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(function(t){t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"graph"==i.type&&e.seq==i.startPoint.seq?(n=e.x-i.startPoint.x,a=e.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"inputtext"==i.type&&e.seq==i.belongSeq&&(i.location.x=e.x,i.location.y=e.y,d.push({uid:r,seq:i.belongSeq,x:e.x,y:e.y}))}}),this.addRealtimeData({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),moves:d});var h=[];e.seq.origin.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var n=[];i.lines.forEach(function(t){n.push({seq:t.seq,x:t.x,y:t.y})}),h.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:n}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,fillRect:i.solid?1:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"rect"==i.graph&&(a.content.cornerRadius=0),h.push(a)}else"inputtext"===i.type&&e.seq==i.belongSeq&&h.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),this.report.reportGraphData(h)}this.opIndex[this.currentBoard]--,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},at.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},at.prototype.redo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var o=this.userData[this.currentBoard][e.user][r];if(e.seq==o.seq){o.show=!0,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var a=this.userData[this.currentBoard][e.user][n];if("inputtext"==a.type&&e.seq==a.belongSeq){a.show=!0,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];"line"==i.type&&e.seq==i.seq?i.show=!1:"graph"==i.type&&e.seq==i.startPoint.seq?i.show=!1:"inputtext"===i.type&&e.seq==i.belongSeq&&(i.show=!1)}}),this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:e.seq});else if("graph"==e.type)for(var s=0;s<this.userData[this.currentBoard][e.user].length;s++){var u=this.userData[this.currentBoard][e.user][s];if("graph"==u.type&&e.seq==u.startPoint.seq){u.show=!0,this.addRealtimeData({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var d=[];e.seq.final.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o],n=0,a=0;"line"==i.type&&e.seq==i.seq?(n=e.x-i.lines[0].x,a=e.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(function(t){t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(function(t){t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"graph"==i.type&&e.seq==i.startPoint.seq?(n=e.x-i.startPoint.x,a=e.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"inputtext"==i.type&&e.seq==i.belongSeq&&(i.location.x=e.x,i.location.y=e.y,d.push({uid:r,seq:i.belongSeq,x:e.x,y:e.y}))}}),this.addRealtimeData({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),moves:d});var h=[];e.seq.final.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var n=[];i.lines.forEach(function(t){n.push({seq:t.seq,x:t.x,y:t.y})}),h.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:n}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"oval"==i.graph||"circle"==i.graph?a.content.fillRect=0:"rect"==i.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),h.push(a)}else"inputtext"===i.type&&e.seq==i.belongSeq&&h.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),this.report.reportGraphData(h)}this.opIndex[this.currentBoard]++,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},at.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},at.prototype.syncHistroyData=function(){var t=this,e=this,r=[],o=[],i=[],n=[],a=0,s=!1;return new Promise(function(c,u){!function c(u,d,h){var f=l.getTimeStamp();new Promise(function(r,o){t.request.getBoardData(u,function(t,i){t.error_code?(y.report("getBoardData",{action_result:t.error_code,action_info:t.error_msg,time_consume:l.getTimeStamp()-f,extra_info:JSON.stringify(t)}),o("error_code:".concat(t.error_code," error_msg:").concat(t.error_msg)),e.event.fire(this,"TEB_ERROR",I.TEDU_BOARD_ERROR_HISTORYDATA,"sync data error")):(y.report("getBoardData",{time_consume:l.getTimeStamp()-f,extra_info:JSON.stringify(t)}),r({res:t,isFirstTimeResp:i}))},function(t){o("error_code:".concat(t," error_msg:HTTP请求错误，请重试")),e.event.fire(this,"TEB_ERROR",I.TEDU_BOARD_ERROR_HISTORYDATA,"sync data error")})}).then(function(l){var u=l.res;l.isFirstTimeResp&&(r=[],o=[],i=[],n=[],a=0,s=!1,e.clearBoard(!0,!1,!0),e.resetData()),(u.board_data_list||[]).forEach(function(a){if(!s||"switchBoard"!==a.type)if("switchBoard"===a.type){s=!0,e.faceData.push(a);var c=JSON.parse(a.content).fid;i=i.filter(function(t){return JSON.parse(t.content).fid!=c||(n.push(t),!1)}),t.renderFace(n,e.faceData,r)}else"setGlobalBG"===a.type?r.push(a):"addFile"===a.type?i.push(a):s?o.push(a):e.faceData.push(a)}),a++,!u.is_finish&&a<100?c(!1,d,h):d()}).catch(function(r){var o="",i="";try{o=r.message,i=r.stack}catch(r){o="sync data error"}e.event.fire(t,"TEB_ERROR",I.TEDU_BOARD_ERROR_HISTORYDATA,o),y.report("getBoardData",{action_result:-1,action_info:"自定义错误",time_consume:l.getTimeStamp()-f,extra_info:JSON.stringify({stack:i,message:o})})})}(!0,function(){var t=this;s||(e.addHistory(r),o=o.concat(e.faceData),e.faceData=[]),e.addHistory(i),e.addHistory(o),e.fixBoardData(),e.sortBoard(),e.syncBoardSeq(),setTimeout(function(){e.event.fire(t,"TEB_HISTROYDATA_SYNCCOMPLETED")},200)})})},at.prototype.renderFace=function(t,e,r){this.addHistory(r),this.addHistory(t),this.addHistory(e,!0)},at.prototype.fixBoardData=function(){var t=this;try{var e=[];this.getGroup().forEach(function(t){e.push(t.fid)});var r=[];this.boardList.forEach(function(o,n){var a=l.boardId2Fid(o);a!=i.COMMON_GROUP&&-1===e.indexOf(a)&&(r.push(n),delete t.userData[o],delete t.data[o],delete t.opData[o],delete t.opIndex[o],delete t.backgroundPic[o],delete t.backgroundColor[o])}),r.sort(function(t,e){return e-t}),r.forEach(function(e){t.boardList.splice(e,1)})}catch(t){}},at.prototype.sortBoard=function(){this.boardList=this.boardList.sort(function(t,e){var r=t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_\d+_#\w+$/)[0].split("_")[0],o=e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_\d+_#\w+$/)[0].split("_")[0];return r!=o?r-o:(t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0])})},at.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===i.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=1*this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},at.prototype.sortGroup=function(){this.groups=this.groups.sort(function(t,e){return t.fid===i.COMMON_GROUP?-1:e.fid===i.COMMON_GROUP?1:1*t.fid.replace(/\D*/,"")-1*e.fid.replace(/\D*/,"")})},at.prototype.addData=function(t){var e=this;if(this.permissions){if(t=JSON.parse(JSON.stringify(t)))try{var r=[6,7],o=t.value.actions.filter(function(t){return-1===r.indexOf(t.action)});o.length&&y.report("addData",{extra_info:JSON.stringify({seq:t.seq,timestamp:t.timestamp,value:{boardId:t.value.boardId,operator:t.value.operator,actions:o}})})}catch(t){}var n=t.value.operator,a=t.value.actions,s=t.value.boardId;this.userData[s]||this.addBoard(s,!1),this.userData[s][n]||(this.userData[s][n]=[]),this.userData[s][n].length,a.forEach(function(t){var r;if(s=t.toBoardId||t.boardId||s,t.color&&(t.color=l.dealColor(t.color)),1==t.action){if((r=e.findLine(s,n,t))?(r.color=t.color,r.thin=t.thin,r.show=!0,r.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),r.sort(),r.setBorder(t.x,t.y)):((r=new d(n,t)).show=!0,e.userData[s][n].push(r),e.data[s].push(r)),0!==r.endSeq&&e.smoothLevel>0){var o=[];r.lines.forEach(function(t){o.push([t.x,t.y])}),r.fitCurve=j(o,1e4*e.smoothLevel,null)}}else if(2==t.action||3==t.action){if((r=e.findLine(s,n,t))?(r.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),r.sort(),r.setBorder(t.x,t.y)):(r=new d(n,t),e.userData[s][n].push(r),e.data[s].push(r)),3==t.action&&(r.endSeq=t.seq,function(t,r){setTimeout(function(){t.color&&t.thin||e.request.getLineData({boardId:r,owner:t.user,seq:t.belongSeq},function(t){t.error_code||(e.addHistory([{content:t.content,type:t.type}]),e.sortBoard(),e.syncBoardSeq())})},500)}(r,s)),0!==r.endSeq&&e.smoothLevel>0){var a=[];r.lines.forEach(function(t){a.push([t.x,t.y])}),r.fitCurve=j(a,1e4*e.smoothLevel,null)}}else if(6==t.action){e.userData[s][n].forEach(function(t){"raser"==t.type&&(t.status=0)});var u=new p(e.identifier,{color:t.color,radius:t.r,x:t.x,y:t.y,seq:c.getSeq()});e.userData[s][n].push(u),e.data[s].push(u)}else if(7==t.action)e.userData[s][n].forEach(function(t){"raser"==t.type&&(t.status=0)});else if(8==t.action){if(!t.lines)return;t.lines.forEach(function(r){for(var o=0;o<e.userData[s][r.uid].length;o++){var i=e.userData[s][r.uid][o];"line"==i.type&&i.startSeq==r.seq?i.show=!!t.display:"graph"==i.type&&i.startPoint.seq==r.seq?i.show=!!t.display:"inputtext"==i.type&&i.belongSeq==r.seq&&(i.show=!!t.display)}})}else if(9==t.action){if(!t.moves)return;t.moves.forEach(function(t){for(var r=0;r<e.userData[s][t.uid].length;r++){var o=e.userData[s][t.uid][r],i=0,n=0;"line"==o.type&&o.startSeq==t.seq?(i=t.x-o.lines[0].x,n=t.y-o.lines[0].y,o.border.maxX+=i,o.border.minX+=i,o.border.maxY+=n,o.border.minY+=n,o.lines.forEach(function(t){t.x+=i,t.y+=n}),0!==o.fitCurve.length&&o.fitCurve.forEach(function(t){t[1][0]+=i,t[1][1]+=n,t[2][0]+=i,t[2][1]+=n,t[3][0]+=i,t[3][1]+=n})):"graph"==o.type&&o.startPoint.seq==t.seq?(i=t.x-o.startPoint.x,n=t.y-o.startPoint.y,o.startPoint.x+=i,o.startPoint.y+=n,o.endPoint.x+=i,o.endPoint.y+=n):"inputtext"==o.type&&o.belongSeq==t.seq&&(o.location.x=t.x,o.location.y=t.y)}})}else if(10==t.action||11==t.action||12==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.solid=!!t.fillRect,t.show=!0;var f=new h(n,t);e.userData[s][n].push(f),e.data[s].push(f)}else if(13==t.action)if((1*t.seq||0)>e.maxAddTextSeq){e.maxAddTextSeq=t.seq;for(var m=null,_=0;_<e.userData[s][n].length;_++){var T=e.userData[s][n][_];if(T.belongSeq===t.belongSeq){t.seq>T.seq&&(T.seq=t.seq),m=T;break}}m?m.text=unescape(decodeURI(t.text)):((m=new g(n,{x:t.x,y:t.y,belongSeq:t.belongSeq})).color=t.color,m.scale=t.scale,m.typeFace=t.typeFace,m.textSize=t.textSize,m.fontStyle=t.fontStyle,m.time=t.time,m.text=unescape(decodeURI(t.text)),e.userData[s][n].push(m),e.data[s].push(m))}else y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxAddTextSeq:e.maxAddTextSeq,boardId:s,method:"addData"})});else if(101==t.action)e.clearBoard(!1);else if(102==t.action)e.clearBoard(!0);else if(103==t.action)try{e.clearFileDrawData(t.fids)}catch(t){}else if(104==t.action)e.resetData();else if(t.action==i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION)e.setBoardRatio(s,t.ratio,!1);else if(201==t.action)e.addBackgroundPic({boardIds:s,urls:t.url,type:t.type,needReport:!1,position:t.mode});else if(202==t.action)e.deleteBackgroundPic(s);else if(203==t.action)t.color&&(t.color=l.formatColor(t.color)),t.isGlobal?e.setGlobalBackgroundColor(t.color,!0):e.setBackgroundColor(t.color,!0);else if(t.action==i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION)if((1*t.seq||0)>e.maxMoveSeq){e.maxMoveSeq=t.seq;var b=e.dragDataList.getDragData(s);b?e.dragDataList.updateDragData(s,{scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}):(b=new Y({scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}),e.dragDataList.addDragData(s,b))}else y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxMoveSeq:e.maxMoveSeq,boardId:s,method:"addData"})});else 401==t.action?e.resolveSwitchBoardAction(t):501==t.action?e.resolveAddFileAction(t.file):t.action===i.PROTOCOL_ACTION.FILE_MESSAGE_ACTION&&e.resolveFileMessage(t)}),this.setNeedDraw(!0)}},at.prototype.resolveSwitchBoardAction=function(t){var e=this,r=t.toBoardId,o=[],n=[];if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq,o=t.deleteFiles||[],n=t.deleteBoards||[],o.forEach(function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))}),n.forEach(function(t){e.removeBoard(t)}),this.data[r]||this.addBoard(r,!1),this.currentBoard=r;var a=l.boardId2Fid(r);this.currentGroup=a;var s=Math.max(t.page,0),c=Math.max(t.step,0),u=this.getFileInfo(a);u?(u.type===i.FILE_TYPE.H5PPT&&C.gotoTimestampNew(this.iframeDom,{slideIndex:s,stepIndex:c,isPassive:!0}),this.updateFileInfo({fid:a,pageCount:this.getBoardByGroup(a).length,currentPageIndex:s||0,currentPageStep:c||0}),this.event.fire(this,"TEB_GOTOBOARD",r,l.boardId2Fid(r))):this.request.getFileInfo({fid:a},function(t){t&&0==t.error_code&&(u=JSON.parse(t.content),e.resolveAddFileAction(u),e.setNeedDraw(!0),setTimeout(function(){u.type===i.FILE_TYPE.H5PPT&&C.gotoTimestampNew(e.iframeDom,{slideIndex:s,stepIndex:c,isPassive:!0}),e.updateFileInfo({fid:a,pageCount:e.getBoardByGroup(a).length,currentPageIndex:s||0,currentPageStep:c||0}),e.event.fire(e,"TEB_GOTOBOARD",r,l.boardId2Fid(r))},200))},function(t){})}else o=t.deleteFiles||[],n=t.deleteBoards||[],o.forEach(function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))}),n.forEach(function(t){e.removeBoard(t)}),y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:r,method:"addData"})})},at.prototype.resolveAddFileAction=function(t){var e=null,r=[];if(t.type===i.FILE_TYPE.H5PPT){r=[];for(var o=0;o<t.pageCount;o++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(o+1,"_").concat(t.fid),r.push(e);this.addBoard(r,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.H5PPT,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}else if(t.type==i.FILE_TYPE.IMG){var n=t.downloadURL,a=n?l.fileDownLoadUrlToPreviewUrl(n):"",s=[];r=[];for(var c=0;c<t.pageCount;c++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(c+1,"_").concat(t.fid),r.push(e),a.endsWith("/")?s.push("".concat(a).concat(c+1,".jpg")):s.push(a+(c+1));this.addBoard(r,!1),n&&this.addBackgroundPic({boardIds:r,urls:s,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.IMAGE,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}else if(t.type==i.FILE_TYPE.IMAGESFILE){if(t.downloadURL){var u=(new Date).getTime(),d=l.decompress(t.downloadURL),h=(new Date).getTime();s=JSON.parse(d);var f=h-u;y.report("add_images_file_peer",{extra_info:JSON.stringify({urls:d,urls_length:d.length,elapse:f})}),this.addImagesToBoard(t,s)}}else if(t.type==i.FILE_TYPE.VOD||t.type==i.FILE_TYPE.VODFILE||t.type==i.FILE_TYPE.LIVE||t.type==i.FILE_TYPE.H5FILE){r=[];for(var p=0;p<t.pageCount;p++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(p+1,"_").concat(t.fid),r.push(e);this.addBoard(r,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,t.type,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)}},at.prototype.addImagesToBoard=function(t,e){for(var r=null,o=[],i=0;i<t.pageCount;i++)r="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(i+1,"_").concat(t.fid),o.push(r);this.addBoard(o,!1),e&&e.length>0&&this.addBackgroundPic({boardIds:o,urls:e,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,t.type,0,t.ratio,t.scale,t.isTranscodeFile,t.status,t.progress)},at.prototype.resolveUpdateVideoAction=function(t){if((1*t.seq||0)>this.maxVideoSeq){this.maxVideoSeq=t.seq;var e=t.status,r=t.progress,o=t.fid,i=t.time;this.updateFileInfo({fid:o,status:e,progress:r,timestamp:i})}},at.prototype.addFile=function(t,e,r,o,n,a){if(!Array.isArray(e))return"";t=t||"#".concat(l.getTimeStamp());var s,u,d,h,f,p=l.getSecondTime();if(s=this.createBoardIdForFile(t,this.user,p,e.length,i.PLATFORM)||[],n=(d=(u=2===this.boardContentFitMode||1===this.boardContentFitMode?l.calcRatioWidthHeight(n,i.RATIO):l.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(h=u.ratioHeight),2===this.boardContentFitMode){var g=this.containerWidth/d,m=this.containerHeight/h,_=Math.min(g,m);f=Math.max(g,m)/_*100}else this.boardContentFitMode,f=100;this.addGroup(t,r,this.user,o,e.length,0,p,i.PLATFORM,a,0,n,f),this.addBoard(s),this.addBackgroundPic({boardIds:s,urls:e});var y={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),file:{fid:t,title:r,downloadURL:o,pageCount:e.length,uid:this.identifier,timestamp:p,platform:i.PLATFORM,type:a,ratio:n,scale:f}};return this.addRealtimeData(y),s.length&&this.switchFile(t),t},at.prototype.addH5PPTFile=function(t,e,r,o,n){for(var a=!1,s=this.getGroup()||[],u=0,d=s.length;u<d;u++)if(s[u].downloadURL==t){a=!0;break}if(!a){var h,f="#".concat(l.getTimeStamp()),p=l.getSecondTime();h=this.createBoardIdForFile(f,this.user,p,r,i.PLATFORM)||[];var g,m,_,y,T=null;if(o&&n){var b=l.maxCommonDivisor(o,n);T=o/b+":"+n/b}else T=this.ratio;if(T=(m=(g=2===this.boardContentFitMode||1===this.boardContentFitMode?l.calcRatioWidthHeight(T,i.RATIO):l.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(_=g.ratioHeight),2===this.boardContentFitMode){var v=this.containerWidth/m,E=this.containerHeight/_,S=Math.min(v,E);y=Math.max(v,E)/S*100}else this.boardContentFitMode,y=100;this.addGroup(f,e,this.user,t,r,0,p,i.PLATFORM,i.FILE_TYPE.H5PPT,0,T,y),this.addBoard(h);var D={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),file:{fid:f,title:e,downloadURL:t,pageCount:r,uid:this.identifier,timestamp:p,platform:i.PLATFORM,type:i.FILE_TYPE.H5PPT,ratio:T,scale:y}};return this.addRealtimeData(D),h.length&&this.switchFile(f),f}},at.prototype.deleteFile=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentFile();if(t===i.COMMON_GROUP)return!1;var e=this.deleteGroup(t);return this.event.fire(this,"TEB_DELETEFILE",t),this.switchFile(i.COMMON_GROUP),!(!e||!e.length||(this.deleteBoard(e,t),0))},at.prototype.switchFile=function(t){for(var e=!1,r=0,o=this.groups.length;r<o;r++)if(this.groups[r].fid==t){e=!0;break}if(e){this.currentGroup=t;var i=this.getFileInfo(t),n=Math.max(0,i.currentPageIndex),a=this.getBoardByGroup(t)[n];return this.event.fire(this,"TEB_SWITCHFILE",t),this.switchBoard(a),t}return!1},at.prototype.setBoardSize=function(t,e){this.boardWidth=t,this.boardHeight=e},at.prototype.setContainerSize=function(t,e){this.containerWidth=t,this.containerHeight=e},at.prototype.setCanvasContext=function(t){this.ctx=t},at.prototype.setIframeDom=function(t){this.iframeDom=t},at.prototype.setBoardRatio=function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.boardRatio[t]=e;var o={};o[t]=e,r&&this.addRealtimeData({action:i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION,seq:c.getSeq(),ratio:e}),r&&this.report.reportsetBoardRatio(o)},at.prototype.getBoardRatio=function(){if(this.getCurrentFile()===i.COMMON_GROUP)return this.boardRatio[this.currentBoard]||this.ratio;var t=this.boardRatio[this.currentBoard];if(t)return t;var e=this.getFileInfo(this.getCurrentFile());return e&&e.ratio?e.ratio:this.ratio},at.prototype.addDragData=function(t,e){var r=new Y(e);this.dragDataList.addDragData(t,r)},at.prototype.getDragData=function(){return this.dragDataList.getDragData(this.currentBoard)},at.prototype.setBoardScale=function(t){t||(t=i.SCALE),t=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,t));var e=this.dragDataList.getDragData(this.currentBoard);e?this.dragDataList.updateDragData(this.currentBoard,{scale:t}):(e=new Y({scale:t,xOffset:50,yOffset:50}),this.dragDataList.addDragData(this.currentBoard,e)),this.addRealtimeData(e.getRealTimeData()),this.report.reportDrag(Object.assign(e.getReportData(),{boardId:this.currentBoard})),this.setNeedDraw(!0)},at.prototype.getBoardScale=function(){var t,e=this.dragDataList.getDragData(this.currentBoard);if(e)t=e.scale;else{var r=this.getFileInfo(this.getCurrentFile());r&&(t=r.scale),t||(t=this.scale)}return t},at.prototype.setBoardContentFitMode=function(t){this.boardContentFitMode=t||x},at.prototype.getBoardContentFitMode=function(){return this.boardContentFitMode||x},at.prototype.updateFileInfo=function(t){for(var e=t.fid,r=!1,o=0,i=this.groups.length;o<i;o++){var n=this.groups[o];if(n.fid==e){n.title=n.title||t.title,n.pageCount=t.pageCount,n.currentPageIndex=void 0===t.currentPageIndex?n.currentPageIndex:t.currentPageIndex,n.currentPageStep=void 0===t.currentPageStep?n.currentPageStep:t.currentPageStep,n.downloadURL=n.downloadURL||t.downloadURL,n.uid=n.uid||t.uid,n.timestamp=n.timestamp||t.timestamp,n.ratio=t.ratio||n.ratio,n.scale=t.scale||n.scale,r=!0;break}}r||this.groups.push({fid:t.fid,title:t.title,pageCount:t.pageCount,currentPageIndex:t.currentPageIndex||0,currentPageStep:t.currentPageStep||0,downloadURL:t.downloadURL,uid:t.uid,timestamp:t.timestamp,type:t.type||0,ratio:t.ratio||0,scale:t.scale})},at.prototype.isExistH5PPTUrl=function(t){for(var e=!1,r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=!0;break}return e},at.prototype.getH5PPTByUrl=function(t){for(var e={},r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=r[o];break}return e},at.prototype.applyFileTranscode=function(t,e){var r=this;if(l.isObject(t)){var o=t.userData;if("image"===t.type){var i={code:"FailedOperation.SdkModule",message:"transcode does not support image",userData:o,Status:"ERROR"};return this.event.fire(this,et.TEB_TRANSCODEPROGRESS,i),void y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(i)})}"file"===t.type&&this.fileCos.transcodeUploadFile(t).then(function(t){var i="https://".concat(t.Bucket,".file.myqcloud.com/").concat(t.Key);e=l.isObject(e)?Object.assign(e,{url:i}):{url:i};var n=null;r.createTranscode(e).then(function(t){if(t.data.Response.Error)n={code:t.data.Response.Error.Code,message:t.data.Response.Error.Message,Status:"ERROR",userData:o},r.event.fire(r,et.TEB_TRANSCODEPROGRESS,n);else{n=Object.assign({},t.data.Response,{code:"",message:"",userData:o,Status:"CREATE"}),r.event.fire(r,et.TEB_TRANSCODEPROGRESS,n);var e=t.data.Response.TaskId;r.transcodeIntervalMap[e]=setInterval(function(){r.describeTranscode({taskId:e})},5e3),r.taskIdUserDataMap[e]=o}y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(n)})},function(t){var e={code:"FailedOperation.SdkModule",message:"transcode failure, request error",userData:o,Status:"ERROR"};r.event.fire(r,et.TEB_TRANSCODEPROGRESS,e),y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(e)})}).catch(function(t){var e={code:"FailedOperation.SdkModule",message:"transcode failure, "+t.message,userData:o,Status:"ERROR"};r.event.fire(r,et.TEB_TRANSCODEPROGRESS,e),y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(e)})})}).catch(function(t){var e={Status:"ERROR",code:"FailedOperation.SdkModule",message:"upload file failure, "+t.message,userData:o};r.event.fire(r,et.TEB_TRANSCODEPROGRESS,e),y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(e)})})}else{var n={code:"FailedOperation.SdkModule",message:"invalid arguments",Status:"ERROR",userData:""};this.event.fire(this,et.TEB_TRANSCODEPROGRESS,n),y.report(et.TEB_TRANSCODEPROGRESS,{extra_info:JSON.stringify(n)})}},at.prototype.createTranscode=function(t){return this.request.createTranscode(t)},at.prototype.describeTranscode=function(t){var e=this,r=null;this.request.describeTranscode(t).then(function(o){o.data.Response.Error?(r={Status:"ERROR",code:o.data.Response.Error.Code,message:o.data.Response.Error.Message,taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]},e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),clearInterval(e.transcodeIntervalMap[t.taskId]),y.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)})):o.data.Response&&(r=Object.assign({code:"",message:"",userData:e.taskIdUserDataMap[t.taskId]},o.data.Response),e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),"FINISHED"===o.data.Response.Status&&(clearInterval(e.transcodeIntervalMap[t.taskId]),y.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)})))},function(o){r={Status:"ERROR",code:"FailedOperation.SdkModule",message:"transcode failure, request error",taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]},e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),clearInterval(e.transcodeIntervalMap[t.taskId]),y.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)})}).catch(function(o){r={Status:"ERROR",code:"FailedOperation.SdkModule",message:"transcode failure, "+o.message,taskId:t.taskId,userData:e.taskIdUserDataMap[t.taskId]},e.event.fire(e,"TEB_TRANSCODEPROGRESS",r),clearInterval(e.transcodeIntervalMap[t.taskId]),y.report("TEB_TRANSCODEPROGRESS",{extra_info:JSON.stringify(r)})})},at.prototype.destroy=function(){this.heartbeat&&this.heartbeat.destroy(),this.sendInterval&&clearInterval(this.sendInterval)},at.prototype.getFileInfoByUrl=function(t){for(var e={},r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=r[o];break}return e},at.prototype.addRealtimeData=function(t){this.dataSyncEnable&&(t.boardId=this.currentBoard,this.realTimeData.push(t))},at.prototype.addSendAckData=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.dataSyncEnable){try{t=JSON.parse(t)}catch(t){}t.value.actions=t.value.actions.filter(function(t){return 6!=t.action}),this.sendAckDatas[t.seq]?delete this.sendAckDatas[t.seq]:e||(this.sendAckDatas[t.seq]=t)}},at.prototype.addReportAckData=function(t){var e=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach(function(t,o){e.reportAckDatas[t.seq]?delete e.reportAckDatas[t.seq]:r||(e.reportAckDatas[t.seq]=t)})},at.prototype.syncAndReload=function(){var t=this;if(this.permissions){var e=Object.keys(this.reportAckDatas).length;e?(this.request.reportMsg(Object.values(this.reportAckDatas),function(e,r){t.syncHistroyData()}),y.report("sync_report_failed",{extra_info:JSON.stringify({count:e})}),this.reportAckDatas={}):this.syncHistroyData();var r=Object.keys(this.sendAckDatas).length;if(r>0){var o=null;Object.values(this.sendAckDatas).forEach(function(t,e){null==o?o=t:(t.timestamp>o.timestamp&&(o.timestamp=t.timestamp,o.seq=t.seq),o.value.actions.push.apply(o.value.actions,t.value.actions))}),null!=o&&this.fireSyncDataEvent(this.getCurrentBoard(),o),y.report("sync_send_failed",{extra_info:JSON.stringify({count:r})}),this.sendAckDatas={}}}},at.prototype.setImageTimeout=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.IMAGE_TIMEOUT;"[object Number]"!==Object.prototype.toString.call(t)&&(t=i.IMAGE_TIMEOUT),this.imageTimeout=t,y.report("call_method",{extra_info:JSON.stringify({method:"setImageTimeout",data:t})})},at.prototype.getImageTimeout=function(){return this.imageTimeout},at.prototype._setBackgroundImage=function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;if(l.isString(t))this.setBackgroundPic(t,r),this.event.fire(this,"TEB_SETBACKGROUNDIMAGE","",t,"");else if(l.isObject(t)){var o=t;this.fileCos.uploadImgFile(o).then(function(t){e.setBackgroundPic(t.fileUrl,r),e.event.fire(e,"TEB_SETBACKGROUNDIMAGE",t.fileName,t.fileUrl,t.userData)}).catch(function(t){})}},at.prototype.uploadBoardMessageToCos=function(t){var e=this;return new Promise(function(r,o){var n="".concat(e.user,"_").concat(l.formatDateTime(l.getTimeStamp()),".txt"),a=wx.env.USER_DATA_PATH+"/"+n;wx.getFileSystemManager().writeFile({filePath:a,data:t,success:function(t){e.fileCos.upload({bucket:e.fileMessageCosInfo.bucket,appid:e.fileMessageCosInfo.appid,region:e.fileMessageCosInfo.region,filePath:a,path:"message/"+e.options.tlsData.sdkAppId+"/"+e.options.classId+"/"+n}).then(function(t){var e=t.Bucket.substr(0,t.Bucket.lastIndexOf("-")),o="https://".concat(e,".").concat(i.CDN_DOMAIN,"/").concat(t.Key);try{wx.getFileSystemManager().unlink({filePath:a})}catch(t){}r(o)},function(t){try{wx.getFileSystemManager().unlink({filePath:a})}catch(t){}o(t)})},fail:function(t){}})})},at.prototype.resolveFileMessage=function(t){var e=this,r=t.url;this.request.requestFileMessage(r).then(function(t){200===t.statusCode&&e.addData(t.data)},function(t){})};var st=at,ct={TEDU_BOARD_IMAGE_STATUS_LOADING:1,TEDU_BOARD_IMAGE_STATUS_LOAD_DONE:2,TEDU_BOARD_IMAGE_STATUS_LOAD_ABORT:3,TEDU_BOARD_IMAGE_STATUS_LOAD_ERROR:4,TEDU_BOARD_IMAGE_STATUS_LOAD_TIMEOUT:5,TEDU_BOARD_IMAGE_STATUS_LOAD_CANCEL:6};function lt(t){if(!(this instanceof lt))return new lt(t);this.option=Object.assign({},t),this.event=this.option.event,this.aegis=this.option.aegis,this.orientation=this.option.orientation||"vertical",this.classId=this.option.classId,this.canDraw=!0,"[object Undefined]"===Object.prototype.toString.call(t.drawEnable)||"[object Null]"===Object.prototype.toString.call(t.drawEnable)?this.canDraw=!0:this.canDraw=!!t.drawEnable,this.pinchScale=[],this.beforePinchScale,this.isMoving=!1,this.minLineWidth=t.minLineWidth||i.MIN_LINE_WIDTH,this.store=new st(t),this.img=t.img,this.width=this.option.width,this.height=this.option.height,this.store.setBoardSize(this.width,this.height),this.canvasComponent=this.option.canvasComponent,this.canvasDrawComponent=this.option.canvasDrawComponent,this.containerOffset=this.option.containerOffset,this.context=this.option.context,this.store.setCanvasContext(this.canvasComponent),this.preloadTriggered=!1,this.touchData={onoff:!1,startx:-10,starty:-10,oldx:-10,oldy:-10,cpx:-10,cpy:-10,inCanvas:!1},this.boardImageLoadStatus={backgrounds:{},elements:{}},this.init()}lt.prototype.resize=function(t,e){this.width=t,this.height=e,this.store.setBoardSize(t,e),this.store.setNeedDraw(!0)},lt.prototype.getEventLocation=function(t){var e={x:0,y:0};if(e.x=t.changedTouches[0].x,e.y=t.changedTouches[0].y,"vertical"===this.orientation)e.x=parseInt(e.x/this.width*1e4),e.y=parseInt(e.y/this.height*1e4);else{var r=1e4-parseInt(e.x/this.height*1e4),o=parseInt(e.y/this.width*1e4);e.x=o,e.y=r}return e},lt.prototype.draw=function(){var t=this.canvasComponent,e=this.canvasDrawComponent;"horizontal"===this.orientation&&this.setCanvasTranslate(),t.clearRect(0,0,this.width,this.height);var r=this.store.getCurrentBoardData(),o=r.backgroundPic;this.renderBackgroundImageAndH5(o),this.renderBackgroundColor(r.backgroundColor),this.drawData(r.data,e,t)},lt.prototype.drawFace=function(){if(this.store.getCurrentBoard()){var t=this.canvasComponent,e=this.canvasDrawComponent;"horizontal"===this.orientation&&this.setCanvasTranslate(),t.clearRect(0,0,this.width,this.height);var r=this.store.getFaceData();r.fileInfo&&(this.preloadTriggered=!1,this.renderBackgroundImageAndH5(r.currentPic),this.renderBackgroundColor(r.backgroundColor),this.drawData(r.data,e,t),this.preloadTriggered||this.store.preloadBoard())}},lt.prototype.renderBackgroundImageAndH5=function(t){var e=this,r=this.getCurrentBoard(),o=this.boardImageLoadStatus.backgrounds,i=l.getTimeStamp();o?o.boardId!=r?"start"===o.status&&(this.event.fire(this,"TEB_IMAGE_STATUS_CHANGED",ct.TEDU_BOARD_IMAGE_STATUS_LOAD_CANCEL,{currentBoardId:o.boardId,currentImgUrl:o.url,errorMsg:""}),this.context.setCurrentImg("",o.boardId),o.status="cancel",y.report("load_cancel_img",{time_consume:l.getTimeStamp()-i,image_url:o.url,boardid:o.boardId,extra_info:JSON.stringify({image_url:o.url,boardid:o.boardId})})):"cancel"!==o.status&&"timeout"!==o.status&&o.status:(o={boardId:r,status:null,url:null},this.boardImageLoadStatus.backgrounds[r]=o),t.url&&t.show?this.context.setCurrentImg(t.url,this.getCurrentBoard(),function(n,a){e.event.fire(e,"TEB_IMAGE_STATUS_CHANGED",ct.TEDU_BOARD_IMAGE_STATUS_LOADING,{currentBoardId:a,currentImgUrl:n,errorMsg:""}),y.report("start_load_img",{image_url:n,boardid:a,extra_info:JSON.stringify({image_url:n,boardid:a})}),o.status="start",o.boardId=r,o.url=t.url,clearTimeout(e.checkImageStatusTask),e.checkImageStatusTask=setTimeout(function(){"start"===o.status&&(e.event.fire(e,"TEB_IMAGE_STATUS_CHANGED",ct.TEDU_BOARD_IMAGE_STATUS_LOAD_TIMEOUT,{currentBoardId:o.boardId,currentImgUrl:o.url,errorMsg:"timeout"}),e.context.setCurrentImg("",o.boardId),o.status="timeout",y.report("load_timeout_img",{time_consume:l.getTimeStamp()-i,image_url:o.url,boardid:o.boardId,extra_info:JSON.stringify({image_url:o.url,boardid:o.boardId})}))},1e3*e.store.getImageTimeout())},function(t,r){o.status="loaded",e.event.fire(e,"TEB_IMAGE_STATUS_CHANGED",ct.TEDU_BOARD_IMAGE_STATUS_LOAD_DONE,{currentBoardId:r,currentImgUrl:t,errorMsg:""}),y.report("load_succ_img",{image_url:t,boardid:r,extra_info:JSON.stringify({image_url:t,boardid:r})})},function(t,r,i){o.status="error",e.event.fire(e,"TEB_IMAGE_STATUS_CHANGED",ct.TEDU_BOARD_IMAGE_STATUS_LOAD_ERROR,{currentBoardId:r,currentImgUrl:t,errorMsg:i}),y.report("load_error_img",{image_url:t,boardid:r,extra_info:JSON.stringify({image_url:t,boardid:r,errorMsg:i})})}):this.context.setCurrentImg("",this.getCurrentBoard())},lt.prototype.renderBackgroundColor=function(t){t?this.context.setBoardBgColor(t):this.context.setBoardBgColor("")},lt.prototype.drawData=function(t,e,r){var o=this;if((t=t.sort(function(t,e){return t.seq-e.seq})).forEach(function(t){if("line"==t.type&&t.show)o.drawLine(r,t);else if("raser"==t.type&&t.status){var e,n,a;e=t.location.x/1e4*o.width,n=t.location.y/1e4*o.height,a=t.radius/1e4*o.height,r.beginPath(),r.arc(e,n,a,0,2*Math.PI),r.setFillStyle(l.dealColor(m.COLOR.RED)),r.fill(),r.closePath()}else if("select"==t.type&&t.show){var s,c,u,d;s=t.startInfo.x/1e4*o.width,c=t.startInfo.y/1e4*o.height,u=(t.location.x-t.startInfo.x)/1e4*o.width,d=(t.location.y-t.startInfo.y)/1e4*o.height,r.setLineDash([15,5]),r.setLineWidth(1),r.setStrokeStyle(o.store.color),r.strokeRect(s,c,u,d),r.setLineDash([])}else if("graph"==t.type&&t.show){var h,f,p,g,_;if(h=t.startPoint.x/1e4*o.width,f=t.startPoint.y/1e4*o.height,p=t.endPoint.x/1e4*o.width,g=t.endPoint.y/1e4*o.height,_=t.thin/1e4*o.height,"line"==t.graph)r.beginPath(),r.moveTo(h,f),r.lineTo(p,g),r.setLineWidth(_),r.setStrokeStyle(t.color),r.setLineCap("round"),r.stroke();else if("rect"==t.graph){var y=h>p?p:h,T=f>g?g:f,b=h+p-2*y,v=f+g-2*T;r.setStrokeStyle(t.color),r.setLineWidth(_),t.solid?(r.setFillStyle(t.color),r.fillRect(y,T,b,v)):r.strokeRect(y,T,b,v)}else if("circle"==t.graph||"oval"==t.graph){var E=(h+p)/2,S=(f+g)/2,D=Math.abs(h-p)/2,A=Math.abs(f-g)/2;r.setStrokeStyle(t.color),r.setLineWidth(_),function(t,e,r,o,i,n,a){var s=.5522848,c=o*s,l=i*s;t.beginPath(),t.moveTo(e-o,r),t.bezierCurveTo(e-o,r-l,e-c,r-i,e,r-i),t.bezierCurveTo(e+c,r-i,e+o,r-l,e+o,r),t.bezierCurveTo(e+o,r+l,e+c,r+i,e,r+i),t.bezierCurveTo(e-c,r+i,e-o,r+l,e-o,r),t.closePath(),t.stroke(),n&&(t.setFillStyle(a),t.fill())}(r,E,S,D,A,t.solid,t.color),r.stroke()}}else if("inputtext"==t.type&&t.show){var C=Math.max(i.MIN_FONT_SIZE,Math.ceil(t.textSize/1e4*o.height));r.beginPath(),r.setFontSize(C),r.setTextBaseline("top"),r.setFillStyle(t.color);var O=l.canvasTextAutoLine(r,t.text,t.location.x/1e4*o.width,t.location.y/1e4*o.height,o.width,C);t.textHeight=O;var R=0;(t.text.split("\n")||[]).forEach(function(t){R=Math.max(R,Math.ceil(r.measureText(t).width+10))}),t.textWidth=R,r.stroke()}}),o.isMoving){var n=o.store.getSelectArea(),a=o.store.getThin();r.setLineDash([15,5]),r.setLineWidth(1),r.strokeRect((n.x-a)/1e4*o.width,(n.y-a)/1e4*o.height,(n.width+2*a)/1e4*o.width,(n.height+2*a)/1e4*o.height),r.setLineDash([])}else this.store.getSelectList().forEach(function(t){if("line"==t.type)r.setLineDash([15,5]),r.setLineWidth(1),r.strokeRect((t.border.minX-2*t.thin)/1e4*o.width,(t.border.minY-2*t.thin)/1e4*o.height,(t.border.maxX-t.border.minX+4*t.thin)/1e4*o.width,(t.border.maxY-t.border.minY+4*t.thin)/1e4*o.height),r.setLineDash([]);else if("graph"==t.type){var e=t.endPoint.x,i=t.endPoint.y,n=t.startPoint.x,a=t.startPoint.y;e<n&&(e+=n,e-=n=e-n),i<a&&(i+=a,i-=a=i-a),r.setLineDash([15,5]),r.setLineWidth(1),r.strokeRect((n-2*t.thin)/1e4*o.width,(a-2*t.thin)/1e4*o.height,(e-n+4*t.thin)/1e4*o.width,(i-a+4*t.thin)/1e4*o.height),r.setLineDash([])}else"inputtext"==t.type&&(r.setLineDash([15,5]),r.setLineWidth(1),r.strokeRect(t.location.x/1e4*o.width-5,t.location.y/1e4*o.height-5,t.textWidth+10,t.textSize/1e4*o.height+10),r.setLineDash([]))});r.draw(),e.clearRect(0,0,this.width,this.height),e.draw(!1)},lt.prototype.addBoard=function(){return this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},lt.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},lt.prototype.addHistory=function(t){this.store.addHistory(t)},lt.prototype.addData=function(t){if("[object String]"===Object.prototype.toString.call(t))try{t=JSON.parse(t)}catch(e){this.event.fire(this,"TEB_WARNING",J.TEDU_BOARD_WARNING_SYNC_DATA_PARSE_FAILED,e.message+", "+t)}this.store.addData(t)},lt.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.getCurrentBoard();l.boardId2Fid(t)==i.COMMON_GROUP&&this.store.deleteBoard(t)},lt.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},lt.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},lt.prototype.getCurrentBoard=function(){return this.store.currentBoard},lt.prototype.getCurrentFile=function(){return this.store.getCurrentFile()},lt.prototype.addBoard=function(){return this.store.getCurrentFile()!=i.COMMON_GROUP&&this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},lt.prototype.switchBoard=function(t,e){var r=this;if(-1===this.getBoardList().indexOf(t)&&(t=i.COMMON_DEFAULT_BOARD),t){var o=l.boardId2Fid(t);if(this.getFileInfo(o).type===i.FILE_TYPE.H5PPT){var n=this.getBoardByGroup(o).indexOf(t);C.gotoTimestampNew(this.iframeDOM,{slideIndex:n,resetStep:e,isPassive:!1})}else this.store.switchBoard(t)}else clearTimeout(this.bgH5LoadTask),this.bgH5.removeAttribute("src"),this.bgH5LoadTask=setTimeout(function(){r.store.switchBoard(t)},50)},lt.prototype.switchPage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.store.switchPage(t)},lt.prototype.prevBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<1||this.switchBoard(r[e.currentPageIndex-1],t)},lt.prototype.prevStep=function(){var t=this.store.getFileInfo(this.store.getCurrentFile());t.type==i.FILE_TYPE.H5PPT?C.gotoPreviousStep(this.iframeDOM,{currentPageIndex:t.currentPageIndex,currentPageStep:t.currentPageStep}):this.prevBoard()},lt.prototype.nextBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<e.pageCount-1&&this.switchBoard(r[e.currentPageIndex+1],t)},lt.prototype.nextStep=function(){this.store.getFileInfo(this.store.getCurrentFile()).type==i.FILE_TYPE.H5PPT?C.gotoNextStep(this.iframeDOM,{}):this.nextBoard()},lt.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},lt.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},lt.prototype.init=function(){var t=this;y.report("init",{extra_info:JSON.stringify({orientation:this.orientation,width:this.width,height:this.height})}),this.event.on("TEB_DRAW_FACE",function(){try{t.drawFace()}catch(o){var e=o.stack,r="render face page："+o.message;y.report("drawerror",{boardid:t.store.getCurrentBoard(),extra_info:JSON.stringify({stack:e,message:r})})}}),this.drawInterval=setInterval(function(){if(t.store.getNeedDraw()){try{t.draw(),t.preloadTriggered||t.preloadBoard()}catch(e){y.report("drawerror",{boardid:t.store.getCurrentBoard(),extra_info:e.message})}t.store.setNeedDraw(!1)}},50),this.event.on("TEB_GOTOBOARD",function(e,r){t.context.setCurrentImg("",e)})},lt.prototype.stopDefaultEvent=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},lt.prototype.canvasTouchStart=function(t){var e=this.store.getType();"mouse"!=e?(this.stopDefaultEvent(t),this.canDraw&&(this.touchData.inCanvas=!0,this.touchData.onoff=!0,this.store.resetOperation(),this.touchData.cpx=this.touchData.oldx=this.touchData.startx=this.getEventLocation(t).x,this.touchData.cpy=this.touchData.oldy=this.touchData.starty=this.getEventLocation(t).y,this.preLineTimestamp=l.getTimeStamp(),this.preLinePoint={x:this.touchData.startx,y:this.touchData.starty},this.pointCount=0,this.ignorePointCount=0,"line"==e?(this.store.cancelSelect(),this.store.collectLineData().start(this.touchData.startx,this.touchData.starty)):"eraser"==e?(this.store.cancelSelect(),this.store.collectEraserData(this.touchData.startx,this.touchData.starty)):"raser"==e?(this.store.cancelSelect(),this.store.collectRaserData().start(this.touchData.startx,this.touchData.starty)):"select"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)?this.isMoving=!0:(this.store.cancelSelect(),this.store.collectSelectData().start(this.touchData.startx,this.touchData.starty)):"pointselect"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0):"keyboardinput"==e||("move"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)):e.indexOf("graph")>-1&&(this.store.cancelSelect(),this.store.collectGraphData().start(this.touchData.startx,this.touchData.starty))),1==this.isMoving&&this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)))):this.nextStep()},lt.prototype.canvasTouchMove=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e=this.store.getType(),r=this.store.getColor(),o=this.store.getThin(),i=this.canvasDrawComponent,n=this.getEventLocation(t).x,a=this.getEventLocation(t).y;if(n<=0||n>=1e4||a<=0||a>=1e4)this.canvasTouchCancel(t);else if(this.touchData.onoff){if("line"==e){try{var s=this.store.userData[this.getCurrentBoard()][this.option.userId],c=s[s.length-1];if(c&&!c.show)return this.canvasTouchEnd(t),void this.canvasTouchStart(t)}catch(t){this.aegis.reportError(-1,t.message,"canvasTouchMove",{stack:t.stack})}var u=l.getTimeStamp();this.pointCount++;var d=Math.sqrt(Math.pow(this.preLinePoint.x-n,2)+Math.pow(this.preLinePoint.y-a,2));if(u-this.preLineTimestamp<20||d<5)return void this.ignorePointCount++;if(this.preLineTimestamp=u,this.preLinePoint={x:n,y:a},this.touchData.cpx>=0&&this.touchData.cpy>=0){var h=(this.touchData.cpx+n)/2,f=(this.touchData.cpy+a)/2;i.beginPath(),i.moveTo(this.touchData.oldx/1e4*this.width,this.touchData.oldy/1e4*this.height),i.quadraticCurveTo(this.touchData.cpx/1e4*this.width,this.touchData.cpy/1e4*this.height,h/1e4*this.width,f/1e4*this.height),i.setStrokeStyle(r),i.setLineWidth(o/1e4*this.height),i.setLineCap("round"),i.stroke(),i.draw(!0),this.touchData.oldx=h,this.touchData.oldy=f}this.touchData.cpx=n,this.touchData.cpy=a,this.store.collectLineData().draw(n,a)}else"eraser"==e?this.store.collectEraserData(n,a):"raser"==e?this.store.collectRaserData().draw(n,a):"select"==e?this.store.collectSelectData().draw(n,a):"pointselect"==e||("move"==e?(this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy),this.touchData.oldx=n,this.touchData.oldy=a):e.indexOf("graph")>-1&&this.store.collectGraphData().draw(n,a));this.isMoving&&(this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy),this.touchData.oldx=n,this.touchData.oldy=a)}else"line"==e?(this.store.resetOperation(),this.touchData.cpx=this.touchData.oldx=this.touchData.startx=n,this.touchData.cpy=this.touchData.oldy=this.touchData.starty=a,this.store.cancelSelect(),this.store.collectLineData().start(this.touchData.startx,this.touchData.starty),this.touchData.inCanvas=!0,this.touchData.onoff=!0):e.indexOf("graph")>-1&&(this.touchData.inCanvas=!0,this.touchData.onoff=!0,this.store.resetOperation(),this.touchData.oldx=this.touchData.startx=n,this.touchData.oldy=this.touchData.starty=a,this.store.cancelSelect(),this.store.collectGraphData().start(this.touchData.startx,this.touchData.starty))}},lt.prototype.canvasTouchEnd=function(t){if(this.stopDefaultEvent(t),this.canDraw){this.touchData.onoff=!1,this.touchData.cpx=-10,this.touchData.cpy=-10;var e=this.store.getType(),r=this.getEventLocation(t).x,o=this.getEventLocation(t).y;if("line"==e){if(!this.touchData.inCanvas)return;this.store.collectLineData().end(r,o)}else{if("eraser"==e)return;if("raser"==e)this.store.collectRaserData().end(r,o);else if("select"!=e||this.isMoving)if("pointselect"!=e||this.isMoving){if(e.indexOf("graph")>-1){if(r<=0||r>=1e4||o<=0||o>=1e4)return;this.store.collectGraphData().end(r,o)}}else this.store.collectPointSelectData(r,o);else this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,r,o)}this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo())}},lt.prototype.canvasTouchCancel=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e,r=this.store.getType(),o=this.getEventLocation(t).x,i=this.getEventLocation(t).y;this.touchData.inCanvas=!1,1==this.touchData.onoff&&("line"==r?(e=this.store.getThin(),o=l.getEffectivePoint(o,e),i=l.getEffectivePoint(i,e),this.store.collectLineData().over(o,i)):"raser"==r?this.store.collectRaserData().over():"select"!=r||this.isMoving?r.indexOf("graph")>-1&&(e=this.store.getThin(),o=l.getEffectivePoint(o,e),i=l.getEffectivePoint(i,e),this.store.collectGraphData().over(o,i)):this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,o,i),this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.touchData.onoff=!1,this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()))}},lt.prototype.setColor=function(t){this.store.setColor(t)},lt.prototype.setThin=function(t){this.store.setThin(t)},lt.prototype.setTextSize=function(t){this.store.setTextSize(t)},lt.prototype.getTextSize=function(){return this.store.getTextSize()},lt.prototype.setTextColor=function(t){this.store.setTextColor(t)},lt.prototype.getTextColor=function(){return this.store.getTextColor()},lt.prototype.setType=function(t){this.store.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t]])},lt.prototype.undo=function(){this.store.undo()},lt.prototype.canUndo=function(){return this.store.canUndo()},lt.prototype.redo=function(){this.store.redo()},lt.prototype.canRedo=function(){return this.store.canRedo()},lt.prototype.clearBoard=function(t){this.store.clearBoard(t)},lt.prototype.clear=function(){this.store.clear()},lt.prototype.clearDraws=function(){this.store.clearDraws()},lt.prototype.clearAll=function(){this.store.clearAll()},lt.prototype.addBackgroundPic=function(t,e,r){this.store.addBackgroundPic(t,e,r)},lt.prototype._setBackgroundImage=function(t,e){this.store._setBackgroundImage(t,e)},lt.prototype.setBackgroundPic=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;this.store.setBackgroundPic(t,e)},lt.prototype.setBackgroundH5=function(t){this.store.setBackgroundH5(t)},lt.prototype.updateCurrentFillMode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.TEDU_BOARD_IMAGE_FIT_MODE_CENTER;this.store.updateCurrentFillMode(t)},lt.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},lt.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},lt.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},lt.prototype.cancelSelect=function(){this.store.cancelSelect()},lt.prototype.setCanDraw=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canDraw=t},lt.prototype.addFile=function(t,e,r,o,n){return this.store.addFile(t,e,r,o,n,i.FILE_TYPE.IMG)},lt.prototype.addH5PPTFile=function(t){if(!this.store.isExistH5PPTUrl(t)&&this.iframeDOM.getAttribute("src")!==t)return t.indexOf("?")>-1?t+="&page=0&step=0":t+="?page=0&step=0",void this.iframeDOM.setAttribute("src",t);this.event.fire(this,"TEB_WARNING",J.TEDU_BOARD_WARNING_H5PPT_ALREADY_EXISTS,t)},lt.prototype.addImagesFile=function(t){var e=this;if(!Array.isArray(t))return"";if(0==t.length)return"";var r="#".concat(l.getTimeStamp()),o="imagesfile_".concat(r),n=JSON.stringify(t),a=(new Date).getTime(),s=l.compress(n),c=(new Date).getTime(),u=100*s.length/n.length,d=c-a;if(s&&s.length>i.IMAGESFILE_MAX_URL_LENGTH)return setTimeout(function(){e.event.fire(e,"TEB_ERROR",I.TEDU_BOARD_ERROR_DATA_TOO_LARGE,"please try to split into two or more files, or try to use shorter url."),y.report("images_file_url_too_large",{extra_info:JSON.stringify({urls:n,urls_len:n.length,compress_len:s.length,compress_ratio:u,elapse:d})})},0),"";var h=s;if(this.store.isExistH5PPTUrl(h))return r=this.store.getFileInfoByUrl(h).fid,this.event.fire(this,"TEB_WARNING",J.TEDU_BOARD_WARNING_IMAGESFILE_ALREADY_EXISTS,r),r;var f=this.store.addFile(r,t,o,h,null,i.FILE_TYPE.IMAGESFILE);return y.report("add_images_file_start",{file_id:f,extra_info:JSON.stringify({urls:n,urls_len:n.length,compress_len:s.length,compress_ratio:u,elapse:d})}),f},lt.prototype.deleteFile=function(t){return this.store.deleteFile(t)},lt.prototype.switchFile=function(t){var e=this;t&&t!=this.store.getCurrentFile()&&(clearTimeout(this.pptH5LoadTask),this.iframeDOM.removeAttribute("src"),this.bgH5.removeAttribute("src"),this.pptH5LoadTask=setTimeout(function(){e.store.switchFile(t)},50))},lt.prototype.getGroup=function(){return this.store.getGroup()},lt.prototype.getFileInfo=function(t){return this.store.getFileInfo(t)},lt.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},lt.prototype.clearFileDraws=function(t){return this.store.clearFileDraws(t)},lt.prototype.setOrientation=function(t){this.orientation=t,this.store.setNeedDraw(!0)},lt.prototype.setCanvasTranslate=function(){this.canvasComponent.translate(this.height/2,this.width/2),this.canvasComponent.rotate(.5*Math.PI),this.canvasComponent.translate(-this.width/2,-this.height/2),this.canvasDrawComponent.translate(this.height/2,this.width/2),this.canvasDrawComponent.rotate(.5*Math.PI),this.canvasDrawComponent.translate(-this.width/2,-this.height/2)},lt.prototype.layout=function(){var t=this.container.clientWidth,e=this.container.clientHeight,r=this.store.getBoardRatio()||this.option.ratio,o=16,i=9;if(!1===r)this.width=t,this.height=e;else{if(void 0===r)o=16,i=9;else try{var n=r.split(":");o=1*n[0],o=isNaN(o)?16:o,i=1*n[1],i=isNaN(i)?9:i}catch(t){o=16,i=9}t/e>o/i?(this.width=e*o/i,this.height=e):(this.width=t,this.height=t*i/o)}this.width=Math.floor(this.width),this.height=Math.floor(this.height)},lt.prototype.drawLine=function(t,e){var r=this,o=e.lines,i=e.color,n=e.thin;t.lineWidth=n/1e4*this.height,t.lineCap="round",t.strokeStyle=i,t.fillStyle=i;var a=this.store.getSmoothLevel();if(a>0&&e.endSeq&&!e.fitCurve.length){var s=[];e.lines.forEach(function(t){s.push([t.x,t.y])}),e.fitCurve=j(s,1e4*a,null)}if(t.beginPath(),o.length<2)return t.arc(o[0].x/1e4*this.width,o[0].y/1e4*this.height,n/1e4*this.height/2,0,2*Math.PI,!0),t.fill(),t.closePath(),void t.stroke();if(2==o.length&&o[0].x==o[1].x&&o[0].y==o[1].y)return t.arc(o[0].x/1e4*this.width,o[0].y/1e4*this.height,n/1e4*this.height/2,0,2*Math.PI,!0),t.fill(),t.closePath(),void t.stroke();if(t.moveTo(o[0].x/1e4*this.width,o[0].y/1e4*this.height),0===e.fitCurve.length){for(var c=0;c<o.length-2;c++){var l=o[c],u=o[c+1],d=(l.x+u.x)/2/1e4*this.width,h=(l.y+u.y)/2/1e4*this.height;t.quadraticCurveTo(l.x/1e4*this.width,l.y/1e4*this.height,d,h)}var f=o[o.length-1];t.lineTo(f.x/1e4*this.width,f.y/1e4*this.height)}else e.fitCurve.forEach(function(e){var o=e[1][0]/1e4*r.width,i=e[1][1]/1e4*r.height,n=e[2][0]/1e4*r.width,a=e[2][1]/1e4*r.height,s=e[3][0]/1e4*r.width,c=e[3][1]/1e4*r.height;t.bezierCurveTo(o,i,n,a,s,c)});t.stroke()},lt.prototype.isDrawEnable=function(){return this.canDraw},lt.prototype.getGlobalBackgroundColor=function(){return this.store.getGlobalBackgroundColor()},lt.prototype.getBackgroundColor=function(){return this.store.getBackgroundColor()},lt.prototype.getToolType=function(){var t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t,e){return t===e};return Object.keys(m.BOARD_ACTION_TYPE).find(function(r){return e(m.BOARD_ACTION_TYPE[r],t)})}(this.store.getType());return["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"].indexOf(t)},lt.prototype.getBrushColor=function(){return this.store.getColor()},lt.prototype.getBrushThin=function(){return this.store.getThin()},lt.prototype.setDataSyncEnable=function(t){this.store.setDataSyncEnable(t)},lt.prototype.isDataSyncEnable=function(){return this.store.isDataSyncEnable()},lt.prototype.setTextFontFamily=function(t){this.store.setTextFontFamily(t)},lt.prototype.getTextFontFamily=function(){return this.store.getTextFontFamily()},lt.prototype.setTextFontStyle=function(t){this.store.setTextFontStyle(t)},lt.prototype.getTextFontStyle=function(){return this.store.getTextFontStyle()},lt.prototype.setBoardRatio=function(t){this.store.setBoardRatio(this.store.getCurrentBoard(),t),this.draw()},lt.prototype.getBoardRatio=function(){return this.store.getBoardRatio()||this.option.ratio},lt.prototype.setBoardScale=function(t){this.store.setBoardScale(t),this.draw()},lt.prototype.getBoardScale=function(){return this.store.getBoardScale()},lt.prototype.setBoardContentFitMode=function(t){this.store.setBoardContentFitMode(t)},lt.prototype.getBoardContentFitMode=function(){return this.store.getBoardContentFitMode()},lt.prototype.setContainerOffset=function(t){this.containerOffset=t},lt.prototype.applyFileTranscode=function(t,e){this.store.applyFileTranscode(t,e)},lt.prototype.createTranscode=function(t){return this.store.createTranscode(t)},lt.prototype.describeTranscode=function(t){return this.store.describeTranscode(t)},lt.prototype.preloadBoard=function(){var t;t=this.store.preloadBoard(),this.context&&t.length&&this.context.setPreLoadImgList(t)},lt.prototype.addAckData=function(t){this.store.addSendAckData(t)},lt.prototype.syncAndReload=function(){this.store.syncAndReload()},lt.prototype.destroy=function(){this.store.destroy(),this.store=null,this.drawInterval&&clearInterval(this.drawInterval)};var ut=lt;function dt(){}dt.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},dt.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var r,o=this._cbs[t]||[];o&&~(r=o.indexOf(e));)o.splice(r,1);return this},dt.prototype.fire=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments.length>1?arguments[1]:void 0;this._cbs=this._cbs||{};var r=this._cbs[e];if(r){for(var o=r.length,i=arguments.length,n=new Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];for(;o--;)r[o].apply(t,[].concat(n))}return this};var ht=dt,ft={TEDU_BOARD_TOOL_TYPE_MOUSE:0,TEDU_BOARD_TOOL_TYPE_PEN:1,TEDU_BOARD_TOOL_TYPE_ERASER:2,TEDU_BOARD_TOOL_TYPE_LASER:3,TEDU_BOARD_TOOL_TYPE_LINE:4,TEDU_BOARD_TOOL_TYPE_OVAL:5,TEDU_BOARD_TOOL_TYPE_RECT:6,TEDU_BOARD_TOOL_TYPE_OVAL_SOLID:7,TEDU_BOARD_TOOL_TYPE_RECT_SOLID:8,TEDU_BOARD_TOOL_TYPE_POINT_SELECT:9,TEDU_BOARD_TOOL_TYPE_RECT_SELECT:10,TEDU_BOARD_TOOL_TYPE_TEXT:11,TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG:12,TEDU_BOARD_TOOL_TYPE_STRAIGHT_LINE:13,TEDU_BOARD_TOOL_TYPE_ELLIPSE:14},pt=r(3),gt=r.n(pt);function mt(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var _t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.platform="miniprogram",this.aegis=new gt.a({id:1922,version:i.REPORT_VERSION,beforeReport:function(t){if(!(["2048"].indexOf(String(t.level))>-1))return!0;try{var e=JSON.parse(t.msg);return!l.isUndefined(e.errorCode)&&0!=e.errorCode}catch(e){return t.msg.indexOf("Error.stack")>-1&&t.msg.indexOf("Error.message")>-1||t.msg.indexOf("errorMessage")>-1}}})}var e,r;return e=t,(r=[{key:"setConfig",value:function(t){this.aegis.setConfig(t)}},{key:"report",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=Object.assign(e,{action:t,platform:this.platform,errorCode:0});try{this.aegis.report(JSON.stringify(e))}catch(t){}}},{key:"reportError",value:function(t,e,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("[object Error]"===Object.prototype.toString.call(o))try{this.aegis.report(o)}catch(t){}else{o=Object.assign({action:r,platform:this.platform,errorCode:t,errorMessage:e},o);try{this.aegis.report(JSON.stringify(o))}catch(t){}}}},{key:"callAegisMethod",value:function(t,e){this.aegis[t].call(this,e)}}])&&mt(e.prototype,r),t}();function yt(t){i.setNativeVersion("2.1.0"),i.setPlatform("miniprogram"),t.tlsData={sdkAppId:t.sdkAppId,identifier:t.userId,userSig:t.userSig};var e=new _t;e.setConfig({uin:"".concat(t.sdkAppId,"_").concat(t.userId)}),t.aegis=e,this.event=new ht,t.event=this.event,this.board=new ut(t),this.version=i.VERSION,this.transcodeIntervalMap={}}r(4),r(6).polyfill(),yt.EVENT=et,yt.TOOL_TYPE=ft,yt.TEduBoardErrorCode=I,yt.TEduBoardWarningCode=J,yt.TEduBoardToolType=ft,yt.TEduBoardUploadStatus=Z,yt.TEduBoardBackgroundH5Status={TEDU_BOARD_BACKGROUND_H5_STATUS_LOADING:1,TEDU_BOARD_BACKGROUND_H5_STATUS_LOAD_FINISH:2},yt.TEduBoardImageStatus=ct,yt.prototype.destroy=function(){this.off(),this.event=null,this.board.destroy(),this.board=null,this.historySyncDone=!1,this.transcodeIntervalMap={},this.taskIdUserDataMap={}},yt.prototype.on=function(t,e){this.event.on(t,e)},yt.prototype.off=function(t,e){this.event.off(t,e)},yt.prototype.getVersion=function(){return this.version},yt.prototype.addBoard=function(t,e){var r=this.board.addBoard();return this.board.setBackgroundPic(t,e),r},yt.prototype.deleteBoard=function(t){this.board.deleteBoard(t)},yt.prototype.prevBoard=function(){this.board.prevBoard()},yt.prototype.nextBoard=function(){this.board.nextBoard()},yt.prototype.gotoBoard=function(t){t&&this.board.switchBoard(t)},yt.prototype.getCurrentBoard=function(){return this.board.getCurrentBoard()},yt.prototype.getBoardList=function(){return this.board.getBoardList()},yt.prototype.deleteFile=function(t){this.board.deleteFile(t)},yt.prototype.switchFile=function(t){this.board.switchFile(t)},yt.prototype.getCurrentFile=function(){return this.board.getCurrentFile()},yt.prototype.getFileInfo=function(t){return this.board.getFileInfo(t)},yt.prototype.getFileInfoList=function(){return this.board.getGroup()},yt.prototype.getFileBoardList=function(t){return this.board.getBoardByGroup(t)},yt.prototype.clearFileDraws=function(t){this.board.clearFileDraws(t)},yt.prototype.reset=function(){this.board.clearAll()},yt.prototype.addSyncData=function(t){this.board.addData(t)},yt.prototype.setDrawEnable=function(t){this.board.setCanDraw(t)},yt.prototype.isDrawEnable=function(){return this.board.isDrawEnable()},yt.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},yt.prototype.getGlobalBackgroundColor=function(){return this.board.getGlobalBackgroundColor()},yt.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},yt.prototype.getBackgroundColor=function(){return this.board.getBackgroundColor()},yt.prototype.setToolType=function(t){this.board.setType(t)},yt.prototype.getToolType=function(){return this.board.getToolType()},yt.prototype.setBrushColor=function(t){this.board.setColor(t)},yt.prototype.getBrushColor=function(){return this.board.getBrushColor()},yt.prototype.setBrushThin=function(t){this.board.setThin(t)},yt.prototype.getBrushThin=function(){return this.board.getBrushThin()},yt.prototype.clear=function(t){t?this.board.clear():this.board.clearDraws()},yt.prototype.setBackgroundImage=function(t,e){this.board._setBackgroundImage(t,e)},yt.prototype.undo=function(){this.board.undo()},yt.prototype.redo=function(){this.board.redo()},yt.prototype.resize=function(t,e){this.board.resize(t,e)},yt.prototype.setTextStyle=function(t){this.board.setTextFontStyle(t)},yt.prototype.getTextStyle=function(){return this.board.getTextFontStyle()},yt.prototype.setTextFamily=function(t){this.board.setTextFontFamily(t)},yt.prototype.getTextFamily=function(){return this.board.getTextFontFamily()},yt.prototype.canvasTouchStart=function(t){this.board.canvasTouchStart(t)},yt.prototype.canvasTouchMove=function(t){this.board.canvasTouchMove(t)},yt.prototype.canvasTouchEnd=function(t){this.board.canvasTouchEnd(t)},yt.prototype.canvasTouchCancel=function(t){this.board.canvasTouchCancel(t)},yt.prototype.setOrientation=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical";this.board.setOrientation(t)},yt.prototype.setContainerOffset=function(t){this.board.setContainerOffset(t)},yt.prototype.setDataSyncEnable=function(t){this.board.setDataSyncEnable(t)},yt.prototype.isDataSyncEnable=function(){return this.board.isDataSyncEnable()},yt.prototype.addTranscodeFile=function(t){var e="#".concat(l.getTimeStamp());if(t.pages&&0!=t.pages&&t.url.endsWith("/")){for(var r=[],o=0;o<t.pages;o++)r.push("".concat(t.url).concat(o+1,".jpg"));try{var i=t.resolution.split("x")[0],n=t.resolution.split("x")[1],a=l.maxCommonDivisor(i,n),s="".concat(i/a,":").concat(n/a);return this.board.addFile(e,r,t.title,t.url,s)}catch(o){return this.board.addFile(e,r,t.title,t.url,null)}}},yt.prototype.applyFileTranscode=function(t,e){this.board.applyFileTranscode(t,e)},yt.prototype.getFileTranscodeProgress=function(t){this.board.describeTranscode(t)},yt.prototype.addImagesFile=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Array.isArray(t)?0==t.length?"":this.board.addImagesFile(t,null,e):""},yt.prototype.addAckData=function(t){this.board.addAckData(t)},yt.prototype.syncAndReload=function(){this.board.syncAndReload()},e.default=yt}]).default});